(self.webpackChunk=self.webpackChunk||[]).push([[773],{7511:(t,e,r)=>{"use strict";var n=r(1461),i=r(4269),a=r(752),o=r.n(a);function s(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return l(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return l(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}const c={props:{data:Object},data:function(){return{icons:{mdiTrashCanOutline:i.j43,mdiCloudUploadOutline:i.MMK}}},computed:{files:function(){return this.data.files||this.$set(this.data,"files",[]),this.data.files.concat([{name:this.$t("Загрузить файлы")}])}},methods:{upload:function(t){var e,r=this,n=s(t.target.files);try{var i=function(){var t=e.value,n={name:t.name,type:t.type,src:null,file:t};if(r.data.files.push(n),n.type&&n.type.includes("image/")){var i=new FileReader;i.onloadend=function(){return n.src=function(){return i.result}},i.readAsDataURL(t)}};for(n.s();!(e=n.n()).done;)i()}catch(t){n.e(t)}finally{n.f()}}}};var u=r(1900),d=r(3453),m=r.n(d),f=r(8597),v=r(2003),p=r(6482),h=r(260),b=r(7587),_=r(7638),g=r(6032),y=r(4698),x=(0,u.Z)(c,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-row",{attrs:{dense:""}},t._l(t.files,(function(e,n){return r("v-col",{key:n,attrs:{cols:2}},[r("v-card",{class:{upload:!e.type,local:e.src},attrs:{flat:""},on:t._d({},[e.type?null:"click",function(e){return t.$refs.file[0].click()}])},[r("a",{attrs:{href:e.type?e.path?"/storage/"+e.path:e.src?e.src():null:null,target:"_blank","data-fancybox":e.type&&e.type.includes("image/")?"images":null,"data-caption":e.name}},[r("v-img",{attrs:{src:e.type&&e.type.includes("image/")?e.path?"/storage/"+e.path:e.src():null,height:"240px"}})],1),t._v(" "),r("v-card-actions",[r("span",{attrs:{title:e.name}},[t._v(t._s(e.name))]),t._v(" "),r("v-spacer"),t._v(" "),e.type?r("v-btn",{attrs:{icon:""},on:{click:function(e){return t.data.files.splice(n,1)}}},[r("v-icon",[t._v(t._s(t.icons.mdiTrashCanOutline))])],1):[r("v-btn",{attrs:{icon:""}},[r("v-icon",[t._v(t._s(t.icons.mdiCloudUploadOutline))])],1),t._v(" "),r("input",{ref:"file",refInFor:!0,attrs:{multiple:"",type:"file"},on:{change:t.upload}})]],2)],1)],1)})),1)}),[],!1,null,"25675c92",null);const w=x.exports;m()(x,{VBtn:f.Z,VCard:v.Z,VCardActions:p.h7,VCol:h.Z,VIcon:b.Z,VImg:_.Z,VRow:g.Z,VSpacer:y.Z});const k={props:{group:String,files:Array}};var $=r(7702),j=(0,u.Z)(k,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-container",[r("v-row",{attrs:{dense:""}},t._l(t.files,(function(e,n){return r("v-col",{key:n},[r("a",{attrs:{href:!!e.type&&"/storage/"+e.path,target:"_blank","data-fancybox":e.type&&e.type.includes("image/")?t.group:void 0,"data-caption":e.name}},[r("v-img",{staticClass:"grey lighten-2",attrs:{src:e.type&&e.type.includes("image/")?"/storage/"+e.path:"","aspect-ratio":"1"},scopedSlots:t._u([{key:"placeholder",fn:function(){return[r("v-row",{staticClass:"fill-height ma-0",attrs:{align:"center",justify:"center"}})]},proxy:!0}],null,!0)})],1)])})),1)],1)}),[],!1,null,"5ac43896",null);const O=j.exports;m()(j,{VCol:h.Z,VContainer:$.Z,VImg:_.Z,VRow:g.Z});function D(t){return function(t){if(Array.isArray(t))return P(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return P(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return P(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function P(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var C=["red","pink","purple","deep-purple","indigo","blue","light-blue","cyan","teal","green","light-green","lime","yellow","amber","orange","deep-orange","brown","blue-grey"];const Z={props:{user:Object},computed:{initials:function(){var t=this.user.name.split(" ");return t[0][0]+(t[1]?t[1][0]:"")},color:function(){var t=D(this.user.name).reduce((function(t,e){return t+e.charCodeAt(0)}),0);return C[t%C.length]}}};var V=r(337),S=(0,u.Z)(Z,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("span",[r("v-avatar",{attrs:{size:"32",color:t.color}},[t.user.photo?r("img",{attrs:{src:"storage/"+t.user.photo}}):r("span",{staticClass:"white--text"},[t._v("\n            "+t._s(t.initials)+"\n        ")])]),t._v("\n\n    "+t._s(t.user.name)+"\n")],1)}),[],!1,null,"4871a4a9",null);const T=S.exports;m()(S,{VAvatar:V.Z});var I=r(7757),q=r.n(I);const A={data:function(){return{icons:{mdiCloudDownloadOutline:i.REA}}}};var E=r(9283);function L(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function R(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?L(Object(r),!0).forEach((function(e){B(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):L(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function B(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function U(t,e,r,n,i,a,o){try{var s=t[a](o),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(n,i)}function F(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function o(t){U(a,n,i,o,s,"next",t)}function s(t){U(a,n,i,o,s,"throw",t)}o(void 0)}))}}const z={mixins:[A],metaInfo:function(){return{title:this.title}},data:function(){return{title:this.$t("Текущая сводка"),working:!1,filters:{from:null,till:null,project:null,locations:[],users:[]},filtersChanged:!1,tab:0,projects:[],projectsLoading:!1,projectsError:!1,locations:[],locationsLoading:!1,users:[],usersLoading:!1,groups:[],customAccess:!1,outdated:!1,validAt:null,valuesId:null,updateInterval:null,periods:["Y1Q4","Y2Q1","Y2Q2","Y2Q3","Y2Q4","Y3Q1","Y3Q2","Y3Q3","Y3Q4","Y4Q1","Y4Q2","Y4Q3"],periodStartDates:{Y1Q4:"2020-07-01",Y2Q1:"2020-10-01",Y2Q2:"2021-01-01",Y2Q3:"2021-04-01",Y2Q4:"2021-07-01",Y3Q1:"2021-10-01",Y3Q2:"2022-01-01",Y3Q3:"2022-04-01",Y3Q4:"2022-07-01",Y4Q1:"2022-10-01",Y4Q2:"2023-01-01",Y4Q3:"2023-04-01"},periodEndDates:{Y1Q4:"2020-09-30",Y2Q1:"2020-12-31",Y2Q2:"2021-03-31",Y2Q3:"2021-06-30",Y2Q4:"2021-09-30",Y3Q1:"2021-12-31",Y3Q2:"2022-03-31",Y3Q3:"2022-06-30",Y3Q4:"2022-09-30",Y4Q1:"2022-12-31",Y4Q2:"2023-03-31",Y4Q3:"2023-06-30"}}},created:function(){var t=this;return F(q().mark((function e(){return q().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.updateInterval=setInterval((function(){t.filters.project&&t.outdated&&!t.filtersChanged&&t.fetchData()}),3e3),t.fetchProjects();case 2:case"end":return e.stop()}}),e)})))()},destroyed:function(){clearInterval(this.updateInterval)},computed:R(R({},(0,E.Se)(["user"])),{},{isSuperuser:function(){return this.user.roles.includes("superuser")||this.customAccess},period:{get:function(){var t=this,e=Object.keys(this.periodStartDates).find((function(e){return t.periodStartDates[e]==t.filters.from}));if(e){var r=Object.keys(this.periodEndDates).find((function(e){return t.periodEndDates[e]==t.filters.till}));if(e==r)return r}return null},set:function(t){t&&(this.filters.from=this.periodStartDates[t],this.filters.till=this.periodEndDates[t],this.fetchData(!0))}}}),watch:{"filters.project":function(){this.projectsError=!1,this.fetchLocations(),this.fetchUsers()},"filters.locations":function(){this.fetchUsers()},filters:{handler:function(){this.filtersChanged=!0},deep:!0}},methods:{fetchProjects:function(){var t=this;return F(q().mark((function e(){var r;return q().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.axios.get("projects",{params:{itemsPerPage:-1,indicators:!0}});case 3:r=e.sent,t.projects=r.data.data,t.filters.project||(t.filters.project=t.projects[0].id,t.fetchData(!0)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.error(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))()},fetchLocations:function(){var t=this;return F(q().mark((function e(){var r,n,i;return q().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.axios.get("locations",{params:{projects:[t.filters.project],itemsPerPage:-1}});case 3:for(i in r=e.sent,t.locations=r.data.data,n=function(e){t.locations.find((function(r){return t.filters.locations[e]==r.id}))||t.filters.locations.splice(e,1)},t.filters.locations)n(i);e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})))()},fetchUsers:function(){var t=this;return F(q().mark((function e(){var r,n,i;return q().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.axios.get("users",{params:{projects:[t.filters.project],locations:t.filters.locations,withPositions:1,itemsPerPage:-1}});case 3:for(i in r=e.sent,t.users=r.data.data,n=function(e){t.users.find((function(r){return t.filters.users[e]==r.id}))||t.filters.users.splice(e,1)},t.filters.users)n(i);e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})))()},fetchData:function(){var t=this;return F(q().mark((function e(){var r;return q().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.filters.project){e.next=3;break}return t.projectsError=!0,e.abrupt("return");case 3:return t.working=!0,e.prev=4,e.next=7,t.axios.get("indicators",{params:R({currentId:t.valuesId},t.filters)});case 7:r=e.sent,t.validAt=r.data.valid_at,t.valuesId=r.data.id,t.customAccess=r.data.access,t.groups=r.data.data?r.data.data.map((function(t){return{title:t.title,rows:t.items.map((function(t){return Array.isArray(t)?t.map((function(t){return{value:t[0],title:t[1],href:t[2],new:t[3],download:t[4]}})):t}))}})):[],!r.data.outdated&&t.outdated&&t.$store.dispatch("notification",{type:"success",text:t.$t("Отображены актуальные данные")}),t.outdated=r.data.outdated,t.filtersChanged=!1,e.next=20;break;case 17:e.prev=17,e.t0=e.catch(4),console.error(e.t0);case 20:t.working=!1;case 21:case"end":return e.stop()}}),e,null,[[4,17]])})))()}}};var Q=r(3816),M=r(7489),Y=r(1576),N=r(1446),H=r(5037),W=r(96),X=r(5155),K=r(4848),J=r(7457),G=r(4449),tt=r(7949),et=r(7347),rt=(0,u.Z)(z,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-container",[r("v-row",[r("v-col",[r("v-toolbar",{attrs:{elevation:"0"}},[r("v-toolbar-title",[t._v(t._s(t.title))]),t._v(" "),r("v-spacer"),t._v(" "),r("div",{staticClass:"d-flex"},[r("v-autocomplete",{staticClass:"mr-4 limited-select",attrs:{label:t.$t("Проект"),loading:t.projectsLoading,items:t.projects,"item-text":"name","item-value":"id",error:t.projectsError,"single-line":"","hide-details":""},model:{value:t.filters.project,callback:function(e){t.$set(t.filters,"project",e)},expression:"filters.project"}}),t._v(" "),r("v-autocomplete",{staticClass:"mr-4 limited-select",attrs:{label:t.$t("Регионы"),loading:t.locationsLoading,items:t.locations,"item-text":"name","item-value":"id",multiple:"",clearable:"","single-line":"","hide-details":""},model:{value:t.filters.locations,callback:function(e){t.$set(t.filters,"locations",e)},expression:"filters.locations"}}),t._v(" "),r("v-autocomplete",{staticClass:"mr-4 limited-select",attrs:{label:t.$t("Сотрудники"),loading:t.usersLoading,items:t.users,"item-text":"name","item-value":"id",multiple:"",clearable:"","single-line":"","hide-details":""},model:{value:t.filters.users,callback:function(e){t.$set(t.filters,"users",e)},expression:"filters.users"}}),t._v(" "),r("v-select",{staticClass:"mr-4 limited-select",attrs:{label:t.$t("Период"),items:t.periods,"single-line":"","hide-details":""},model:{value:t.period,callback:function(e){t.period=e},expression:"period"}}),t._v(" "),r("v-text-field",{staticClass:"mr-4",attrs:{label:t.$t("Период с"),type:"date","single-line":"","hide-details":"",clearable:""},model:{value:t.filters.from,callback:function(e){t.$set(t.filters,"from",e)},expression:"filters.from"}}),t._v(" "),r("v-text-field",{staticClass:"mr-4",attrs:{label:t.$t("Период по"),type:"date","single-line":"","hide-details":"",clearable:""},model:{value:t.filters.till,callback:function(e){t.$set(t.filters,"till",e)},expression:"filters.till"}}),t._v(" "),r("v-btn",{attrs:{color:"primary"},on:{click:t.fetchData}},[t._v("\n                        "+t._s(t.$t("Применить"))+"\n                        "),t.outdated&&!t.filtersChanged?r("v-progress-circular",{staticClass:"ml-2",attrs:{indeterminate:"",size:"20"}}):t._e()],1)],1)],1)],1)],1),t._v(" "),t.outdated||t.filtersChanged&&t.valuesId?r("v-alert",{attrs:{border:"left",color:"warning",dark:""}},[t.filtersChanged?[t._v(t._s(t.$t("Для отображения актуальных данных примените фильтры")))]:[this.validAt?[t._v("\n                "+t._s(t.$t("Данные актуальны на")+" "+new Date(this.validAt).toLocaleString())+"\n            ")]:[t._v(t._s(t.$t("Данные будут отображены через некоторое время")))]]],2):t._e(),t._v(" "),r("v-tabs",{model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},t._l(t.groups,(function(e,n){return r("v-tab",{key:n},[t._v("\n            "+t._s(e.title)+"\n        ")])})),1),t._v(" "),r("v-tabs-items",{staticClass:"pt-8",model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},t._l(t.groups,(function(e,n){return r("v-tab-item",{key:n,attrs:{transition:!1,"reverse-trasition":!1}},t._l(e.rows,(function(e,n){return r("v-row",{key:n},[e.title?r("v-col",{staticClass:"pb-0",attrs:{cols:"12"}},[r("v-subheader",{class:"text-h"+(e.level+4)},[t._v(t._s(e.title))])],1):t._l(e,(function(e,n){return r("v-col",{key:n,staticClass:"py-0"},[r("v-card",{attrs:{flat:""}},[r("v-card-title",[e.href?r("a",{staticClass:"mr-4",attrs:{href:e.href,target:"_blank"}},[t._v(t._s(e.value))]):[t._v(t._s(e.value))],t._v(" "),e.new?[e.href?r("a",{attrs:{href:e.href+"&new=1",target:"_blank"}},[t._v("+"+t._s(e.new))]):[t._v("+"+t._s(e.new))]]:t._e(),t._v(" "),e.download?r("a",{attrs:{href:e.download,target:"_blank"}},[r("v-icon",{attrs:{large:"",color:"primary"}},[t._v(t._s(t.icons.mdiCloudDownloadOutline))])],1):t._e()],2),t._v(" "),r("v-card-subtitle",[t._v(t._s(e.title))])],1)],1)}))],2)})),1)})),1)],1)}),[],!1,null,null,null);const nt=rt.exports;m()(rt,{VAlert:Q.Z,VAutocomplete:M.Z,VBtn:f.Z,VCard:v.Z,VCardSubtitle:p.Qq,VCardTitle:p.EB,VCol:h.Z,VContainer:$.Z,VIcon:b.Z,VProgressCircular:Y.Z,VRow:g.Z,VSelect:N.Z,VSpacer:y.Z,VSubheader:H.Z,VTab:W.Z,VTabItem:X.Z,VTabs:K.Z,VTabsItems:J.Z,VTextField:G.Z,VToolbar:tt.Z,VToolbarTitle:et.qW});function it(t,e,r,n,i,a,o){try{var s=t[a](o),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(n,i)}const at={props:{item:Object},data:function(){return{show:!0,comment:"",working:!1}},methods:{request:function(){var t=this;return function(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function o(t){it(a,n,i,o,s,"next",t)}function s(t){it(a,n,i,o,s,"throw",t)}o(void 0)}))}}(q().mark((function e(){var r;return q().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.working=!0,e.prev=1,e.next=4,t.axios.post("requests",{timing_id:t.item.id,comment:t.comment});case 4:r=e.sent,t.close(r.data),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.error(e.t0);case 11:t.working=!1;case 12:case"end":return e.stop()}}),e,null,[[1,8]])})))()},close:function(t){this.$emit("close",t)}}};var ot=r(2882),st=r(5507),lt=(0,u.Z)(at,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-dialog",{attrs:{"max-width":"400"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[r("v-card",[r("v-card-title",[t._v(t._s(t.$t("Запрос отмены верификации")))]),t._v(" "),r("v-card-text",[r("v-textarea",{attrs:{placeholder:t.$t("Запрос"),autofocus:""},model:{value:t.comment,callback:function(e){t.comment=e},expression:"comment"}})],1),t._v(" "),r("v-card-actions",[r("v-btn",{attrs:{color:"error",dark:""},on:{click:function(e){return t.close()}}},[t._v(t._s(t.$t("Отменить")))]),t._v(" "),r("v-spacer"),t._v(" "),r("v-btn",{attrs:{text:"",disabled:!t.comment||t.working},on:{click:t.request}},[t._v("\n                "+t._s(t.$t("Запросить"))+"\n                "),t.working?r("v-progress-circular",{staticClass:"ml-2",attrs:{size:"20",indeterminate:""}}):t._e()],1)],1)],1)],1)}),[],!1,null,null,null);const ct=lt.exports;m()(lt,{VBtn:f.Z,VCard:v.Z,VCardActions:p.h7,VCardText:p.ZB,VCardTitle:p.EB,VDialog:ot.Z,VProgressCircular:Y.Z,VSpacer:y.Z,VTextarea:st.Z});function ut(t,e,r,n,i,a,o){try{var s=t[a](o),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(n,i)}const dt={props:{item:Object,result:String},data:function(){return{show:!0,comment:"",working:!1}},computed:{declined:function(){return"declined"==this.result}},methods:{request:function(){var t=this;return function(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function o(t){ut(a,n,i,o,s,"next",t)}function s(t){ut(a,n,i,o,s,"throw",t)}o(void 0)}))}}(q().mark((function e(){return q().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.working=!0,e.prev=1,e.next=4,t.axios.put("requests/"+t.item.id,{status:t.result,comment:t.comment});case 4:t.close(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),console.error(e.t0);case 10:t.working=!1;case 11:case"end":return e.stop()}}),e,null,[[1,7]])})))()},close:function(t){this.$emit("close",t)}}};var mt=(0,u.Z)(dt,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-dialog",{attrs:{"max-width":"500"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[r("v-card",[r("v-card-title",[t._v(t._s((t.declined?t.$t("Отклонение"):t.$t("Удовлетворение"))+" "+t.$t("запроса отмены верификации")))]),t._v(" "),r("v-card-text",[r("v-textarea",{attrs:{placeholder:t.$t("Комментарий"),autofocus:""},model:{value:t.comment,callback:function(e){t.comment=e},expression:"comment"}})],1),t._v(" "),r("v-card-actions",[r("v-btn",{attrs:{color:"error",dark:""},on:{click:function(e){return t.close(!0)}}},[t._v(t._s(t.$t("Отменить")))]),t._v(" "),r("v-spacer"),t._v(" "),r("v-btn",{attrs:{text:"",disabled:t.declined&&!t.comment||t.working},on:{click:t.request}},[t._v("\n                "+t._s(t.$t(t.declined?"Отклонить":"Удовлетворить"))+"\n                "),t.working?r("v-progress-circular",{staticClass:"ml-2",attrs:{size:"20",indeterminate:""}}):t._e()],1)],1)],1)],1)}),[],!1,null,null,null);const ft=mt.exports;m()(mt,{VBtn:f.Z,VCard:v.Z,VCardActions:p.h7,VCardText:p.ZB,VCardTitle:p.EB,VDialog:ot.Z,VProgressCircular:Y.Z,VSpacer:y.Z,VTextarea:st.Z});var vt=r(8365);function pt(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return ht(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ht(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function ht(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function bt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function _t(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?bt(Object(r),!0).forEach((function(e){xt(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):bt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function gt(t,e,r,n,i,a,o){try{var s=t[a](o),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(n,i)}function yt(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function o(t){gt(a,n,i,o,s,"next",t)}function s(t){gt(a,n,i,o,s,"throw",t)}o(void 0)}))}}function xt(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const wt={mixins:[vt.Z],components:{User:T},metaInfo:function(){return{title:this.title}},data:function(){var t=new Date,e=6e4*t.getTimezoneOffset(),r=t.getFullYear(),n=t.getMonth();t=new Date(r,n,1);var i=new Date(t.getTime()-e).toISOString().substring(0,10);t=new Date(11==n?r+1:r,11==n?0:n+1,0);var a=new Date(t.getTime()-e).toISOString().substring(0,10);return xt({title:this.$t("Рабочий график"),filters:{from:i,till:a,project:null,location:null,users:[]},projects:[],projectsLoading:!1,users:[],usersLoading:!1,value:"",events:[],colors:["#2196F3","#3F51B5","#673AB7","#00BCD4","#4CAF50","#FF9800","#757575"],dragEvent:null,dragStart:null,createEvent:null,createStart:null,extendOriginal:null,dragged:!1,selectedEvent:{},selectedElement:null,selectedOpen:!1,form:{start_date:null,start_time:null,end_time:null,location_id:null},saving:!1,locations:[{text:"Национальный офис",value:1},{text:"У-1",value:2},{text:"У-2",value:3},{text:"У-3",value:4},{text:"У-4",value:5}]},"saving",!1)},created:function(){var t=this;return yt(q().mark((function e(){return q().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.fetchProjects();case 1:case"end":return e.stop()}}),e)})))()},computed:_t(_t({},(0,E.Se)(["user"])),{},{isSuperuser:function(){return this.user.roles.includes("superuser")},displayedEvents:function(){return this.events.filter((function(t){return!t.removed}))},canEdit:function(){return this.selectedEvent&&this.selectedEvent.user&&this.selectedEvent.user.id==this.user.id&&(!this.selectedEvent.verifiers||!this.selectedEvent.verifiers.length)},canVerifyAll:function(){return this.isSuperuser&&!!this.displayedEvents.find((function(t){return t.verifiable}))}}),watch:{"filters.project":function(){this.fetchUsers()},filters:{handler:function(){this.fetchData()},deep:!0}},methods:{fetchProjects:function(){var t=this;return yt(q().mark((function e(){var r;return q().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.axios.get("projects",{params:{itemsPerPage:-1,indicators:!0}});case 3:r=e.sent,t.projects=r.data.data,t.filters.project||(t.filters.project=t.projects[0].id,t.fetchData()),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.error(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))()},fetchUsers:function(){var t=this;return yt(q().mark((function e(){var r,n,i;return q().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.axios.get("users",{params:{projects:[t.filters.project],withPositions:1,itemsPerPage:-1}});case 3:for(i in r=e.sent,t.users=r.data.data,n=function(e){t.users.find((function(r){return t.filters.users[e]==r.id}))||t.filters.users.splice(e,1)},t.filters.users)n(i);e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})))()},fetchData:function(){var t=this;return yt(q().mark((function e(){var r;return q().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.axios.get("activities",{params:{from:t.filters.from,till:t.filters.till,projects:[t.filters.project],users:t.filters.users,location:t.filters.location||0,itemsPerPage:-1}});case 3:r=e.sent,t.events=r.data.data.map((function(e){return _t(_t({},e),{},{start:new Date("".concat(e.start_date," ").concat(e.start_time)).getTime(),end:new Date("".concat(e.start_date," ").concat(e.end_time)).getTime(),name:t.locations.find((function(t){return t.value==e.location_id})).text,color:t.colors[e.verifiers.length?6:e.user.id!=t.user.id?e.user.id%7:e.location_id],timed:!0})})),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))()},save:function(){var t=this;return yt(q().mark((function e(){var r,n,i,a,o,s,l,c;return q().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.saving=!0,e.prev=1,r=pt(t.events),e.prev=3,r.s();case 5:if((n=r.n()).done){e.next=31;break}if(!(i=n.value).id){e.next=23;break}if(i.user.id!=t.user.id||i.verifiers&&i.verifiers.length){e.next=21;break}if(i.removed){e.next=17;break}return a=new Date(i.start),o=6e4*a.getTimezoneOffset(),e.next=14,t.axios.put("activities/".concat(i.id),{start_date:new Date(a.getTime()-o).toISOString().substring(0,10),end_date:new Date(a.getTime()-o).toISOString().substring(0,10),start_time:new Date(a.getTime()-o).toISOString().substring(11,16),end_time:new Date(new Date(i.end).getTime()-o).toISOString().substring(11,16),location_id:i.location_id,project_id:i.project_id});case 14:e.sent,e.next=21;break;case 17:if(2==i.removed){e.next=21;break}return e.next=20,t.axios.delete("activities/".concat(i.id));case 20:i.removed=2;case 21:e.next=29;break;case 23:return s=new Date(i.start),l=6e4*s.getTimezoneOffset(),e.next=27,t.axios.post("activities",{start_date:new Date(s.getTime()-l).toISOString().substring(0,10),end_date:new Date(s.getTime()-l).toISOString().substring(0,10),start_time:new Date(s.getTime()-l).toISOString().substring(11,16),end_time:new Date(new Date(i.end).getTime()-l).toISOString().substring(11,16),location_id:i.location_id,project_id:i.project_id});case 27:c=e.sent,i.id=c.data.id;case 29:e.next=5;break;case 31:e.next=36;break;case 33:e.prev=33,e.t0=e.catch(3),r.e(e.t0);case 36:return e.prev=36,r.f(),e.finish(36);case 39:t.$store.dispatch("notification",{type:"success",text:t.$t("Данные сохранены")}),e.next=45;break;case 42:e.prev=42,e.t1=e.catch(1),console.error(e.t1);case 45:t.saving=!1;case 46:case"end":return e.stop()}}),e,null,[[1,42],[3,33,36,39]])})))()},verifyEvent:function(){var t=arguments,e=this;return yt(q().mark((function r(){var n,i;return q().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return(n=t.length>0&&void 0!==t[0]?t[0]:null)||(n=e.selectedEvent),r.next=4,e.axios.put("activities/".concat(n.id),{verified:!0});case 4:i=r.sent,n.verifiable=i.data.verifiable,n.verifiers=i.data.verifiers,n.verifiers.length&&(n.color=e.colors[6]);case 8:case"end":return r.stop()}}),r)})))()},verifyAll:function(){var t=this;return yt(q().mark((function e(){var r,n,i;return q().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.saving=!0,r=pt(t.displayedEvents.filter((function(t){return t.verifiable}))),e.prev=2,r.s();case 4:if((n=r.n()).done){e.next=10;break}return i=n.value,e.next=8,t.verifyEvent(i);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:t.saving=!1;case 19:case"end":return e.stop()}}),e,null,[[2,12,15,18]])})))()},startDrag:function(t){var e=t.event,r=t.timed;e&&r&&(this.dragEvent=e,this.dragTime=null,this.extendOriginal=null)},startTime:function(t){var e=this.toTime(t);if(this.dragEvent&&null===this.dragTime){var r=this.dragEvent.start;this.dragTime=e-r}else{this.createStart=this.roundTime(e);var n=this.filters.location||this.locations[0].value;this.createEvent={name:this.locations.find((function(t){return t.value==n})).text,location_id:n,color:this.colors[n],start:this.createStart,end:this.createStart+36e5,timed:!0,project_id:this.filters.project,user:this.user},this.events.push(this.createEvent)}},extendBottom:function(t){this.createEvent=t,this.createStart=t.start,this.extendOriginal=t.end,this.dragged=!0},mouseMove:function(t,e){var r=this.toTime(t);if(this.dragEvent&&null!==this.dragTime){if(!(this.dragEvent.user.id!=this.user.id||this.dragEvent.verifiers&&this.dragEvent.verifiers.length)){var n=this.dragEvent.start,i=this.dragEvent.end-n,a=r-this.dragTime,o=this.roundTime(a),s=o+i;e.shiftKey&&new Date(n).getDate()!=new Date(o).getDate()&&(this.dragEvent=_t(_t({},this.dragEvent),{},{id:null,start:o,end:s}),this.events.push(this.dragEvent)),this.dragEvent.start=o,this.dragEvent.end=s}this.dragged=!0}else if(this.createEvent&&null!==this.createStart){var l=this.roundTime(r,!1),c=Math.min(l,this.createStart),u=Math.max(l,this.createStart);this.createEvent.start=c,this.createEvent.end=u}},endDrag:function(){this.dragTime=null,this.dragEvent=null,this.createEvent=null,this.createStart=null,this.extendOriginal=null},cancelDrag:function(){if(this.createEvent)if(this.extendOriginal)this.createEvent.end=this.extendOriginal;else{var t=this.events.indexOf(this.createEvent);-1!==t&&this.events.splice(t,1)}this.createEvent=null,this.createStart=null,this.dragTime=null,this.dragEvent=null},roundTime:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=15,n=60*r*1e3;return e?t-t%n:t+(n-t%n)},toTime:function(t){return new Date(t.year,t.month-1,t.day,t.hour,t.minute).getTime()},showEvent:function(t){var e=this,r=t.nativeEvent,n=t.event;if(this.dragged)this.dragged=!1;else{var i=function(){e.selectedEvent=n;var t=new Date(n.start),i=6e4*t.getTimezoneOffset();e.form.start_date=new Date(t.getTime()-i).toISOString().substring(0,10),e.form.start_time=new Date(t.getTime()-i).toISOString().substring(11,16),e.form.end_time=new Date(new Date(n.end).getTime()-i).toISOString().substring(11,16),e.form.location_id=n.location_id;for(var a=r.target;!a.classList.contains("v-event-timed");)a=a.parentElement;e.selectedElement=a,requestAnimationFrame((function(){return requestAnimationFrame((function(){return e.selectedOpen=!0}))}))};this.selectedEvent!=n&&(this.selectedOpen?(this.selectedOpen=!1,requestAnimationFrame((function(){return requestAnimationFrame((function(){return i()}))}))):i()),r.stopPropagation()}},saveForm:function(){var t=this;this.$refs.form.validate()&&(this.selectedEvent.start=new Date("".concat(this.form.start_date," ").concat(this.form.start_time)).getTime(),this.selectedEvent.end=new Date("".concat(this.form.start_date," ").concat(this.form.end_time)).getTime(),this.selectedEvent.name=this.locations.find((function(e){return e.value==t.form.location_id})).text,this.selectedEvent.location_id=this.form.location_id,this.selectedEvent.color=this.colors[this.form.location_id],this.selectedOpen=!1)}}};var kt=r(2602),$t=r(3725),jt=r(5005),Ot=(0,u.Z)(wt,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-container",[r("v-row",[r("v-col",[r("v-toolbar",{attrs:{elevation:"0"}},[r("v-toolbar-title",[t._v(t._s(t.title))]),t._v(" "),r("v-spacer"),t._v(" "),r("div",{staticClass:"d-flex"},[r("v-autocomplete",{staticClass:"mr-4 limited-select",attrs:{label:t.$t("Проекты"),loading:t.projectsLoading,items:t.projects,"item-text":"name","item-value":"id",multiple:"",clearable:"","single-line":"","hide-details":""},model:{value:t.filters.project,callback:function(e){t.$set(t.filters,"project",e)},expression:"filters.project"}}),t._v(" "),r("v-select",{staticClass:"mr-4 limited-select",attrs:{label:t.$t("Место"),items:t.locations,clearable:"","single-line":"","hide-details":""},model:{value:t.filters.location,callback:function(e){t.$set(t.filters,"location",e)},expression:"filters.location"}}),t._v(" "),t.isSuperuser?r("v-autocomplete",{staticClass:"mr-4 limited-select",attrs:{label:t.$t("Сотрудники"),loading:t.usersLoading,items:t.users,"item-text":"name","item-value":"id",multiple:"",clearable:"","single-line":"","hide-details":""},model:{value:t.filters.users,callback:function(e){t.$set(t.filters,"users",e)},expression:"filters.users"}}):t._e(),t._v(" "),r("v-text-field",{staticClass:"mr-4",attrs:{label:t.$t("Начало периода"),type:"date","single-line":"","hide-details":"",clearable:""},model:{value:t.filters.from,callback:function(e){t.$set(t.filters,"from",e)},expression:"filters.from"}}),t._v(" "),r("v-text-field",{staticClass:"mr-4",attrs:{label:t.$t("Конец периода"),type:"date","single-line":"","hide-details":"",clearable:""},model:{value:t.filters.till,callback:function(e){t.$set(t.filters,"till",e)},expression:"filters.till"}}),t._v(" "),r("v-btn",{attrs:{color:"primary",disabled:t.saving},on:{click:t.save}},[t._v("\n                        "+t._s(t.$t("Сохранить"))+"\n                        "),t.saving?r("v-progress-circular",{staticClass:"ml-2",attrs:{indeterminate:"",size:"20"}}):t._e()],1),t._v(" "),t.canVerifyAll?r("v-btn",{staticClass:"ml-4",attrs:{color:"error",disabled:t.saving},on:{click:t.verifyAll}},[t._v("\n                        "+t._s(t.$t("Верифицировать все"))+"\n                        "),t.saving?r("v-progress-circular",{staticClass:"ml-2",attrs:{indeterminate:"",size:"20"}}):t._e()],1):t._e()],1)],1)],1)],1),t._v(" "),r("v-row",[r("v-col",[r("div",{staticClass:"scrolling-container"},[r("v-calendar",{ref:"calendar",attrs:{color:"primary",type:"custom-daily","max-days":180,start:t.filters.from,end:t.filters.till,events:t.displayedEvents,"event-ripple":!1,"short-intervals":!1},on:{"mousedown:event":t.startDrag,"mousedown:time":t.startTime,"mousemove:time":t.mouseMove,"mouseup:time":t.endDrag,"click:event":t.showEvent},nativeOn:{mouseleave:function(e){return t.cancelDrag(e)}},scopedSlots:t._u([{key:"event",fn:function(e){var n=e.event,i=e.eventSummary;return[t.isSuperuser?r("div",{staticClass:"pa-1 avatar"},[r("User",{attrs:{user:n.user}})],1):t._e(),t._v(" "),r("div",{staticClass:"v-event-draggable",domProps:{innerHTML:t._s(i())}}),t._v(" "),r("div",{staticClass:"v-event-drag-bottom",on:{mousedown:function(e){return e.stopPropagation(),t.extendBottom(n)}}})]}}])}),t._v(" "),r("v-menu",{attrs:{"close-on-content-click":!1,activator:t.selectedElement,"offset-x":""},model:{value:t.selectedOpen,callback:function(e){t.selectedOpen=e},expression:"selectedOpen"}},[r("v-form",{ref:"form",on:{submit:function(e){return e.preventDefault(),t.saveForm(e)}}},[r("v-card",[r("v-card-text",[t.selectedEvent.verifiers&&t.selectedEvent.verifiers.length?r("v-row",[r("v-col",{},[r("strong",[t._v("Верифицировано")]),t._v(" "),r("br"),t._v(" "),r("br"),t._v(" "),t._l(t.selectedEvent.verifiers,(function(e){return r("div",[r("User",{attrs:{user:e}}),t._v(", "+t._s(new Date(e.pivot.updated_at).toLocaleString())),r("br")],1)}))],2)],1):t._e(),t._v(" "),r("v-row",[r("v-col",{staticClass:"py-0"},[r("v-text-field",{attrs:{label:t.$t("Дата"),rules:[t.rules.required],readonly:!t.canEdit,type:"date"},model:{value:t.form.start_date,callback:function(e){t.$set(t.form,"start_date",e)},expression:"form.start_date"}})],1)],1),t._v(" "),r("v-row",[r("v-col",{staticClass:"py-0"},[r("v-text-field",{attrs:{label:t.$t("Начало"),rules:[t.rules.required],readonly:!t.canEdit,type:"time"},model:{value:t.form.start_time,callback:function(e){t.$set(t.form,"start_time",e)},expression:"form.start_time"}})],1),t._v(" "),r("v-col",{staticClass:"py-0"},[r("v-text-field",{attrs:{label:t.$t("Окончание"),rules:[t.rules.required],readonly:!t.canEdit,type:"time"},model:{value:t.form.end_time,callback:function(e){t.$set(t.form,"end_time",e)},expression:"form.end_time"}})],1)],1),t._v(" "),r("v-row",[r("v-col",{staticClass:"py-0"},[r("v-select",{attrs:{label:t.$t("Место"),items:t.locations,rules:[t.rules.required],readonly:!t.canEdit},model:{value:t.form.location_id,callback:function(e){t.$set(t.form,"location_id",e)},expression:"form.location_id"}})],1)],1)],1),t._v(" "),r("v-card-actions",[r("v-btn",{attrs:{text:"",color:"secondary"},on:{click:function(e){t.selectedOpen=!1}}},[t._v("\n                                    "+t._s(t.$t("Закрыть"))+"\n                                ")]),t._v(" "),t.canEdit?r("v-btn",{attrs:{dark:"",color:"primary",type:"submit"}},[t._v("\n                                    "+t._s(t.$t("Сохранить"))+"\n                                ")]):t._e(),t._v(" "),t.canEdit?r("v-btn",{attrs:{text:"",color:"secondary"},on:{click:function(e){t.$set(t.selectedEvent,"removed",!0),t.selectedOpen=!1}}},[t._v("\n                                    "+t._s(t.$t("Удалить"))+"\n                                ")]):t._e(),t._v(" "),t.selectedEvent.verifiable?r("v-btn",{attrs:{dark:"",color:"error"},on:{click:function(e){t.verifyEvent(),t.selectedOpen=!1}}},[t._v("\n                                    "+t._s(t.$t("Верифицировать"))+"\n                                ")]):t._e()],1)],1)],1)],1)],1)])],1)],1)}),[],!1,null,"20299dba",null);const Dt=Ot.exports;m()(Ot,{VAutocomplete:M.Z,VBtn:f.Z,VCalendar:kt.Z,VCard:v.Z,VCardActions:p.h7,VCardText:p.ZB,VCol:h.Z,VContainer:$.Z,VForm:$t.Z,VMenu:jt.Z,VProgressCircular:Y.Z,VRow:g.Z,VSelect:N.Z,VSpacer:y.Z,VTextField:G.Z,VToolbar:tt.Z,VToolbarTitle:et.qW});const Pt={props:["data"]};var Ct=(0,u.Z)(Pt,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return t.data.results?r("v-row",t._l(t.data.results,(function(e,n){return r("v-col",[r("v-card",{key:n,attrs:{flat:""}},[r("v-card-title",[t._v(t._s(e.value))]),t._v(" "),r("v-card-subtitle",[t._v(t._s(e.title))])],1)],1)})),1):t._e()}),[],!1,null,null,null);const Zt=Ct.exports;m()(Ct,{VCard:v.Z,VCardSubtitle:p.Qq,VCardTitle:p.EB,VCol:h.Z,VRow:g.Z});r(4003);var Vt=r(2718);function St(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Tt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?St(Object(r),!0).forEach((function(e){It(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):St(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function It(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function qt(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return At(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return At(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function At(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var Et=r(7382),Lt=r(3339),Rt=r(2048),Bt=r(7880),Ut=function(){return Bt},Ft=r(3348),zt=function(){return Ft},Qt=r(4452),Mt=function(){return Qt},Yt=r(1106),Nt=r(8407);function Ht(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}Et.Z.use(Nt.ZP);var Wt=r(4536),Xt=Wt.keys().map((function(t){return[t.replace(/(^.\/)|(\.js$)/g,""),Wt(t)]})).reduce((function(t,e){var r=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){i=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return r}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Ht(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ht(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e,2),n=r[0],i=r[1];return t[n]="function"==typeof i?i(n):i,t}),{}),Kt=new Nt.ZP.Store({strict:!1,modules:Xt}),Jt=r(5756),Gt=r(3372),te=r(7958),ee=te.__esModule?function(){return te.default}:function(){return te},re=r(9609),ne={mdiViewDashboardOutline:re.V7Q,mdiAccountBoxMultipleOutline:re.imX,mdiEyeOutline:re._VZ,mdiEyeOffOutline:re.qS7,mdiPlus:re.qX5,mdiPencilOutline:re.I$6,mdiDeleteOutline:re.vTx,mdiFileDocumentEditOutline:re.UKB,mdiAccountMultipleCheckOutline:re.UP2,mdiAccountOutline:re.jiR,mdiArrowUp:re.XHH,mdiArrowDown:re.dYk,mdiBriefcaseClockOutline:re.pRV,mdiCheckDecagramOutline:re._dp,mdiCheckDecagram:re.UY8,mdiAlertDecagramOutline:re.gvn,mdiAlertDecagram:re.VWO,mdiChartBar:re.btf,mdiFolderOpenOutline:re.gt$,mdiPlayCircleOutline:re.g3n,mdiStopCircleOutline:re.TpM,mdiStop:re.fUz,mdiProgressClock:re.plV,mdiProgressQuestion:re.W4D,mdiProgressCheck:re.uOw,mdiClipboardEditOutline:re.oUI,mdiViewHeadline:re.dpx,mdiViewSplitHorizontal:re.apQ,mdiChartBoxOutline:re.bqY,mdiChartBoxPlusOutline:re.$0f,mdiCalendarRangeOutline:re.CbU,mdiContentCopy:re.a0Z,mdiCloudDownloadOutline:re.REA,mdiDotsHorizontal:re.XMI,mdiHand:re.Ur5,mdiPencilLockOutline:re.joU,mdiCameraOutline:re.sTV,mdiPhoneOutline:re.WRj,mdiTrainCar:i.EoB,mdiFileDocumentOutline:i.P2t,mdiCheckCircleOutline:i.k6A,mdiCancel:i.M_e,mdiTimetable:i.B6D,mdiBadgeAccountHorizontalOutline:i.KHL},ie={data:function(){return{icons:ne}}};function ae(t,e,r,n,i,a,o){try{var s=t[a](o),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(n,i)}var oe={mixins:[ie,vt.Z],metaInfo:function(){return{title:this.$t("Вход")}},data:function(){return{form:new(ee())({login:"",password:"",remember:null}),show:!1,busy:!1}},methods:{login:function(){var t,e=this;return(t=Ut().mark((function t(){return Ut().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.$refs.form.validate()){t.next=2;break}return t.abrupt("return");case 2:if(e.busy=!0,t.prev=3,Mt().get("XSRF-TOKEN")){t.next=7;break}return t.next=7,e.axios({url:"/sanctum/csrf-cookie",baseURL:window.config.url||""});case 7:return t.next=9,e.form.post("login");case 9:return t.next=11,e.$store.dispatch("fetchUser");case 11:e.$router.replace(e.$route.query.redirect||{name:"home"}),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(3),console.error(t.t0);case 17:return t.prev=17,e.busy=!1,t.finish(17);case 20:case"end":return t.stop()}}),t,null,[[3,14,17,20]])})),function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function o(t){ae(a,n,i,o,s,"next",t)}function s(t){ae(a,n,i,o,s,"throw",t)}o(void 0)}))})()}}},se=r(4373),le=r(463),ce=function(){return le},ue=r(1e3),de=r(4510),me=r(4947),fe=r(9782),ve=r(5328),pe=r(7224),he=r(6301),be=r(6892),_e=r(703),ge=r(2746),ye=r(1980),xe=se.Z(oe,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-container",[r("v-row",[r("v-col",{attrs:{sm:"8","offset-sm":"2",lg:"4","offset-lg":"4"}},[r("v-card",[r("v-form",{ref:"form",on:{submit:function(e){return e.preventDefault(),t.login(e)}}},[r("v-card-title",{attrs:{"primary-title":""}},[r("h3",{staticClass:"headline"},[t._v(t._s(t.$t("Вход")))])]),t._v(" "),r("v-card-text",[r("v-text-field",{attrs:{label:t.$t("Имя"),prepend:"person_outline",rules:[t.rules.required],"error-messages":t.errors("login")},model:{value:t.form.login,callback:function(e){t.$set(t.form,"login",e)},expression:"form.login"}}),t._v(" "),r("v-text-field",{attrs:{label:t.$t("Пароль"),"append-icon":t.show?t.icons.mdiEyeOutline:t.icons.mdiEyeOffOutline,rules:[t.rules.required,t.rules.min(6)],type:t.show?"text":"password"},on:{"click:append":function(e){t.show=!t.show}},model:{value:t.form.password,callback:function(e){t.$set(t.form,"password",e)},expression:"form.password"}}),t._v(" "),r("v-checkbox",{attrs:{label:t.$t("не выходить"),value:"true"},model:{value:t.form.remember,callback:function(e){t.$set(t.form,"remember",e)},expression:"form.remember"}})],1),t._v(" "),r("v-card-actions",[r("v-btn",{attrs:{type:"submit",large:"",color:"secondary",disabled:t.busy}},[t._v("\n                            "+t._s(t.$t("Войти"))+"\n                            "),t.busy?r("v-progress-circular",{staticClass:"ml-2",attrs:{indeterminate:"",size:"20"}}):t._e()],1)],1)],1)],1)],1)],1)],1)}),[],!1,null,null,null),we=xe.exports;ce()(xe,{VBtn:ue.Z,VCard:de.Z,VCardActions:me.h7,VCardText:me.ZB,VCardTitle:me.EB,VCheckbox:fe.Z,VCol:ve.Z,VContainer:pe.Z,VForm:he.Z,VProgressCircular:be.Z,VRow:_e.Z,VTextField:ge.Z});var ke=r(9592),$e=r(2484),je=r(9617),Oe=r(1650),De=r(3827),Pe=r(5628),Ce=r(6721),Ze=r(4917),Ve=r(8202),Se=r(4078),Te=r(1056),Ie=function(){return Te},qe=[{value:"client",text:Vt.Z.t("клиент")},{value:"employee",text:Vt.Z.t("сотрудник")},{value:"superuser",text:Vt.Z.t("администратор")}],Ae=qe.reduce((function(t,e){return t[e.value]=e.text,t}),{});function Ee(t,e,r,n,i,a,o){try{var s=t[a](o),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(n,i)}function Le(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function o(t){Ee(a,n,i,o,s,"next",t)}function s(t){Ee(a,n,i,o,s,"throw",t)}o(void 0)}))}}function Re(t){return function(t){if(Array.isArray(t))return Be(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Be(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Be(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Be(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Ue(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Fe(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Ue(Object(r),!0).forEach((function(e){ze(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ue(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function ze(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Qe={mixins:[ie],props:{role:String},metaInfo:function(){return{title:this.title}},data:function(){return{roleNames:Ae,endpoint:"users",total:0,items:[],loading:!1,options:{search:null,role:null,from:null,till:null,project:null,locations:[]},projects:[],projectsLoading:!1,locations:[],locationsLoading:!1,working:!1,confirm:!1,itemId:null,selecting:!1,selected:[],mergeDialog:!1,mergeTo:null,clientToCall:null,confirmCall:!1}},computed:Fe(Fe({},Nt.Se(["user"])),{},{isSuperuser:function(){return this.user.roles.includes("superuser")},title:function(){return"client"==this.role?this.$t("Клиенты")+(this.total?" (".concat(this.$t("найдено")," ").concat(this.total,")"):""):this.$t("Сотрудники")},roles:function(){return qe.filter((function(t){return"client"!=t.value}))},headers:function(){return[{sortable:!1,value:"actions",width:1},{text:this.$t("ФИО"),value:"name",class:"text-no-wrap"}].concat(Re(this.options.project?[{text:this.$t("Регион"),value:"location",class:"text-no-wrap",sortable:!1}]:[]),Re(this.role?[]:[{text:this.$t("Роли"),value:"roles",class:"text-no-wrap"}]),[{text:this.$t("E-mail"),value:"email",class:"text-no-wrap"},{text:this.$t("Телефон"),value:"phone",class:"text-no-wrap"}],Re("client"!=this.role?[]:[{text:"Родители / опекуны",value:"related",sortable:!1},{text:"Дата анкетирования",value:"screening_date",class:"text-no-wrap",sortable:!1},{text:this.$t("Сотрудник"),value:"employee",class:"text-no-wrap",sortable:!1}]),[{text:"Дата создания",value:"created_at",class:"text-no-wrap"}])},downloadUrl:function(){return Ie()("//".concat(location.host,"/download").concat(location.pathname),this.options)}}),watch:{role:{handler:function(t){this.options.role=t},immediate:!0},options:{handler:function(){this.fetchDataDebounced()},deep:!0},ready:function(){this.fetchData()},"options.project":{handler:function(){this.fetchLocations()},immediate:!0},"$route.query":function(t){Object.keys(t).length||(this.options=Jt.pick(this.options,Object.keys({search:null,role:null,from:null,till:null,project:null,locations:null,page:null,itemsPerPage:null})))}},created:function(){var t=this;function e(e){var r=t.$route.query;if(r[e])for(var n in Array.isArray(r[e])||(r[e]=[r[e]]),r[e])r[e][n]=+r[e][n]}e("users"),e("locations"),Object.assign(this.options,Fe({},this.$route.query)),this.$route.query.project&&(this.options.project=+this.$route.query.project),this.$route.query.page&&(this.options.page=+this.$route.query.page),this.$route.query.itemsPerPage&&(this.options.itemsPerPage=+this.$route.query.itemsPerPage),this.$route.query.sortBy&&!Array.isArray(this.$route.query.sortBy)&&(this.options.sortBy=[this.$route.query.sortBy]),this.$watch("options",(function(e,r){t.$router.resolve({query:Jt.pickBy(e)}).href!=t.$route.fullPath&&(e.page==r.page&&(e.page=1),t.$router.replace({query:Fe(Fe({},Jt.pickBy(e)),{},{parts:e.parts})}),t.fetchDataDebounced())}),{deep:!0}),this.fetchDataDebounced=Jt.debounce(this.fetchData,750),this.fetchProjects()},methods:{fetchData:function(){var t=this;return Le(Ut().mark((function e(){var r;return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.loading=!0,e.next=3,t.axios.get(t.endpoint,{params:t.options});case 3:r=e.sent,t.items=r.data.data,t.total=r.data.total,t.loading=!1;case 7:case"end":return e.stop()}}),e)})))()},deleteItem:function(t){this.itemId=t.id,this.confirm=!0},deleteConfirmed:function(){var t=this;return Le(Ut().mark((function e(){return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.working=!0,e.next=3,t.axios.delete("".concat(t.endpoint,"/").concat(t.itemId));case 3:t.working=!1,t.confirm=!1,t.fetchData();case 6:case"end":return e.stop()}}),e)})))()},fetchProjects:function(){var t=this;return Le(Ut().mark((function e(){var r;return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.projectsLoading=!0,e.prev=1,e.next=4,t.axios.get("projects",{params:{itemsPerPage:-1}});case 4:r=e.sent,t.projects=r.data.data,1==t.projects.length&&(t.options.project=t.projects[0].id),e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(1),console.error(e.t0),e.abrupt("return");case 12:return e.prev=12,t.projectsLoading=!1,e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,8,12,15]])})))()},fetchLocations:function(){var t=this;return Le(Ut().mark((function e(){var r;return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.locationsLoading=!0,e.prev=1,e.next=4,t.axios.get("locations",{params:{itemsPerPage:-1,forProjects:t.options.project&&[t.options.project]}});case 4:r=e.sent,t.locations=r.data.data,e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(1),console.error(e.t0),e.abrupt("return");case 12:return e.prev=12,t.locationsLoading=!1,e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,8,12,15]])})))()},merge:function(){this.selecting=!this.selecting,!this.selecting&&this.selected.length&&(this.mergeDialog=!0)},doMerge:function(){var t=this;return Le(Ut().mark((function e(){return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.mergeDialog=!1,t.loading=!0,e.prev=2,e.next=5,t.axios.patch("users/merge",{users:t.selected.map((function(t){return t.id})),destination:t.mergeTo});case 5:t.mergeTo=null,t.selected=[],t.fetchData(),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(2),console.error(e.t0),t.loading=!1;case 14:case"end":return e.stop()}}),e,null,[[2,10]])})))()},call:function(){var t=this;return Le(Ut().mark((function e(){return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.working=!0,e.prev=1,e.next=4,t.axios.post("calls",{phone:t.clientToCall.phone});case 4:e.sent.data.error?t.$store.dispatch("notification",{type:"error",text:t.$t("Возникла проблема")}):t.$store.dispatch("notification",{type:"success",text:t.$t("Ожидайте звонка")}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.error(e.t0);case 11:t.working=!1,t.confirmCall=!1;case 13:case"end":return e.stop()}}),e,null,[[1,8]])})))()}}},Me=r(7055),Ye=r(9748),Ne=r(5718),He=r(6359),We=se.Z(Qe,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-container",[r("v-toolbar",{attrs:{elevation:"0"}},[r("v-toolbar-title",[t._v(t._s(t.title))]),t._v(" "),r("v-spacer"),t._v(" "),t.role&&t.isSuperuser||[2449].includes(t.user.id)?r("v-btn",{attrs:{icon:"",title:t.$t("Объединить"),target:"_blank"},on:{click:t.merge}},[r("v-icon",[t._v(t._s(t.icons.mdiAccountMultipleCheckOutline))])],1):t._e(),t._v(" "),t.role?r("v-btn",{attrs:{icon:"",title:t.$t("Скачать"),target:"_blank",href:t.downloadUrl}},[r("v-icon",[t._v(t._s(t.icons.mdiCloudDownloadOutline))])],1):t._e()],1),t._v(" "),r("v-row",[r("v-col",[r("v-text-field",{attrs:{label:"Поиск","hide-details":""},model:{value:t.options.search,callback:function(e){t.$set(t.options,"search",e)},expression:"options.search"}})],1),t._v(" "),r("v-col",[r("v-autocomplete",{attrs:{label:t.$t("Проект"),loading:t.projectsLoading,items:t.projects,"item-text":"name","item-value":"id",clearable:"","hide-details":""},model:{value:t.options.project,callback:function(e){t.$set(t.options,"project",e)},expression:"options.project"}})],1),t._v(" "),r("v-col",[r("v-autocomplete",{attrs:{label:t.$t("Регион"),loading:t.locationsLoading,items:t.locations,"item-text":"name","item-value":"id",clearable:"","hide-details":"",multiple:""},model:{value:t.options.locations,callback:function(e){t.$set(t.options,"locations",e)},expression:"options.locations"}})],1),t._v(" "),t.role?t._e():r("v-col",[r("v-select",{attrs:{label:t.$t("Роль"),items:t.roles,clearable:"","hide-details":""},model:{value:t.options.role,callback:function(e){t.$set(t.options,"role",e)},expression:"options.role"}})],1),t._v(" "),"client"==t.role?[r("v-col",[r("v-text-field",{attrs:{label:"Дата анкетирования с",type:"date","hide-details":"",clearable:""},model:{value:t.options.from,callback:function(e){t.$set(t.options,"from",e)},expression:"options.from"}})],1),t._v(" "),r("v-col",[r("v-text-field",{attrs:{label:"Дата анкетирования по",type:"date","hide-details":"",clearable:""},model:{value:t.options.till,callback:function(e){t.$set(t.options,"till",e)},expression:"options.till"}})],1)]:t._e()],2),t._v(" "),r("v-row",[r("v-col",[r("v-data-table",{attrs:{headers:t.headers,items:t.items,options:t.options,"server-items-length":t.total,loading:t.loading,"show-select":t.selecting},on:{"update:options":function(e){t.options=e}},scopedSlots:t._u([{key:"item.actions",fn:function(e){var n=e.item;return[r("div",{staticClass:"text-no-wrap"},[t.user.phone?r("v-btn",{attrs:{icon:"",title:t.$t("Позвонить"),disabled:!n.phone},on:{click:function(e){e.preventDefault(),t.clientToCall=n,t.confirmCall=!0}}},[r("v-icon",[t._v(t._s(t.icons.mdiPhoneOutline))])],1):t._e(),t._v(" "),r("v-btn",{attrs:{icon:"",href:t.$router.resolve({name:t.role?"clients.form":"users.form",params:{id:n.id,role:t.role}}).href,title:t.$t("Редактировать")},on:{click:function(e){return e.preventDefault(),t.$router.push({name:t.role?"clients.form":"users.form",params:{id:n.id,role:t.role}})}}},[r("v-icon",[t._v(t._s(t.icons.mdiPencilOutline))])],1),t._v(" "),n.activities&&!n.activities.length?r("v-btn",{attrs:{icon:"",title:t.$t("Удалить")},on:{click:function(e){return e.stopPropagation(),t.deleteItem(n)}}},[r("v-icon",[t._v(t._s(t.icons.mdiDeleteOutline))])],1):t._e()],1)]}},{key:"item.location",fn:function(e){var r=e.item;return[t._v("\n                    "+t._s(r.location&&r.location.name)+"\n                ")]}},{key:"item.roles",fn:function(e){var r=e.item.roles;return[t._v("\n                    "+t._s(r&&r.map((function(e){return t.roleNames[e]})).join(", "))+"\n                ")]}},{key:"item.screening_date",fn:function(e){var r=e.item;return[t._v("\n                    "+t._s(r.screenings[0]&&new Date(r.screenings[0].start_date).toLocaleDateString())+"\n                ")]}},{key:"item.employee",fn:function(e){var r=e.item;return[t._v("\n                    "+t._s(r.activities[0]&&r.activities[0].user.name)+"\n                ")]}},{key:"item.related",fn:function(e){var r=e.item;return[t._v("\n                    "+t._s(r.related_users.length?r.related_users.map((function(t){return t.name})).join(", "):null)+"\n                ")]}},{key:"item.created_at",fn:function(e){var r=e.item;return[t._v("\n                    "+t._s(new Date(r.created_at).toLocaleString())+"\n                ")]}}]),model:{value:t.selected,callback:function(e){t.selected=e},expression:"selected"}}),t._v(" "),r("v-btn",{attrs:{fab:"",fixed:"",bottom:"",color:"primary"},on:{click:function(e){return t.$router.push({name:t.role?"clients.form":"users.form",params:{id:"add",role:t.role}})}}},[r("v-icon",[t._v(t._s(t.icons.mdiPlus))])],1)],1)],1),t._v(" "),r("v-dialog",{attrs:{"max-width":"320"},model:{value:t.confirm,callback:function(e){t.confirm=e},expression:"confirm"}},[r("v-card",[r("progress-bar",{attrs:{show:t.working}}),t._v(" "),r("v-card-title",[t._v(t._s(t.$t("Подтверждение")))]),t._v(" "),r("v-card-text",[t._v(t._s(t.$t("Запись будет удалена. Продолжить?")))]),t._v(" "),r("v-card-actions",[r("v-spacer"),t._v(" "),r("v-btn",{attrs:{text:""},on:{click:function(e){t.confirm=!1}}},[t._v(t._s(t.$t("Отменить")))]),t._v(" "),r("v-btn",{attrs:{color:"error",dark:""},on:{click:t.deleteConfirmed}},[t._v(t._s(t.$t("Удалить")))])],1)],1)],1),t._v(" "),r("v-dialog",{attrs:{"max-width":"320"},model:{value:t.confirmCall,callback:function(e){t.confirmCall=e},expression:"confirmCall"}},[r("v-card",[r("v-card-title",[t._v(t._s(t.$t("Подтверждение")))]),t._v(" "),r("v-card-text",[t._v(t._s(t.$t("Позвонить на номер "+(t.clientToCall&&t.clientToCall.phone)+"?")))]),t._v(" "),r("v-card-actions",[r("v-spacer"),t._v(" "),r("v-btn",{attrs:{disabled:t.working,text:""},on:{click:function(e){t.confirmCall=!1}}},[t._v(t._s(t.$t("Отменить")))]),t._v(" "),r("v-btn",{attrs:{disabled:t.working,dark:!t.working,color:"error"},on:{click:function(e){return t.call()}}},[t._v("\n                    "+t._s(t.$t("Позвонить"))+"\n                    "),t.working?r("v-progress-circular",{staticClass:"ml-2",attrs:{indeterminate:"",size:"20"}}):t._e()],1)],1)],1)],1),t._v(" "),r("v-dialog",{attrs:{"max-width":"360"},model:{value:t.mergeDialog,callback:function(e){t.mergeDialog=e},expression:"mergeDialog"}},[r("v-card",[r("progress-bar",{attrs:{show:t.working}}),t._v(" "),r("v-card-title",[t._v(t._s(t.$t("Объединение")))]),t._v(" "),r("v-card-text",[t._v("\n                "+t._s(t.$t("Выберите верное написание"))+"\n\n                "),r("v-radio-group",{attrs:{mandatory:""},model:{value:t.mergeTo,callback:function(e){t.mergeTo=e},expression:"mergeTo"}},t._l(t.selected,(function(t){return r("v-radio",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),t._v(" "),r("v-card-actions",[r("v-spacer"),t._v(" "),r("v-btn",{attrs:{text:""},on:{click:function(e){t.mergeDialog=!1}}},[t._v(t._s(t.$t("Отменить")))]),t._v(" "),r("v-btn",{attrs:{color:"error",dark:""},on:{click:t.doMerge}},[t._v(t._s(t.$t("Объединить")))])],1)],1)],1)],1)}),[],!1,null,null,null),Xe=We.exports;ce()(We,{VAutocomplete:ke.Z,VBtn:ue.Z,VCard:de.Z,VCardActions:me.h7,VCardText:me.ZB,VCardTitle:me.EB,VCol:ve.Z,VContainer:pe.Z,VDataTable:Me.Z,VDialog:Ye.Z,VIcon:$e.Z,VProgressCircular:be.Z,VRadio:Ne.Z,VRadioGroup:He.Z,VRow:_e.Z,VSelect:Se.Z,VSpacer:je.Z,VTextField:ge.Z,VToolbar:Ze.Z,VToolbarTitle:Ve.qW});var Ke=[{value:"finished",text:Vt.Z.t("Завершено")},{value:"declined",text:Vt.Z.t("Отклонено")},{value:"canceled",text:Vt.Z.t("Аннулировано")}],Je=Ke.reduce((function(t,e){return t[e.value]=e.text,t}),{});function Ge(t,e,r,n,i,a,o){try{var s=t[a](o),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(n,i)}function tr(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function o(t){Ge(a,n,i,o,s,"next",t)}function s(t){Ge(a,n,i,o,s,"throw",t)}o(void 0)}))}}var er={mixins:[vt.Z,ie],props:{form:Object,item:Object,items:Object,model:Object,validationDisabled:Boolean,readonly:Boolean,modelClean:Boolean},data:function(){return{clientSearch:null,loadingClients:!1,foundClients:[],selectedClients:[],loadingPositions:!1,positions:[]}},watch:{clientSearch:function(){this.fetchClientsDebounced()}},created:function(){var t=this;return"position"==t.item.type&&this.fetchPositions(),tr(Ut().mark((function e(){var r;return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("clients"!=t.item.type){e.next=15;break}if(t.fetchClientsDebounced=Jt.debounce(t.fetchClients,750),!t.model[t.item.id]||!t.model[t.item.id].length){e.next=14;break}return t.loadingClients=!0,e.prev=4,e.next=7,t.axios.get("users",{params:{role:"client",ids:t.model[t.item.id]}});case 7:r=e.sent,t.selectedClients=r.data.data,e.next=13;break;case 11:e.prev=11,e.t0=e.catch(4);case 13:t.loadingClients=!1;case 14:t.$watch("model."+t.item.id,(function(e){t.selectedClients=t.clients.filter((function(t){return e.includes(t.id)}))}));case 15:case"end":return e.stop()}}),e,null,[[4,11]])})))()},computed:{cssClass:function(){return"checkbox"==this.item.type||"list"==this.item.type&&this.item.multiple&&"mb-6"},visible:function(){var t=this,e=this.item.ifItems||[[this.item.ifItem,this.item.ifItemIs]];return!this.item.conditional||e.reduce((function(e,r){if(e)return e;var n=t.model[r[0]];return r[0]&&["date","text"].includes(t.items[r[0]].type)?r[1]?!!n:!n:n===r[1]||Array.isArray(n)&&n.includes(r[1])}),!1)},clients:function(){return this.selectedClients.concat(this.foundClients)}},methods:{fetchClients:function(){var t=this;return tr(Ut().mark((function e(){var r;return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.clientSearch){e.next=2;break}return e.abrupt("return");case 2:return t.loadingClients=!0,e.prev=3,e.next=6,t.axios.get("users",{params:{role:"client",search:t.clientSearch}});case 6:r=e.sent,t.foundClients=r.data.data,e.next=12;break;case 10:e.prev=10,e.t0=e.catch(3);case 12:t.loadingClients=!1;case 13:case"end":return e.stop()}}),e,null,[[3,10]])})))()},fetchPositions:function(){var t=this;return tr(Ut().mark((function e(){var r;return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.loadingPositions=!0,e.prev=3,e.next=6,t.axios.get("positions",{params:{projects:t.form.projects.map((function(t){return t.id}))}});case 6:r=e.sent,t.positions=r.data.map((function(t){return t.position})),e.next=12;break;case 10:e.prev=10,e.t0=e.catch(3);case 12:t.loadingPositions=!1;case 13:case"end":return e.stop()}}),e,null,[[3,10]])})))()},validationRules:function(t){return this.validationDisabled||this.modelClean||!t.required?[]:[this.rules.required]}}},rr=se.Z(er,(function(){var t,e=this,r=e.$createElement,n=e._self._c||r;"text"==e.item.type&&(t=Array.isArray(e.item.mask)?e.item.mask.map((function(t){var e=t.match(/^\/(.+)\/$/);return e?new RegExp(e[1]):t})):e.item.mask);var i=function(){if(e.item.index==e.model[e.item.id].length-1){var t,r=qt(e.item.group);try{for(r.s();!(t=r.n()).done;){var n=t.value;e.model[n.id].push(void 0)}}catch(t){r.e(t)}finally{r.f()}}else if(!e.model[e.item.id][e.item.index]){var i,a=!0,o=qt(e.item.group);try{for(o.s();!(i=o.n()).done;){var s=i.value;if(e.model[s.id][e.item.index]){a=!1;break}}}catch(t){o.e(t)}finally{o.f()}if(a){var l,c=qt(e.item.group);try{for(c.s();!(l=c.n()).done;){var u=l.value;e.model[u.id].splice(e.item.index,1)}}catch(t){c.e(t)}finally{c.f()}}}},a={value:e.item.repeatable?e.model[e.item.id]&&e.model[e.item.id][e.item.index]:e.model[e.item.id],callback:function(t){if(e.item.repeatable){if(!e.model[e.item.id]){var r,n=qt(e.item.group);try{for(n.s();!(r=n.n()).done;){var a=r.value;e.$set(e.model,a.id,[void 0])}}catch(t){n.e(t)}finally{n.f()}}e.$set(e.model[e.item.id],e.item.index,t),i()}else e.$set(e.model,e.item.id,t)}};return e.visible?n("v-col",{class:e.cssClass},["text"==e.item.type?n("v-text-field",{directives:e.item.mask?[{name:"mask",rawName:"v-mask",value:t}]:[],attrs:{label:e.item.text,rules:e.validationRules(e.item),readonly:e.readonly,type:"text"},model:a}):e._e(),e._v(" "),"list"==e.item.type?[n("h6",{staticClass:"text-subtitle-1"},[e._v(e._s(e.item.text))]),e._v(" "),e.item.multiple?e._l(e.item.answers,(function(t){return n("v-checkbox",{key:t.id,attrs:{label:t.text,value:t.id,rules:e.validationRules(e.item),readonly:e.readonly,"hide-details":"",multiple:""},model:a})})):n("v-radio-group",{attrs:{rules:e.validationRules(e.item),readonly:e.readonly},model:a},e._l(e.item.answers,(function(t){return n("v-radio",{key:t.id,attrs:{label:t.text,value:t.id}})})),1),e._v(" "),e.item.other&&e.model[e.item.id]&&(e.model[e.item.id]==e.item.answers[e.item.answers.length-1].id||e.model[e.item.id].includes(e.item.answers[e.item.answers.length-1].id))?n("v-text-field",{attrs:{label:e.item.answers[e.item.answers.length-1].text,rules:[e.rules.required],readonly:e.readonly,type:"text"},model:{value:e.item.repeatable?e.model[e.item.id+"_input"]&&e.model[e.item.id+"_input"][e.item.index]:e.model[e.item.id+"_input"],callback:function(t){if(e.item.repeatable){if(!e.model[e.item.id+"_input"]){var r,n=qt(e.item.group);try{for(n.s();!(r=n.n()).done;){var a=r.value;e.$set(e.model,a.id+"_input",[void 0])}}catch(t){n.e(t)}finally{n.f()}}e.$set(e.model[e.item.id+"_input"],e.item.index,t),i()}else e.$set(e.model,e.item.id+"_input",t)}}}):e._e()]:e._e(),e._v(" "),"select"==e.item.type?n("v-select",{attrs:{label:e.item.text,rules:e.validationRules(e.item),readonly:e.readonly,items:e.item.answers,multiple:e.item.multiple,"item-value":"id"},model:a}):e._e(),e._v(" "),"checkbox"==e.item.type?n("v-checkbox",{attrs:{label:e.item.text,rules:e.validationRules(e.item),readonly:e.readonly,"hide-details":""},model:a}):e._e(),e._v(" "),"date"==e.item.type?n("v-text-field",{attrs:{label:e.item.text,rules:e.validationRules(e.item),readonly:e.readonly,type:"date",clearable:!e.readonly},model:a}):e._e(),e._v(" "),"time"==e.item.type?n("v-text-field",{attrs:{label:e.item.text,rules:e.validationRules(e.item),readonly:e.readonly,type:"time"},model:a}):e._e(),e._v(" "),"number"==e.item.type?n("v-text-field",{attrs:{label:e.item.text,rules:e.validationRules(e.item),readonly:e.readonly,type:"number",min:0,step:1},model:a}):e._e(),e._v(" "),"phone"==e.item.type?n("v-text-field",{directives:[{name:"mask",rawName:"v-mask",value:"+998 ## ### ## ##",expression:"'+998 ## ### ## ##'"}],attrs:{label:e.item.text,rules:e.validationRules(e.item),readonly:e.readonly,type:"tel"},model:a}):e._e(),e._v(" "),"clients"==e.item.type?n("v-autocomplete",{attrs:{label:e.item.text,rules:e.validationRules(e.item),readonly:e.readonly,items:e.clients,placeholder:e.$t("Начните вводить ФИО клиента"),"search-input":e.clientSearch,loading:e.loadingClients,multiple:"","item-text":"name","item-value":"id"},on:{"update:searchInput":function(t){e.clientSearch=t},"update:search-input":function(t){e.clientSearch=t}},model:a}):e._e(),e._v(" "),"position"==e.item.type?n("v-autocomplete",{attrs:{label:e.item.text,rules:e.validationRules(e.item),readonly:e.readonly,items:e.positions,placeholder:e.$t("Начните вводить название должности"),loading:e.loadingPositions},model:a}):e._e(),e._v(" "),"file"==e.item.type?n("v-file-input",{attrs:{label:e.item.repeatable?(e.model[e.item.id]&&e.model[e.item.id][e.item.index]&&"string"==typeof e.model[e.item.id][e.item.index].file?e.$t("Заменить"):e.$t("Загрузить"))+" "+e.item.text.toLowerCase():(e.model[e.item.id]&&"string"==typeof e.model[e.item.id].file?e.$t("Заменить"):e.$t("Загрузить"))+" "+e.item.text.toLowerCase(),readonly:e.readonly,"prepend-icon":(e.item.repeatable?e.model[e.item.id]&&e.model[e.item.id][e.item.index]&&"string"==typeof e.model[e.item.id][e.item.index].file:e.model[e.item.id]&&"string"==typeof e.model[e.item.id].file)?e.icons.mdiEyeOutline:""},on:{"click:prepend":function(t){(e.item.repeatable?e.model[e.item.id]&&e.model[e.item.id][e.item.index]&&"string"==typeof e.model[e.item.id][e.item.index].file:e.model[e.item.id]&&"string"==typeof e.model[e.item.id].file)&&window.open("/storage/"+(e.item.repeatable?e.model[e.item.id]&&e.model[e.item.id][e.item.index].file:e.model[e.item.id].file),"_blank")}},model:{value:e.item.repeatable?e.model[e.item.id]&&e.model[e.item.id][e.item.index]&&e.model[e.item.id][e.item.index].file:e.model[e.item.id]&&e.model[e.item.id].file,callback:function(t){if(e.item.repeatable){if(!e.model[e.item.id]){var r,n=qt(e.item.group);try{for(n.s();!(r=n.n()).done;){var a=r.value;e.$set(e.model,a.id,[void 0])}}catch(t){n.e(t)}finally{n.f()}}e.model[e.item.id][e.item.index]&&e.model[e.item.id][e.item.index].original?e.model[e.item.id][e.item.index].file=t:e.$set(e.model[e.item.id],e.item.index,e.model[e.item.id][e.item.index]?{original:e.model[e.item.id][e.item.index].file,file:t}:{file:t}),i()}else e.model[e.item.id]&&e.model[e.item.id].original?e.model[e.item.id].file=t:e.$set(e.model,e.item.id,e.model[e.item.id]?{original:e.model[e.item.id].file,file:t}:{file:t})}}}):e._e()],2):e._e()}),[],!1,null,null,null),nr=rr.exports;function ir(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function ar(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function or(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ar(Object(r),!0).forEach((function(e){sr(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ar(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function sr(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}ce()(rr,{VAutocomplete:ke.Z,VCheckbox:fe.Z,VCol:ve.Z,VRadio:Ne.Z,VRadioGroup:He.Z,VSelect:Se.Z,VTextField:ge.Z,VFileInput:ye.Z});var lr={mixins:[vt.Z,ie],components:{item:nr,results:Zt},props:{form:Object,data:Object,validationDisabled:Boolean},data:function(){return{deleteModel:null,confirmDelete:!1,imageOverlay:null}},computed:or(or({rows:function(){for(var t=[],e=[],r=0;r<this.form.schema.items.length;r++){var n=this.form.schema.items[r];if(n.repeatable&&(e.push(n),(n=Object.assign({},n)).index=0,n.group=e),t.push(n),e.length&&(n.groupEnd||r==this.form.schema.items.length-1||!this.form.schema.items[r+1].repeatable)){if(this.models[0].data[e[0].id])for(var i=1;i<this.models[0].data[e[0].id].length;i++){var a,o=qt(e);try{for(o.s();!(a=o.n()).done;){var s=a.value,l=Object.assign({},s);l.index=i,l.group=e,t.push(l)}}catch(t){o.e(t)}finally{o.f()}}e=[]}}var c,u,d=[],m=function(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return ir(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ir(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(t);try{for(m.s();!(u=m.n()).done;){var f=u.value;f.row&&c||(c&&d.push(c),c=[]),c.push(f)}}catch(c){m.e(c)}finally{m.f()}return c&&c.length&&d.push(c),d},models:function(){return this.data[this.form.id]?this.form.schema.multiple&&!Array.isArray(this.data[this.form.id])&&(this.data[this.form.id]=[this.data[this.form.id]]):this.$set(this.data,this.form.id,this.form.schema.multiple?[{data:{images:null}}]:[{data:{}}]),this.data[this.form.id]}},Nt.Se(["user"])),{},{isAdmin:function(){return[4,5].includes(this.user.id)},items:function(){var t,e={},r=qt(this.form.schema.items);try{for(r.s();!(t=r.n()).done;){var n=t.value;e[n.id]=n}}catch(t){r.e(t)}finally{r.f()}return e}}),watch:{model:{handler:function(t){for(var e in t)t[e]||this.$delete(t,e)},deep:!0}},methods:{modelClean:function(t){return 1==Object.keys(t).length},modelReadonly:function(t){return!!t.frozen_at||t.verified&&!this.isAdmin}}},cr=r(8322),ur=r(4187),dr=se.Z(lr,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"-row-compact"},[t.form.schema.multiple?[t._l(t.models,(function(e,n){var i=e.data;return[t._l(t.rows,(function(a,o){return r("v-row",{key:""+n+o},t._l(a,(function(n){return r("item",{key:n.id,attrs:{form:t.form,item:n,items:t.items,model:i,modelClean:t.modelClean(i),readonly:t.modelReadonly(e),validationDisabled:t.validationDisabled}})})),1)})),t._v(" "),t.form.schema.multiple?r("v-row",{key:n,staticClass:"form-footer"},[r("v-col",[t.noDate?t._e():r("v-text-field",{attrs:{label:t.$t("Дата"),rules:t.modelClean(i)?[]:[t.rules.required],readonly:t.modelReadonly(e),clearable:!t.modelReadonly(e),type:"datetime-local",min:"2022-01-01T00:00"},model:{value:e.approved_at&&new Date(new Date(e.approved_at).getTime()-6e4*(new Date).getTimezoneOffset()).toISOString().substring(0,16),callback:function(r){t.$set(e,"approved_at",new Date(r).toISOString())},expression:"model.approved_at"}})],1),t._v(" "),t.form.schema.templates?r("v-col",{staticClass:"flex-grow-0 align-self-center"},[r("v-btn",{attrs:{icon:"",href:Ie()("//".concat(location.host,"/download/form-document/".concat(t.form.projects[0].id,"/").concat(t.$route.params.id,"/").concat(t.form.id,"/").concat(n))),title:t.$t("Скачать документ")},on:{click:function(t){}}},[r("v-icon",[t._v(t._s(t.icons.mdiCloudDownloadOutline))])],1)],1):t._e(),t._v(" "),r("v-col",[t.modelReadonly(e)?t._e():r("v-file-input",{attrs:{accept:"image/jpeg","prepend-icon":t.icons.mdiCameraOutline,label:t.$t("Загрузить изображение")},model:{value:i.file,callback:function(e){t.$set(i,"file",e)},expression:"model.file"}})],1),t._v(" "),i.images&&i.images.length?r("v-col",{staticClass:"flex-grow-0 align-self-center"},[r("v-btn",{attrs:{icon:"",href:"/storage/"+i.images[0],title:t.$t("Открыть изображение")},on:{click:function(e){e.preventDefault(),t.imageOverlay="/storage/"+i.images[0]}}},[r("v-icon",[t._v(t._s(t.icons.mdiEyeOutline))])],1)],1):t._e(),t._v(" "),(i.file||i.images&&i.images.length)&&t.isAdmin?r("v-col",[r("v-checkbox",{attrs:{label:t.$t("Изображение соответствует"),"hide-details":""},model:{value:i.verified,callback:function(e){t.$set(i,"verified",e)},expression:"model.data.verified"}})],1):t._e(),t._v(" "),!i.verified||t.isAdmin?r("v-col",{staticClass:"flex-grow-0 align-self-center"},[r("v-btn",{attrs:{icon:"",title:t.$t("Удалить")},on:{click:function(e){e.stopPropagation(),t.deleteModel=n,t.confirmDelete=!0}}},[r("v-icon",[t._v(t._s(t.icons.mdiDeleteOutline))])],1)],1):t._e()],1):t._e()]})),t._v(" "),r("v-dialog",{attrs:{"max-width":"320"},model:{value:t.confirmDelete,callback:function(e){t.confirmDelete=e},expression:"confirmDelete"}},[r("v-card",[r("v-card-title",[t._v(t._s(t.$t("Подтверждение")))]),t._v(" "),r("v-card-text",[t._v(t._s(t.$t("Документ будет удален. Продолжить?")))]),t._v(" "),r("v-card-actions",[r("v-spacer"),t._v(" "),r("v-btn",{attrs:{text:""},on:{click:function(e){t.confirmDelete=!1}}},[t._v(t._s(t.$t("Отменить")))]),t._v(" "),r("v-btn",{attrs:{color:"error",dark:""},on:{click:function(e){t.models.splice(t.deleteModel,1),t.confirmDelete=!1}}},[t._v(t._s(t.$t("Удалить")))])],1)],1)],1),t._v(" "),r("v-overlay",{attrs:{value:!!t.imageOverlay},nativeOn:{click:function(e){t.imageOverlay=null}}},[r("v-img",{attrs:{src:t.imageOverlay,contain:""}})],1)]:[r("results",{attrs:{data:t.models[0].data}})].concat(t._l(t.rows,(function(e,n){return r("v-row",{key:n},t._l(e,(function(e){return r("item",{key:e.id,attrs:{item:e,items:t.items,model:t.models[0].data,modelClean:t.modelClean(t.models[0].data),readonly:t.modelReadonly(e,t),validationDisabled:t.validationDisabled}})})),1)})))],2)}),[],!1,null,"fb0a8ab2",null),mr=dr.exports;ce()(dr,{VBtn:ue.Z,VCard:de.Z,VCardActions:me.h7,VCardText:me.ZB,VCardTitle:me.EB,VCheckbox:fe.Z,VCol:ve.Z,VDialog:Ye.Z,VFileInput:ye.Z,VIcon:$e.Z,VImg:cr.Z,VOverlay:ur.Z,VRow:_e.Z,VSpacer:je.Z,VTextField:ge.Z});var fr=r(2894);function vr(t,e,r,n,i,a,o){try{var s=t[a](o),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(n,i)}var pr={props:["endpoint","id"],data:function(){return{headers:[{text:this.$t("Сотрудник"),value:"name",class:"text-no-wrap",sortable:!1,width:"100%"},{text:this.$t("Услуги"),value:"timing",sortable:!1},{text:this.$t("Деятельность в интересах клиента"),value:"timingOther",sortable:!1}],loading:!1,stats:[]}},watch:{id:{handler:function(){var t,e=this;return(t=Ut().mark((function t(){var r;return Ut().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!parseInt(e.id)){t.next=16;break}return e.loading=!0,t.prev=2,t.next=5,e.axios.get("".concat(e.endpoint,"/").concat(e.id,"/client-stats"));case 5:r=t.sent,e.stats=r.data,t.next=13;break;case 9:return t.prev=9,t.t0=t.catch(2),console.error(t.t0),t.abrupt("return");case 13:return t.prev=13,e.loading=!1,t.finish(13);case 16:case"end":return t.stop()}}),t,null,[[2,9,13,16]])})),function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function o(t){vr(a,n,i,o,s,"next",t)}function s(t){vr(a,n,i,o,s,"throw",t)}o(void 0)}))})()},immediate:!0}},methods:{getInterval:function(t){return fr.nL.fromObject({seconds:t}).toFormat("hh:mm:ss")}}},hr=se.Z(pr,(function(){var t=this,e=t.$createElement;return(t._self._c||e)("v-data-table",{attrs:{headers:t.headers,items:t.stats,loading:t.loading,"hide-default-footer":""},scopedSlots:t._u([{key:"item.timing",fn:function(e){var r=e.item;return[r.timingsCount?[t._v("\n            "+t._s(r.timingsCount)+"\n            ("+t._s(t.getInterval(r.timing))+")\n         ")]:t._e()]}},{key:"item.timingOther",fn:function(e){var r=e.item;return[r.timingOther?[t._v("\n            "+t._s(t.getInterval(r.timingOther))+"\n         ")]:t._e()]}}])})}),[],!1,null,null,null),br=hr.exports;function _r(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return gr(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?gr(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function gr(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function yr(t,e,r,n,i,a,o){try{var s=t[a](o),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(n,i)}function xr(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function o(t){yr(a,n,i,o,s,"next",t)}function s(t){yr(a,n,i,o,s,"throw",t)}o(void 0)}))}}function wr(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function kr(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?wr(Object(r),!0).forEach((function(e){$r(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):wr(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function $r(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}ce()(hr,{VDataTable:Me.Z});var jr={mixins:[vt.Z,ie],components:{subform:mr,stats:br},props:{id:null,role:String},metaInfo:function(){return{title:this.title}},data:function(){return{statusNames:Je,endpoint:"users",working:!1,form:new(ee())({id:null,email:null,phone:null,roles:[],password:null,profile:{"":[{data:{}}]},projects:[],location:null}),croppa:null,name:null,projects:[],projectsLoading:!1,locations:[],locationsLoading:!1,allForms:[],tab:null,activities:[],headers:[{sortable:!1,value:"actions",width:1},{text:this.$t("Проект"),value:"project.name",class:"text-no-wrap"},{text:this.$t("Услуга"),value:"service",class:"text-no-wrap"},{text:this.$t("Начало"),value:"start_date",class:"text-no-wrap"},{text:this.$t("Окончание"),value:"end_date",class:"text-no-wrap"},{text:this.$t("Описание"),value:"title",class:"text-no-wrap"},{text:this.$t("Комментарии"),value:"comments",class:"text-no-wrap",sortable:!1},{text:this.$t("Исполнитель"),value:"implementer",class:"text-no-wrap"},{text:this.$t("Изменено"),value:"updated_at",class:"text-no-wrap"}],confirm:!1,itemId:null}},computed:kr(kr({title:function(){return"add"==this.id?"Создание профиля":this.name||"Изменение профиля"}},Nt.Se(["user"])),{},{photo:function(){var t=this.form.profile[""][0].data.photo;return t&&"/storage/".concat(t)},roles:function(){return qe.filter((function(t){return"client"!=t.value}))},formsForRoles:function(){var t=this;return this.allForms.filter((function(e){return e.roles.filter((function(e){return t.form.roles.includes(e)})).length&&(e.id<12||e.id>23||54!=e.id||[1,2,5,43,6721].includes(t.user.id))}))},forms:function(){return this.formsForRoles.filter((function(t){return!t.schema.basic}))},basicForms:function(){return this.formsForRoles.filter((function(t){return t.schema.basic}))},isClient:function(){return this.form.roles.includes("client")},isSuperuser:function(){return this.user.roles.includes("superuser")}}),watch:{id:{handler:function(){"self"==this.id&&(this.id=this.user.id),parseInt(this.id)&&this.fetchRecord(),this.fetchProjects()},immediate:!0},role:{handler:function(t){t&&!this.form.roles.length&&this.form.roles.push(t)},immediate:!0},"form.projects":function(t){t.length?(this.fetchForms(),this.fetchLocations()):(this.allForms=[],this.locations=[])}},methods:{fetchForms:function(){var t=this;return xr(Ut().mark((function e(){var r;return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.formsLoading=!0,e.prev=1,e.next=4,t.axios.get("forms",{params:{itemsPerPage:-1,forProjects:t.form.projects}});case 4:r=e.sent,t.allForms=r.data.data,e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(1),console.error(e.t0),e.abrupt("return");case 12:return e.prev=12,t.formsLoading=!1,e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,8,12,15]])})))()},fetchProjects:function(){var t=this;return xr(Ut().mark((function e(){var r,n,i,a;return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.projectsLoading=!0,e.prev=1,e.next=4,t.axios.get("projects",{params:{itemsPerPage:-1,forUser:t.id}});case 4:r=e.sent,n=_r(r.data.data);try{for(n.s();!(i=n.n()).done;)(a=i.value).disabled=a.project_users&&!!a.project_users.length}catch(t){n.e(t)}finally{n.f()}t.projects=r.data.data,1!=t.projects.length||t.form.projects.length||t.form.projects.push(t.projects[0].id),e.next=15;break;case 11:return e.prev=11,e.t0=e.catch(1),console.error(e.t0),e.abrupt("return");case 15:return e.prev=15,t.projectsLoading=!1,e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[1,11,15,18]])})))()},fetchLocations:function(){var t=this;return xr(Ut().mark((function e(){var r,n,i,a;return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.locationsLoading=!0,e.prev=1,e.next=4,t.axios.get("locations",{params:{itemsPerPage:-1,forProjects:t.form.projects}});case 4:r=e.sent,n=_r(r.data.data);try{for(n.s();!(i=n.n()).done;)(a=i.value).disabled=a.project_users&&!!a.project_users.length}catch(t){n.e(t)}finally{n.f()}t.locations=r.data.data,1!=t.locations.length||t.form.location||(t.form.location=t.locations[0].id),e.next=15;break;case 11:return e.prev=11,e.t0=e.catch(1),console.error(e.t0),e.abrupt("return");case 15:return e.prev=15,t.locationsLoading=!1,e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[1,11,15,18]])})))()},fetchRecord:function(){var t=this;return xr(Ut().mark((function e(){var r,n;return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.working=!0,e.prev=1,e.next=4,t.axios.get("".concat(t.endpoint,"/").concat(t.id));case 4:for(n in(r=e.sent).data.profile.basic&&(r.data.profile[""]=[{data:r.data.profile.basic}],delete r.data.profile.basic),r.data.profile)Array.isArray(r.data.profile[n])&&!r.data.profile[n].length&&delete r.data.profile[n];r.data.projects=r.data.projects.map((function(t){return t.id})),r.data.location=r.data.location&&r.data.location.id,t.form.fill(r.data),t.croppa.refresh(),t.activities=r.data.activities,t.name=r.data.name,e.next=19;break;case 15:return e.prev=15,e.t0=e.catch(1),console.error(e.t0),e.abrupt("return");case 19:return e.prev=19,t.working=!1,e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[1,15,19,22]])})))()},save:function(){var t=this;return xr(Ut().mark((function e(){var r,n,i,a,o,s,l,c,u,d,m;return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.form.clear(),t.$refs.form.validate()){e.next=3;break}return e.abrupt("return");case 3:if(t.working=!0,!t.croppa.hasImage()){e.next=16;break}if(!(n=t.croppa.getChosenFile())){e.next=14;break}return(r=new FormData).append("originalPhoto",n),e.t0=r,e.next=12,t.croppa.promisedBlob("image/jpeg");case 12:e.t1=e.sent,e.t0.append.call(e.t0,"photo",e.t1);case 14:e.next=17;break;case 16:t.form.profile[""][0].data.photo&&(r=new FormData).append("removePhoto",null);case 17:i=0,a=_r(t.forms);try{!function(){var e=0;for(a.s();!(o=a.n()).done;){var n=o.value;if(t.form.profile[n.id]){s=_r(t.form.profile[n.id]);try{for(s.s();!(l=s.n()).done;){(c=l.value.data).file&&(r||(r=new FormData),r.append("images[]",c.file),delete c.file,c.upload=i++);var u=function(t){t&&t.file&&t.file instanceof File&&(r||(r=new FormData),r.append("files[]",t.file),t.file=t.original,t.upload=e++,delete t.original)},d=function(t){var e=n.schema.items.find((function(e){return e.id==t}));if(e&&"file"==e.type)if(e.repeatable){var r,i=qt(c[t]);try{for(i.s();!(r=i.n()).done;){var a=r.value;u(a)}}catch(t){i.e(t)}finally{i.f()}}else u(c[t])};for(var m in c)d(m)}}catch(t){s.e(t)}finally{s.f()}}}}()}catch(t){a.e(t)}finally{a.f()}if(!parseInt(t.id)){e.next=41;break}return e.prev=21,e.next=24,t.form.submit("put","".concat(t.endpoint,"/").concat(t.id));case 24:if(e.next=27,!(r||!t.croppa.hasImage()&&t.form.profile[""][0].data.photo))break;return t.axios.patch("".concat(t.endpoint,"/").concat(t.id),r);case 27:u=e.sent,t.form.profile=u.data.profile;case 29:t.$store.dispatch("notification",{type:"success",text:t.$t("Профиль обновлён")}),e.next=36;break;case 32:return e.prev=32,e.t2=e.catch(21),console.error(e.t2),e.abrupt("return");case 36:return e.prev=36,t.working=!1,e.finish(36);case 39:e.next=61;break;case 41:return e.prev=41,e.next=44,t.form.submit("post",t.endpoint);case 44:if(d=e.sent,t.form.id=d.data.id,!r){e.next=51;break}return e.next=49,t.axios.patch("".concat(t.endpoint,"/").concat(t.id),r);case 49:m=e.sent,t.form.profile=m.data.profile;case 51:t.$router.replace({name:t.role?"clients.form":"".concat(t.endpoint,".form"),params:{id:t.form.id,role:t.role}}),t.$store.dispatch("notification",{type:"success",text:t.$t("Профиль создан")}),e.next=58;break;case 55:return e.prev=55,e.t3=e.catch(41),e.abrupt("return");case 58:return e.prev=58,t.working=!1,e.finish(58);case 61:case"end":return e.stop()}}),e,null,[[21,32,36,39],[41,55,58,61]])})))()},deleteItem:function(t){this.itemId=t.id,this.confirm=!0},deleteConfirmed:function(){var t=this;return xr(Ut().mark((function e(){return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.working=!0,e.next=3,t.axios.delete("activities/".concat(t.itemId));case 3:t.working=!1,t.confirm=!1,t.fetchRecord();case 6:case"end":return e.stop()}}),e)})))()},getServices:function(t){var e=this;return t.all_users.filter((function(t){return t.user_id==e.id})).map((function(t){return t.part.description})).join(", ")},getImplementers:function(t){return t.all_users.filter((function(t){return"implementer"==t.role})).map((function(t){return t.user.name})).join(", ")},namesPasted:function(t){var e=t.clipboardData.getData("Text");e&&e.replaceAll&&(2!=(e=e.replaceAll(/\s+/g," ").trim().split(" ")).length&&3!=e.length||(this.$set(this.form.profile[""][0].data,"last_name",e[0]),this.$set(this.form.profile[""][0].data,"first_name",e[1]),e[2]?this.$set(this.form.profile[""][0].data,"middle_name",e[2]):this.$delete(this.form.profile[""][0].data,"middle_name"),t.preventDefault()))}}},Or=se.Z(jr,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-container",[r("v-form",{ref:"form",on:{submit:function(e){return e.preventDefault(),t.save(e)}}},[r("v-toolbar",{attrs:{elevation:"0"}},[r("v-toolbar-title",[t._v(t._s(t.title))]),t._v(" "),r("v-spacer"),t._v(" "),r("v-btn",{staticClass:"ml-12",attrs:{type:"submit",color:"secondary",dark:"",disabled:t.working}},[t._v(t._s(t.$t("Сохранить")))]),t._v(" "),r("v-btn",{attrs:{color:"secondary",text:"",disabled:t.working},on:{click:function(e){return t.$router.go(-1)}}},[t._v(t._s(t.$t("Назад")))])],1),t._v(" "),r("v-tabs",{model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[t.isClient&&t.form.id?r("v-tab",{attrs:{href:"#1"}},[t._v(t._s(t.$t("План / история")))]):t._e(),t._v(" "),r("v-tab",{attrs:{href:"#2"}},[t._v(t._s(t.$t("Основные сведения")))]),t._v(" "),t._l(t.forms,(function(e,n){return r("v-tab",{key:n,attrs:{href:"#"+(n+3)}},[t._v(t._s(e.name))])})),t._v(" "),t.isClient&&t.form.id?r("v-tab",{attrs:{href:"#"+(t.forms.length+3)}},[t._v(t._s(t.$t("Статистика")))]):t._e()],2),t._v(" "),r("v-tabs-items",{model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[t.isClient&&t.form.id?r("v-tab-item",{attrs:{transition:"false","reverse-transition":"false",value:"1"}},[r("v-data-table",{attrs:{headers:t.headers,items:t.activities},scopedSlots:t._u([{key:"item.actions",fn:function(e){var n=e.item;return[r("div",{staticClass:"text-no-wrap"},[r("v-btn",{attrs:{icon:"",href:t.$router.resolve({name:"activities.form",params:{id:n.id}}).href,title:t.$t("Редактировать")},on:{click:function(e){return e.preventDefault(),t.$router.push({name:"activities.form",params:{id:n.id}})}}},[r("v-icon",[t._v(t._s(t.icons.mdiPencilOutline))])],1),t._v(" "),n.deletable?r("v-btn",{attrs:{icon:"",title:t.$t("Удалить")},on:{click:function(e){return e.stopPropagation(),t.deleteItem(n)}}},[r("v-icon",[t._v(t._s(t.icons.mdiDeleteOutline))])],1):t._e()],1)]}},{key:"item.service",fn:function(e){var r=e.item;return[t._v("\n                        "+t._s(t.getServices(r))+"\n                    ")]}},{key:"item.implementer",fn:function(e){var r=e.item;return[t._v("\n                        "+t._s(t.getImplementers(r))+"\n                    ")]}},{key:"item.status",fn:function(e){var r=e.item.status;return[t._v("\n                        "+t._s(r&&t.statusNames[r])+"\n                    ")]}},{key:"item.comments",fn:function(e){var n=e.item;return[t._l(n.timings,(function(e){return[t._v("\n                            "+t._s(e.comment)+"\n                            "),r("br")]}))]}},{key:"item.start_date",fn:function(e){var r=e.item;return[t._v("\n                        "+t._s(r.start_date)+" "+t._s(r.start_time)+"\n                    ")]}},{key:"item.end_date",fn:function(e){var r=e.item;return[t._v("\n                        "+t._s(r.end_date)+" "+t._s(r.end_time)+"\n                    ")]}},{key:"item.updated_at",fn:function(e){var r=e.item;return[t._v("\n                        "+t._s(new Date(r.updated_at).toLocaleString())+"\n                    ")]}}],null,!1,421142760)}),t._v(" "),r("v-btn",{attrs:{fab:"",color:"primary",fixed:"",bottom:""},on:{click:function(e){return t.$router.push({name:"activities.form",params:{id:"add",client:t.id}})}}},[r("v-icon",[t._v(t._s(t.icons.mdiPlus))])],1)],1):t._e(),t._v(" "),r("v-tab-item",{attrs:{transition:"false","reverse-transition":"false",value:"2"}},[r("v-row",[r("v-col",[r("v-row",[r("v-col",[r("v-text-field",{attrs:{label:t.$t("Фамилия"),rules:[t.rules.required],"error-messages":t.errors("profile..0.data.last_name")},on:{paste:t.namesPasted},model:{value:t.form.profile[""][0].data.last_name,callback:function(e){t.$set(t.form.profile[""][0].data,"last_name",e)},expression:'form.profile[""][0].data.last_name'}})],1),t._v(" "),r("v-col",[r("v-text-field",{attrs:{label:t.$t("Имя"),rules:[t.rules.required],"error-messages":t.errors("profile..0.data.first_name")},model:{value:t.form.profile[""][0].data.first_name,callback:function(e){t.$set(t.form.profile[""][0].data,"first_name",e)},expression:'form.profile[""][0].data.first_name'}})],1),t._v(" "),r("v-col",[r("v-text-field",{attrs:{label:t.$t("Отчество")},model:{value:t.form.profile[""][0].data.middle_name,callback:function(e){t.$set(t.form.profile[""][0].data,"middle_name",e)},expression:'form.profile[""][0].data.middle_name'}})],1)],1),t._v(" "),r("v-row",[r("v-col",[r("v-text-field",{directives:[{name:"mask",rawName:"v-mask",value:"+998 ## ### ## ##",expression:"'+998 ## ### ## ##'"}],attrs:{type:"tel",label:t.$t("Телефон"),rules:[t.rules.length(17)],"error-messages":t.errors("phone")},model:{value:t.form.phone,callback:function(e){t.$set(t.form,"phone",e)},expression:"form.phone"}})],1),t._v(" "),r("v-col",[r("v-text-field",{attrs:{type:"email",label:t.$t("E-mail"),"error-messages":t.errors("email")},model:{value:t.form.email,callback:function(e){t.$set(t.form,"email",e)},expression:"form.email"}})],1)],1),t._v(" "),t.role?r("v-row",[r("v-col",[r("v-autocomplete",{attrs:{loading:t.projectsLoading,items:t.projects,label:t.$t("Проекты"),rules:[t.rules.required],"item-value":"id","item-text":"name",multiple:""},model:{value:t.form.projects,callback:function(e){t.$set(t.form,"projects",e)},expression:"form.projects"}})],1),t._v(" "),r("v-col",[r("v-autocomplete",{attrs:{loading:t.locationsLoading,items:t.locations,label:t.$t("Регион"),rules:[t.rules.required],"item-value":"id","item-text":"name"},model:{value:t.form.location,callback:function(e){t.$set(t.form,"location",e)},expression:"form.location"}})],1)],1):t._e(),t._v(" "),t.role?t._e():r("v-row",[r("v-col",{attrs:{cols:"8"}},[r("v-select",{attrs:{label:t.$t("Роли"),rules:[t.rules.required],items:t.roles,"error-messages":t.errors("roles"),multiple:""},model:{value:t.form.roles,callback:function(e){t.$set(t.form,"roles",e)},expression:"form.roles"}})],1),t._v(" "),r("v-col",[r("v-text-field",{attrs:{label:t.$t("Пароль"),"error-messages":t.errors("password"),type:"text"},model:{value:t.form.password,callback:function(e){t.$set(t.form,"password",e)},expression:"form.password"}})],1)],1)],1),t._v(" "),r("v-col",{attrs:{cols:"3",align:"center"}},[r("croppa",{attrs:{width:200,height:200,"canvas-color":"rgba(0, 0, 0, 0.02)","placeholder-color":"rgba(0, 0, 0, 0.5)","placeholder-font-size":16,placeholder:t.$t("Загрузить..."),"show-remove-button":!1,"zoom-speed":20,"initial-image":t.photo,quality:1,"prevent-white-space":!0,accept:"image/*"},model:{value:t.croppa,callback:function(e){t.croppa=e},expression:"croppa"}}),t._v(" "),t.croppa&&t.croppa.hasImage()?r("v-btn",{attrs:{color:"error"},on:{click:function(e){return t.croppa.remove()}}},[t._v(t._s(t.$t("Удалить фото")))]):t._e()],1)],1),t._v(" "),t._l(t.basicForms,(function(e){return r("subform",{key:e.id,attrs:{form:e,data:t.form.profile}})}))],2),t._v(" "),t._l(t.forms,(function(e,n){return r("v-tab-item",{key:e.id,attrs:{transition:"false","reverse-transition":"false",value:(n+3).toString()}},[r("subform",{attrs:{form:e,data:t.form.profile}})],1)})),t._v(" "),r("v-tab-item",{attrs:{transition:"false","reverse-transition":"false",value:(t.forms.length+3).toString()}},[r("stats",{attrs:{endpoint:this.endpoint,id:this.id}})],1)],2)],1),t._v(" "),t.forms[t.tab-3]&&t.forms[t.tab-3].schema.multiple?r("v-btn",{attrs:{fab:"",fixed:"",bottom:"",color:"primary"},on:{click:function(e){t.form.profile[t.forms[t.tab-3].id].unshift({data:{images:null}})}}},[r("v-icon",[t._v(t._s(t.icons.mdiPlus))])],1):t._e(),t._v(" "),r("v-dialog",{attrs:{"max-width":"320"},model:{value:t.confirm,callback:function(e){t.confirm=e},expression:"confirm"}},[r("v-card",[r("progress-bar",{attrs:{show:t.working}}),t._v(" "),r("v-card-title",[t._v(t._s(t.$t("Подтверждение")))]),t._v(" "),r("v-card-text",[t._v(t._s(t.$t("Запись будет удалена. Продолжить?")))]),t._v(" "),r("v-card-actions",[r("v-spacer"),t._v(" "),r("v-btn",{attrs:{text:""},on:{click:function(e){t.confirm=!1}}},[t._v(t._s(t.$t("Отменить")))]),t._v(" "),r("v-btn",{attrs:{color:"error",dark:""},on:{click:t.deleteConfirmed}},[t._v(t._s(t.$t("Удалить")))])],1)],1)],1)],1)}),[],!1,null,null,null),Dr=Or.exports;function Pr(t,e,r,n,i,a,o){try{var s=t[a](o),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(n,i)}function Cr(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function o(t){Pr(a,n,i,o,s,"next",t)}function s(t){Pr(a,n,i,o,s,"throw",t)}o(void 0)}))}}function Zr(t){return function(t){if(Array.isArray(t))return Vr(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Vr(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Vr(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Vr(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Sr(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Tr(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Sr(Object(r),!0).forEach((function(e){Ir(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Sr(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Ir(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}ce()(Or,{VAutocomplete:ke.Z,VBtn:ue.Z,VCard:de.Z,VCardActions:me.h7,VCardText:me.ZB,VCardTitle:me.EB,VCol:ve.Z,VContainer:pe.Z,VDataTable:Me.Z,VDialog:Ye.Z,VForm:he.Z,VIcon:$e.Z,VRow:_e.Z,VSelect:Se.Z,VSpacer:je.Z,VTab:Oe.Z,VTabItem:De.Z,VTabs:Pe.Z,VTabsItems:Ce.Z,VTextField:ge.Z,VToolbar:Ze.Z,VToolbarTitle:Ve.qW});var qr={mixins:[ie],metaInfo:function(){return{title:this.title}},data:function(){return{statusNames:Je,endpoint:"services",total:0,items:[],loading:!1,options:{},projectsLoading:!1,projects:[],locations:[],locationsLoading:!1,usersLoading:!1,users:[],partsLoading:!1,parts:[],filters:{search:null,parts:[],from:null,till:null,projects:[],locations:[],users:[]},working:!1,confirm:!1,itemId:null}},computed:Tr(Tr({title:function(){return this.$t("Услуги")+(this.total?" (".concat(this.$t("найдено")," ").concat(this.total,")"):"")}},Nt.Se(["user"])),{},{isSuperuser:function(){return this.user.roles.includes("superuser")},downloadUrl:function(){return Ie()("//".concat(location.host,"/download").concat(location.pathname),this.filters)},headers:function(){return[{text:this.$t("Проект"),value:"project",class:"text-no-wrap",sortable:!1}].concat(Zr(1==this.filters.locations.length?[]:[{text:this.$t("Регион"),value:"location",class:"text-no-wrap",sortable:!1}]),[{text:this.$t("Клиент"),value:"client",class:"text-no-wrap",sortable:!1},{text:this.$t("Услуга"),value:"service",class:"text-no-wrap",sortable:!1},{text:this.$t("Описание"),value:"title",class:"text-no-wrap"},{text:this.$t("Комментарии"),value:"comments",class:"text-no-wrap",sortable:!1}],Zr(this.isSuperuser||[4545].includes(this.user.id)?[{text:this.$t("Сотрудник"),value:"employee",class:"text-no-wrap",sortable:!1}]:[]),[{text:this.$t("Дата"),value:"start_date",class:"text-no-wrap"}],[{text:this.$t("Время"),value:"start_time",class:"text-no-wrap"}])}}),watch:{options:{handler:function(){this.fetchDataDebounced()},deep:!0},"filters.projects":function(){this.fetchUsers(),this.fetchLocations(),this.fetchParts()},ready:function(){this.fetchData()},"$route.query":function(t){Object.keys(t).length||(this.filters=Jt.pick(this.filters,Object.keys({search:null,parts:[],from:null,till:null,projects:[],locations:[],users:[]})))}},created:function(){var t=this;this.fetchProjects(),this.fetchLocations(),this.fetchUsers(),this.fetchParts();var e=function(e){var r=t.$route.query;if(r[e])for(var n in Array.isArray(r[e])||(r[e]=[r[e]]),r[e])r[e][n]=+r[e][n]};e("projects"),e("locations"),e("users"),e("parts"),Object.assign(this.filters,this.$route.query),this.$watch("filters",(function(e){t.options.page=1,t.fetchDataDebounced(),t.$router.replace({query:Jt.pickBy(e)})}),{deep:!0}),this.fetchDataDebounced=Jt.debounce(this.fetchData,1e3)},methods:{fetchProjects:function(){var t=this;return Cr(Ut().mark((function e(){var r;return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.projectsLoading=!0,e.prev=1,e.next=4,t.axios.get("projects",{params:{itemsPerPage:-1}});case 4:r=e.sent,t.projects=r.data.data,e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(1),console.error(e.t0),e.abrupt("return");case 12:return e.prev=12,t.projectsLoading=!1,e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,8,12,15]])})))()},fetchLocations:function(){var t=this;return Cr(Ut().mark((function e(){var r;return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.locationsLoading=!0,e.prev=1,e.next=4,t.axios.get("locations",{params:{withPositions:1,projects:t.filters.projects,itemsPerPage:-1}});case 4:r=e.sent,t.locations=r.data.data,e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(1),console.error(e.t0),e.abrupt("return");case 12:return e.prev=12,t.locationsLoading=!1,e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,8,12,15]])})))()},fetchUsers:function(){var t=this;return Cr(Ut().mark((function e(){var r;return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.usersLoading=!0,e.prev=1,e.next=4,t.axios.get("users",{params:{withPositions:1,projects:t.filters.projects,itemsPerPage:-1}});case 4:r=e.sent,t.users=r.data.data,e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(1),console.error(e.t0),e.abrupt("return");case 12:return e.prev=12,t.usersLoading=!1,e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,8,12,15]])})))()},fetchParts:function(){var t=this;return Cr(Ut().mark((function e(){var r;return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.partsLoading=!0,e.prev=1,e.next=4,t.axios.get("parts",{params:{forProjects:t.filters.projects}});case 4:r=e.sent,t.parts=r.data,e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(1),console.error(e.t0),e.abrupt("return");case 12:return e.prev=12,t.partsLoading=!1,e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,8,12,15]])})))()},fetchData:function(){var t=this;return Cr(Ut().mark((function e(){var r;return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.loading=!0,e.next=3,t.axios.get(t.endpoint,{params:Tr(Tr({},t.options),t.filters)});case 3:r=e.sent,t.items=r.data.data,t.total=r.data.total,t.loading=!1;case 7:case"end":return e.stop()}}),e)})))()},deleteItem:function(t){this.itemId=t.id,this.confirm=!0},deleteConfirmed:function(){var t=this;return Cr(Ut().mark((function e(){return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.working=!0,e.next=3,t.axios.delete("".concat(t.endpoint,"/").concat(t.itemId));case 3:t.working=!1,t.confirm=!1,t.fetchData();case 6:case"end":return e.stop()}}),e)})))()},getDuration:function(t){var e=fr.ou.fromSQL(t.ended_at).diff(fr.ou.fromSQL(t.began_at),["hours","minutes","seconds"]).values;return"".concat(("0"+e.hours).substring(-2),":").concat(("0"+e.minutes).substring(-2),":").concat(("0"+e.seconds).substring(-2))},verifyItem:function(t){var e=this;return Cr(Ut().mark((function r(){return Ut().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e.working=!0,r.next=3,e.axios.put("".concat(e.endpoint,"/").concat(t.id),{verified:1});case 3:e.working=!1,e.confirm=!1,e.fetchData();case 6:case"end":return r.stop()}}),r)})))()},getClient:function(t){return t.all_users.filter((function(t){return"client"==t.role})).map((function(t){return t.user.name})).join(", ")},getService:function(t){var e=t.all_users.filter((function(t){return"client"==t.role}));return e[0]&&e[0].part.description}}},Ar=se.Z(qr,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-container",{attrs:{fluid:""}},[r("v-row",[r("v-col",[r("v-toolbar",{attrs:{elevation:"0"}},[r("v-toolbar-title",[t._v(t._s(t.title))]),t._v(" "),r("v-spacer"),t._v(" "),r("v-btn",{attrs:{icon:"",title:t.$t("Скачать"),target:"_blank",href:t.downloadUrl}},[r("v-icon",[t._v(t._s(t.icons.mdiCloudDownloadOutline))])],1)],1)],1)],1),t._v(" "),r("v-row",[r("v-col",[r("v-text-field",{staticClass:"mt-0 pt-0",attrs:{label:"Поиск","single-line":"","hide-details":""},model:{value:t.filters.search,callback:function(e){t.$set(t.filters,"search",e)},expression:"filters.search"}})],1),t._v(" "),r("v-col",[r("v-autocomplete",{staticClass:"mt-0 pt-0",attrs:{label:t.$t("Проекты"),loading:t.projectsLoading,items:t.projects,"item-text":"name","item-value":"id",multiple:"",clearable:"","single-line":"","hide-details":""},model:{value:t.filters.projects,callback:function(e){t.$set(t.filters,"projects",e)},expression:"filters.projects"}})],1),t._v(" "),r("v-col",[r("v-autocomplete",{staticClass:"mt-0 pt-0",attrs:{label:t.$t("Регионы"),loading:t.locationsLoading,items:t.locations,"item-text":"code","item-value":"id",multiple:"",clearable:"","single-line":"","hide-details":""},model:{value:t.filters.locations,callback:function(e){t.$set(t.filters,"locations",e)},expression:"filters.locations"}})],1),t._v(" "),t.user.can.list_services_by_user?r("v-col",[r("v-autocomplete",{staticClass:"mt-0 pt-0",attrs:{label:t.$t("Сотрудники"),loading:t.usersLoading,items:t.users,"item-text":"name","item-value":"id",multiple:"",clearable:"","single-line":"","hide-details":""},model:{value:t.filters.users,callback:function(e){t.$set(t.filters,"users",e)},expression:"filters.users"}})],1):t._e(),t._v(" "),r("v-col",[r("v-autocomplete",{staticClass:"mt-0 pt-0",attrs:{label:t.$t("Услуги"),loading:t.partsLoading,items:t.parts,"item-text":"description","item-value":"id",multiple:"",clearable:"","single-line":"","hide-details":""},model:{value:t.filters.parts,callback:function(e){t.$set(t.filters,"parts",e)},expression:"filters.parts"}})],1),t._v(" "),r("v-col",[r("v-text-field",{staticClass:"mt-0 pt-0",attrs:{label:"Период с",type:"date","single-line":"","hide-details":"",clearable:""},model:{value:t.filters.from,callback:function(e){t.$set(t.filters,"from",e)},expression:"filters.from"}})],1),t._v(" "),r("v-col",[r("v-text-field",{staticClass:"mt-0 pt-0",attrs:{label:"Период по",type:"date","single-line":"","hide-details":"",clearable:""},model:{value:t.filters.till,callback:function(e){t.$set(t.filters,"till",e)},expression:"filters.till"}})],1)],1),t._v(" "),r("v-row",[r("v-col",[r("v-data-table",{attrs:{headers:t.headers,items:t.items,options:t.options,"server-items-length":t.total,loading:t.loading},on:{"update:options":function(e){t.options=e}},scopedSlots:t._u([{key:"item.actions",fn:function(e){var n=e.item;return[r("div",{staticClass:"text-no-wrap"},[!n.verified||t.isSuperuser?r("v-btn",{attrs:{icon:"",href:t.$router.resolve({name:"timings.form",params:{id:n.id}}).href,title:t.$t("Редактировать")},on:{click:function(e){return e.preventDefault(),t.$router.push({name:"timings.form",params:{id:n.id}})}}},[r("v-icon",[t._v(t._s(t.icons.mdiPencilOutline))])],1):t._e(),t._v(" "),!n.verified||t.isSuperuser?r("v-btn",{attrs:{icon:"",title:t.$t("Удалить")},on:{click:function(e){return e.stopPropagation(),t.deleteItem(n)}}},[r("v-icon",[t._v(t._s(t.icons.mdiDeleteOutline))])],1):t._e(),t._v(" "),!n.verified&&t.isSuperuser?r("v-btn",{attrs:{icon:"",title:t.$t("Верифицировать")},on:{click:function(e){return e.stopPropagation(),t.verifyItem(n)}}},[r("v-icon",[t._v(t._s(t.icons.mdiCheckDecagramOutline))])],1):t._e()],1)]}},{key:"item.employee",fn:function(e){var r=e.item;return[t._v("\n                    "+t._s(r.user.name)+"\n                ")]}},{key:"item.project",fn:function(e){var r=e.item;return[t._v("\n                    "+t._s(r.project.name)+"\n                ")]}},{key:"item.location",fn:function(e){var r=e.item;return[t._v("\n                    "+t._s(r.all_users&&r.all_users[0]&&r.all_users[0].project_user&&r.all_users[0].project_user.location?r.all_users[0].project_user.location.code:"")+"\n                ")]}},{key:"item.comments",fn:function(e){var n=e.item;return[t._l(n.timings,(function(e){return[t._v("\n                        "+t._s(e.comment)+"\n                        "),r("br")]}))]}},{key:"item.client",fn:function(e){var r=e.item;return[t._v("\n                    "+t._s(t.getClient(r))+"\n                ")]}},{key:"item.service",fn:function(e){var r=e.item;return[t._v("\n                    "+t._s(t.getService(r))+"\n                ")]}}])}),t._v(" "),r("v-btn",{attrs:{fab:"",color:"primary",absolute:""},on:{click:function(e){return t.$router.push({name:"activities.form",params:{id:"add"}})}}},[r("v-icon",[t._v(t._s(t.icons.mdiPlus))])],1)],1)],1),t._v(" "),r("v-dialog",{attrs:{"max-width":"320"},model:{value:t.confirm,callback:function(e){t.confirm=e},expression:"confirm"}},[r("v-card",[r("progress-bar",{attrs:{show:t.working}}),t._v(" "),r("v-card-title",[t._v(t._s(t.$t("Подтверждение")))]),t._v(" "),r("v-card-text",[t._v(t._s(t.$t("Запись будет удалена. Продолжить?")))]),t._v(" "),r("v-card-actions",[r("v-spacer"),t._v(" "),r("v-btn",{attrs:{text:""},on:{click:function(e){t.confirm=!1}}},[t._v(t._s(t.$t("Отменить")))]),t._v(" "),r("v-btn",{attrs:{color:"error",dark:""},on:{click:t.deleteConfirmed}},[t._v(t._s(t.$t("Удалить")))])],1)],1)],1)],1)}),[],!1,null,null,null),Er=Ar.exports;function Lr(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Rr(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Lr(Object(r),!0).forEach((function(e){Br(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Lr(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Br(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Ur(t,e,r,n,i,a,o){try{var s=t[a](o),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(n,i)}function Fr(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function o(t){Ur(a,n,i,o,s,"next",t)}function s(t){Ur(a,n,i,o,s,"throw",t)}o(void 0)}))}}ce()(Ar,{VAutocomplete:ke.Z,VBtn:ue.Z,VCard:de.Z,VCardActions:me.h7,VCardText:me.ZB,VCardTitle:me.EB,VCol:ve.Z,VContainer:pe.Z,VDataTable:Me.Z,VDialog:Ye.Z,VIcon:$e.Z,VRow:_e.Z,VSpacer:je.Z,VTextField:ge.Z,VToolbar:Ze.Z,VToolbarTitle:Ve.qW});var zr={mixins:[ie],metaInfo:function(){return{title:this.title}},data:function(){return{title:this.$t("Формы"),roleNames:Ae,roles:qe,endpoint:"forms",total:0,items:[],loading:!1,options:{search:null,projects:[]},headers:[{sortable:!1,value:"actions",width:1},{text:this.$t("Название"),value:"name"},{text:this.$t("Проекты"),value:"projects",sortable:!1},{text:this.$t("Для пользователей"),value:"roles"},{text:"Изменялась",value:"updated_at"}],search:null,from:null,till:null,working:!1,confirm:!1,itemId:null,projects:[],projectsLoading:!1}},computed:Nt.Se(["user"]),watch:{options:{handler:function(){this.fetchData()},deep:!0},search:function(){this.fetchDataDebounced()},ready:function(){this.fetchData()}},created:function(){this.fetchProjects(),this.fetchDataDebounced=Jt.debounce(this.fetchData,400),this.fetchData()},methods:{fetchData:function(){var t=this;return Fr(Ut().mark((function e(){var r;return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.loading=!0,e.next=3,t.axios.get(t.endpoint,{params:Rr(Rr({},t.options),{},{search:t.search})});case 3:r=e.sent,t.items=r.data.data,t.total=r.data.total,t.loading=!1;case 7:case"end":return e.stop()}}),e)})))()},fetchProjects:function(){var t=this;return mn(Ut().mark((function e(){var r;return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.projectsLoading=!0,e.prev=1,e.next=4,t.axios.get("projects",{params:{itemsPerPage:-1}});case 4:r=e.sent,t.projects=r.data.data,e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(1),console.error(e.t0),e.abrupt("return");case 12:return e.prev=12,t.projectsLoading=!1,e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,8,12,15]])})))()},deleteItem:function(t){this.itemId=t.id,this.confirm=!0},deleteConfirmed:function(){var t=this;return Fr(Ut().mark((function e(){return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.working=!0,e.next=3,t.axios.delete("".concat(t.endpoint,"/").concat(t.itemId));case 3:t.working=!1,t.confirm=!1,t.fetchData();case 6:case"end":return e.stop()}}),e)})))()}}},Qr=se.Z(zr,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-container",[r("v-row",[r("v-col",[r("v-toolbar",{attrs:{elevation:"0"}},[r("v-toolbar-title",[t._v(t._s(t.title))]),t._v(" "),r("v-spacer"),t._v(" "),r("div",{staticClass:"d-flex"},[r("v-autocomplete",{staticClass:"mr-4",attrs:{label:t.$t("Проекты"),loading:t.projectsLoading,items:t.projects,"item-text":"name","item-value":"id",multiple:"",clearable:"","single-line":"","hide-details":""},model:{value:t.options.projects,callback:function(e){t.$set(t.options,"projects",e)},expression:"options.projects"}}),t._v(" "),r("v-select",{staticClass:"mr-4",attrs:{label:t.$t("Роль"),items:t.roles,clearable:"","hide-details":""},model:{value:t.options.role,callback:function(e){t.$set(t.options,"role",e)},expression:"options.role"}}),t._v(" "),r("v-text-field",{staticClass:"mr-4",attrs:{label:"Поиск","single-line":"","hide-details":""},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1)],1)],1)],1),t._v(" "),r("v-row",[r("v-col",[r("v-data-table",{attrs:{headers:t.headers,items:t.items,options:t.options,"server-items-length":t.total,loading:t.loading},on:{"update:options":function(e){t.options=e}},scopedSlots:t._u([{key:"item.actions",fn:function(e){var n=e.item;return[r("div",{staticClass:"text-no-wrap"},[r("v-btn",{attrs:{icon:"",href:t.$router.resolve({name:"forms.form",params:{id:n.id}}).href,title:t.$t("Редактировать")},on:{click:function(e){return e.preventDefault(),t.$router.push({name:"forms.form",params:{id:n.id}})}}},[r("v-icon",[t._v(t._s(t.icons.mdiPencilOutline))])],1),t._v(" "),r("v-btn",{attrs:{icon:"",href:t.$router.resolve({name:"forms.form",params:{id:n.id,create:"new"}}).href,title:t.$t("Клонировать")},on:{click:function(e){return e.preventDefault(),t.$router.push({name:"forms.form",params:{id:n.id,create:"new"}})}}},[r("v-icon",[t._v(t._s(t.icons.mdiContentCopy))])],1),t._v(" "),r("v-btn",{attrs:{icon:"",title:t.$t("Удалить")},on:{click:function(e){return e.stopPropagation(),t.deleteItem(n)}}},[r("v-icon",[t._v(t._s(t.icons.mdiDeleteOutline))])],1)],1)]}},{key:"item.projects",fn:function(e){var r=e.item.projects;return[t._v("\n                    "+t._s(r&&r.map((function(t){return t.name})).join(", "))+"\n                ")]}},{key:"item.roles",fn:function(e){var r=e.item.roles;return[t._v("\n                    "+t._s(r&&r.map((function(e){return t.roleNames[e]})).join(", "))+"\n                ")]}},{key:"item.updated_at",fn:function(e){var r=e.item;return[t._v("\n                    "+t._s(new Date(r.updated_at).toLocaleString())+"\n                ")]}}])}),t._v(" "),[4,5].includes(t.user.id)?r("v-btn",{attrs:{fab:"",color:"primary",absolute:""},on:{click:function(e){return t.$router.push({name:"forms.form",params:{id:"add"}})}}},[r("v-icon",[t._v(t._s(t.icons.mdiPlus))])],1):t._e()],1)],1),t._v(" "),r("v-dialog",{attrs:{"max-width":"320"},model:{value:t.confirm,callback:function(e){t.confirm=e},expression:"confirm"}},[r("v-card",[r("progress-bar",{attrs:{show:t.working}}),t._v(" "),r("v-card-title",[t._v(t._s(t.$t("Подтверждение")))]),t._v(" "),r("v-card-text",[t._v(t._s(t.$t("Запись будет удалена. Продолжить?")))]),t._v(" "),r("v-card-actions",[r("v-spacer"),t._v(" "),r("v-btn",{attrs:{text:""},on:{click:function(e){t.confirm=!1}}},[t._v(t._s(t.$t("Отменить")))]),t._v(" "),r("v-btn",{attrs:{color:"error",dark:""},on:{click:t.deleteConfirmed}},[t._v(t._s(t.$t("Удалить")))])],1)],1)],1)],1)}),[],!1,null,null,null),Mr=Qr.exports;function Yr(){if(window.crypto){var t=new Uint32Array(1);return window.crypto.getRandomValues(t),2.3283064365386963e-10*t[0]}return Math.random()}ce()(Qr,{VAutocomplete:ke.Z,VBtn:ue.Z,VCard:de.Z,VCardActions:me.h7,VCardText:me.ZB,VCardTitle:me.EB,VCol:ve.Z,VContainer:pe.Z,VDataTable:Me.Z,VDialog:Ye.Z,VIcon:$e.Z,VRow:_e.Z,VSelect:Se.Z,VSpacer:je.Z,VTextField:ge.Z,VToolbar:Ze.Z,VToolbarTitle:Ve.qW});var Nr=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4,e="23456789ABCDEFGHJKLMNPQRSTWXYZabcdefghijkmnopqrstuvwxyz",r="",n=0;n<t;n++){var i=Math.floor(Yr()*e.length);r+=e.substr(i,1)}return r};function Hr(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return Wr(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Wr(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function Wr(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var Xr=[{value:"text",text:Vt.Z.t("Свободный ответ")},{value:"list",text:Vt.Z.t("Список ответов")},{value:"select",text:Vt.Z.t("Выпадающий список")},{value:"checkbox",text:Vt.Z.t("Галочка")},{value:"date",text:Vt.Z.t("Дата")},{value:"time",text:Vt.Z.t("Время")},{value:"phone",text:Vt.Z.t("Телефон")},{value:"clients",text:Vt.Z.t("Клиенты")}],Kr="text",Jr=["text","date","list","select","checkbox"],Gr={id:null,name:null,roles:[],schema:{version:2,items:[]}},tn=function(t){if(Array.isArray(t.schema)){var e,r=Hr(t.schema);try{for(r.s();!(e=r.n()).done;){var n=e.value;switch(n.type){case"1":n.type="list";break;case"2":n.type="list",n.multiple=!0;break;case"3":n.type="text"}}}catch(t){r.e(t)}finally{r.f()}t.schema={version:1,items:t.schema}}if(1==t.schema.version){var i,a=Hr(t.schema.items);try{for(a.s();!(i=a.n()).done;){var o=i.value;o.text=o.name,delete o.name}}catch(t){a.e(t)}finally{a.f()}}return t.schema.version=2,t},en={mixins:[vt.Z,ie],props:{item:Object,removable:Boolean,movableUp:Boolean,movableDown:Boolean,conditionItems:Array},data:function(){return{itemTypes:Xr}},methods:{addAnswer:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r={id:Nr()};null===e?this.item.answers.push(r):this.item.answers.splice(e+1,0,r),this.$nextTick((function(){return t.$refs[r.id][0].focus()}))}}},rn=r(5227),nn=se.Z(en,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-row",[r("v-col",{staticClass:"flex-grow-0 d-flex flex-column pt-6"},[r("v-btn",{attrs:{icon:"",title:t.$t("Удалить"),disabled:!t.removable},on:{dblclick:function(e){return t.$emit("remove")}}},[r("v-icon",[t._v(t._s(t.icons.mdiDeleteOutline))])],1),t._v(" "),r("v-btn",{attrs:{icon:"",title:t.$t("Вверх"),disabled:!t.movableUp},on:{click:function(e){return t.$emit("moveup")}}},[r("v-icon",[t._v(t._s(t.icons.mdiArrowUp))])],1),t._v(" "),r("v-btn",{attrs:{icon:"",disabled:!t.movableDown,title:t.$t("Вниз")},on:{click:function(e){return t.$emit("movedown")}}},[r("v-icon",[t._v(t._s(t.icons.mdiArrowDown))])],1),t._v(" "),r("v-btn",{attrs:{icon:"",title:t.$t("Добавить ниже")},on:{click:function(e){return t.$emit("add")}}},[r("v-icon",[t._v(t._s(t.icons.mdiPlus))])],1)],1),t._v(" "),r("v-col",{attrs:{cols:"4"}},[r("v-select",{attrs:{label:t.$t("Вид поля"),rules:[t.rules.required],items:t.itemTypes},model:{value:t.item.type,callback:function(e){t.$set(t.item,"type",e)},expression:"item.type"}}),t._v(" "),"checkbox"!=t.item.type?r("v-checkbox",{attrs:{label:t.$t("Обязательное"),"hide-details":""},model:{value:t.item.required,callback:function(e){t.$set(t.item,"required",e)},expression:"item.required"}}):t._e(),t._v(" "),"list"==t.item.type?r("v-checkbox",{attrs:{label:t.$t("Несколько ответов"),"hide-details":""},model:{value:t.item.multiple,callback:function(e){t.$set(t.item,"multiple",e)},expression:"item.multiple"}}):t._e(),t._v(" "),"list"!=t.item.type||t.item.multiple?t._e():r("v-checkbox",{attrs:{label:t.$t("Произвольный ответ"),"hide-details":""},model:{value:t.item.other,callback:function(e){t.$set(t.item,"other",e)},expression:"item.other"}}),t._v(" "),t.movableUp?r("v-checkbox",{attrs:{label:t.$t("В ряд с предыдущим"),"hide-details":""},model:{value:t.item.row,callback:function(e){t.$set(t.item,"row",e)},expression:"item.row"}}):t._e(),t._v(" "),r("v-checkbox",{attrs:{label:t.$t("Отображение при условии"),"hide-details":!t.item.conditional},model:{value:t.item.conditional,callback:function(e){t.$set(t.item,"conditional",e)},expression:"item.conditional"}}),t._v(" "),t.item.conditional?r("conditional-settings",{attrs:{item:t.item,conditionItems:t.conditionItems}}):t._e()],1),t._v(" "),r("v-col",[r("v-textarea",{attrs:{"auto-grow":"",rows:"1",label:t.$t("Вопрос"),rules:[t.rules.required]},model:{value:t.item.text,callback:function(e){t.$set(t.item,"text",e)},expression:"item.text"}}),t._v(" "),"list"==t.item.type||"select"==t.item.type?[t._l(t.item.answers,(function(e,n){return r("v-row",{key:e.id,attrs:{dense:""}},[r("v-col",{staticClass:"flex-grow-0 d-flex pt-4"},[r("v-btn",{attrs:{icon:"",title:t.$t("Удалить"),disabled:1==t.item.answers.length},on:{click:function(e){return t.item.answers.splice(n,1)}}},[r("v-icon",[t._v(t._s(t.icons.mdiDeleteOutline))])],1)],1),t._v(" "),r("v-col",[r("v-text-field",{ref:e.id,refInFor:!0,attrs:{type:"tel",label:t.$t("Вариант ответа"),rules:[t.rules.required]},on:{keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.addAnswer(n))}},model:{value:e.text,callback:function(r){t.$set(e,"text",r)},expression:"answer.text"}})],1)],1)})),t._v(" "),r("v-row",{staticClass:"mb-6"},[r("v-col",[r("v-btn",{attrs:{icon:"",title:t.$t("Добавить ответ")},on:{click:function(e){return t.addAnswer()}}},[r("v-icon",[t._v(t._s(t.icons.mdiPlus))])],1)],1)],1)]:t._e()],2)],1)}),[],!1,null,null,null),an=nn.exports;function on(t,e,r,n,i,a,o){try{var s=t[a](o),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(n,i)}function sn(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function o(t){on(a,n,i,o,s,"next",t)}function s(t){on(a,n,i,o,s,"throw",t)}o(void 0)}))}}ce()(nn,{VBtn:ue.Z,VCheckbox:fe.Z,VCol:ve.Z,VIcon:$e.Z,VRow:_e.Z,VSelect:Se.Z,VTextField:ge.Z,VTextarea:rn.Z,ConditionalSettings:r(4949).Z});var ln={mixins:[vt.Z,ie],components:{item:an,subform:mr},props:{id:null,create:null},metaInfo:function(){return{title:this.title}},data:function(){return{roles:qe,endpoint:"forms",working:!1,form:new(ee())(Gr),tab:null,model:{data:{_:{}}}}},computed:{title:function(){return"add"==this.id||this.create?"Создание формы":"Изменение формы"},schema:function(){return this.form.schema},conditionItems:function(){return this.schema.items.filter((function(t){return Jr.includes(t.type)}))}},watch:{id:{handler:function(){parseInt(this.id)?this.fetchRecord():this.schema.items.length||this.addItem()},immediate:!0}},methods:{addItem:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.schema.items.length-1;this.schema.items.splice(t+1,0,{id:Nr(),type:Kr,answers:[{id:Nr()}]})},fetchRecord:function(){var t=this;return sn(Ut().mark((function e(){var r;return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.working=!0,e.prev=1,e.next=4,t.axios.get("".concat(t.endpoint,"/").concat(t.id));case 4:(r=e.sent).data.ifItem&&!r.data.ifItems&&(r.data.ifItems=[[this.item.ifItem,this.item.ifItemIs]],delete r.data.ifItem,delete r.data.ifItemIs),t.form.fill(tn(r.data)),t.create&&(t.id=null),e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(1),console.error(e.t0),e.abrupt("return");case 12:return e.prev=12,t.working=!1,e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,8,12,15]])})))()},save:function(){var t=this;return sn(Ut().mark((function e(){var r,n=[function(t){var e,r=qt(t.schema.items);try{for(r.s();!(e=r.n()).done;){var n=e.value;n.ifItems&&(n.ifItems.length&&!n.ifItems[n.ifItems.length-1][0]&&n.ifItems.splice(-1,1),n.ifItems.length||delete n.ifItems)}}catch(t){r.e(t)}finally{r.f()}return t},o().transformRequest[0]];return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.form.clear(),t.$refs.form.validate()){e.next=3;break}return e.abrupt("return");case 3:if(t.working=!0,!parseInt(t.id)){e.next=20;break}return e.prev=5,e.next=8,t.form.submit("put","".concat(t.endpoint,"/").concat(t.id),{transformRequest:n});case 8:t.$store.dispatch("notification",{type:"success",text:t.$t("Форма обновлена")}),e.next=15;break;case 11:return e.prev=11,e.t0=e.catch(5),console.error(e.t0),e.abrupt("return");case 15:return e.prev=15,t.working=!1,e.finish(15);case 18:e.next=35;break;case 20:return e.prev=20,e.next=23,t.form.submit("post",t.endpoint,{transformRequest:n});case 23:r=e.sent,t.form.id=r.data.id,t.add=null,t.$router.replace({name:"".concat(t.endpoint,".form"),params:{id:t.form.id}}),t.$store.dispatch("notification",{type:"success",text:t.$t("Форма создана")}),e.next=32;break;case 29:return e.prev=29,e.t1=e.catch(20),e.abrupt("return");case 32:return e.prev=32,t.working=!1,e.finish(32);case 35:case"end":return e.stop()}}),e,null,[[5,11,15,18],[20,29,32,35]])})))()},moveUp:function(t){t>0&&this.schema.items.splice(t-1,0,this.schema.items.splice(t,1).pop())},moveDown:function(t){t<this.schema.items.length-1&&this.schema.items.splice(t+1,0,this.schema.items.splice(t,1).pop())}}},cn=se.Z(ln,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-container",[r("v-form",{ref:"form",on:{submit:function(e){return e.preventDefault(),t.save(e)}}},[r("v-toolbar",{attrs:{elevation:"0"}},[r("v-toolbar-title",[t._v(t._s(t.title))]),t._v(" "),r("v-spacer"),t._v(" "),r("v-btn",{staticClass:"ml-12",attrs:{type:"submit",color:"secondary",dark:"",disabled:t.working}},[t._v(t._s(t.$t("Сохранить")))]),t._v(" "),r("v-btn",{attrs:{color:"secondary",text:"",disabled:t.working},on:{click:function(e){return t.$router.go(-1)}}},[t._v(t._s(t.$t("Назад")))])],1),t._v(" "),r("v-row",[r("v-col",[r("v-text-field",{attrs:{label:t.$t("Название"),rules:[t.rules.required],"error-messages":t.errors("name")},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),r("v-col",{attrs:{cols:"3"}},[r("v-select",{attrs:{label:t.$t("Роли"),rules:[t.rules.required],items:t.roles,"error-messages":t.errors("roles"),multiple:""},model:{value:t.form.roles,callback:function(e){t.$set(t.form,"roles",e)},expression:"form.roles"}})],1),t._v(" "),r("v-col",{attrs:{cols:"3"}},[r("v-checkbox",{attrs:{label:t.$t("Отображать на основной вкладке")},model:{value:t.schema.basic,callback:function(e){t.$set(t.schema,"basic",e)},expression:"schema.basic"}})],1)],1),t._v(" "),r("v-tabs",{model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[r("v-tab",[t._v(t._s(t.$t("Конструктор")))]),t._v(" "),r("v-tab",[t._v(t._s(t.$t("Предпросмотр")))])],1),t._v(" "),r("v-tabs-items",{staticClass:"pt-8",model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[r("v-tab-item",{staticClass:"row-compact",attrs:{transition:"false","reverse-transition":"false"}},[t._l(t.schema.items,(function(e,n){return r("item",{key:e.id,attrs:{item:e,removable:t.schema.items.length>1,movableUp:!!n,movableDown:n<t.schema.items.length-1,conditionItems:t.conditionItems},on:{add:function(e){return t.addItem(n)},remove:function(e){return t.schema.items.splice(n,1)},moveup:function(e){return t.moveUp(n)},movedown:function(e){return t.moveDown(n)}}})})),t._v(" "),r("v-btn",{attrs:{fab:"",color:"secondary",absolute:"",title:t.$t("Добавить вопрос")},on:{click:function(e){return t.addItem()}}},[r("v-icon",[t._v(t._s(t.icons.mdiPlus))])],1)],2),t._v(" "),r("v-tab-item",{attrs:{transition:"false","reverse-transition":"false"}},[r("subform",{attrs:{form:{id:"_",schema:t.schema},data:t.model,validationDisabled:!0}})],1)],1)],1)],1)}),[],!1,null,null,null),un=cn.exports;function dn(t,e,r,n,i,a,o){try{var s=t[a](o),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(n,i)}function mn(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function o(t){dn(a,n,i,o,s,"next",t)}function s(t){dn(a,n,i,o,s,"throw",t)}o(void 0)}))}}function fn(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function vn(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?fn(Object(r),!0).forEach((function(e){pn(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):fn(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function pn(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}ce()(cn,{VBtn:ue.Z,VCheckbox:fe.Z,VCol:ve.Z,VContainer:pe.Z,VForm:he.Z,VIcon:$e.Z,VRow:_e.Z,VSelect:Se.Z,VSpacer:je.Z,VTab:Oe.Z,VTabItem:De.Z,VTabs:Pe.Z,VTabsItems:Ce.Z,VTextField:ge.Z,VToolbar:Ze.Z,VToolbarTitle:Ve.qW});var hn={mixins:[ie],metaInfo:function(){return{title:this.title}},data:function(){return{title:this.$t("Поручения"),statusNames:Je,endpoint:"activities",total:0,items:[],loading:!1,options:{search:null,projects:[],from:null,till:null},headers:[{sortable:!1,value:"actions",width:1},{text:this.$t("Проект"),value:"project.name",class:"text-no-wrap",sortable:!1},{text:this.$t("Автор"),value:"user.name",class:"text-no-wrap",sortable:!1},{text:this.$t("Описание"),value:"title",class:"text-no-wrap"},{text:this.$t("Начало"),value:"start_date",class:"text-no-wrap"},{text:this.$t("Окончание"),value:"end_date",class:"text-no-wrap"},{text:this.$t("Статус"),value:"status",class:"text-no-wrap"},{text:this.$t("Изменено"),value:"updated_at",class:"text-no-wrap"}],working:!1,confirm:!1,itemId:null,projects:[],projectsLoading:!1,inputDialog:!1,inputDialog2:!1,comment:null}},computed:vn({},Nt.Se(["user"])),created:function(){var t=this;!function(e){var r=t.$route.query;if(r[e])for(var n in Array.isArray(r[e])||(r[e]=[r[e]]),r[e])r[e][n]=+r[e][n]}("projects"),Object.assign(this.options,vn({},this.$route.query)),this.$route.query.itemsPerPage&&(this.options.itemsPerPage=+this.$route.query.itemsPerPage),this.$route.query.sortBy&&!Array.isArray(this.$route.query.sortBy)&&(this.options.sortBy=[this.$route.query.sortBy]),this.$route.query.page&&(this.options.page=+this.$route.query.page,this.fetchData()),this.$watch("options",(function(e,r){t.$router.resolve({query:Jt.pickBy(e)}).href!=t.$route.fullPath&&(e.page==r.page&&(e.page=1),t.$router.replace({query:Jt.pickBy(e)}),t.fetchDataDebounced())}),{deep:!0}),this.fetchDataDebounced=Jt.debounce(this.fetchData,750),this.fetchProjects(),this.$root.$on("fetch-activities",(function(){return t.fetchData()}))},destroyed:function(){this.$root.$off("fetch-activities")},methods:{fetchData:function(){var t=this;return mn(Ut().mark((function e(){var r;return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.loading=!0,e.next=3,t.axios.get(t.endpoint,{params:t.options});case 3:r=e.sent,t.items=r.data.data,t.total=r.data.total,t.loading=!1;case 7:case"end":return e.stop()}}),e)})))()},fetchProjects:function(){var t=this;return mn(Ut().mark((function e(){var r;return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.projectsLoading=!0,e.prev=1,e.next=4,t.axios.get("projects",{params:{itemsPerPage:-1}});case 4:r=e.sent,t.projects=r.data.data,e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(1),console.error(e.t0),e.abrupt("return");case 12:return e.prev=12,t.projectsLoading=!1,e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,8,12,15]])})))()},deleteItem:function(t){this.itemId=t.id,this.confirm=!0},deleteConfirmed:function(){var t=this;return mn(Ut().mark((function e(){return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.working=!0,e.next=3,t.axios.delete("".concat(t.endpoint,"/").concat(t.itemId));case 3:t.working=!1,t.confirm=!1,t.fetchData();case 6:case"end":return e.stop()}}),e)})))()},startItem:function(t){var e=this;return mn(Ut().mark((function r(){return Ut().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e.working=!0,r.next=3,e.axios.put("".concat(e.endpoint,"/").concat(t.id,"/start"));case 3:return r.next=5,e.$store.dispatch("fetchUser");case 5:e.working=!1,e.confirm=!1;case 7:case"end":return r.stop()}}),r)})))()},stopItem:function(t){var e=this;return mn(Ut().mark((function r(){return Ut().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:e.itemId=t.id,e.inputDialog=!0;case 2:case"end":return r.stop()}}),r)})))()},inputDialogClosed:function(){var t=this;return mn(Ut().mark((function e(){return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.working=!0,e.next=3,t.axios.put("".concat(t.endpoint,"/").concat(t.itemId,"/stop"),{comment:t.comment});case 3:return e.next=5,t.$store.dispatch("fetchUser");case 5:t.comment=null,t.working=!1,t.inputDialog=!1,t.fetchData();case 9:case"end":return e.stop()}}),e)})))()},inputDialog2Closed:function(){var t=this;return mn(Ut().mark((function e(){var r;return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.working=!0,e.next=3,t.axios.post(t.endpoint,{title:t.comment});case 3:return r=e.sent,e.next=6,t.axios.put("".concat(t.endpoint,"/").concat(r.data.id,"/start"));case 6:return e.next=8,t.$store.dispatch("fetchUser");case 8:t.comment=null,t.working=!1,t.inputDialog2=!1,t.fetchData();case 12:case"end":return e.stop()}}),e)})))()},gotoActivityForm:function(){var t=this;return mn(Ut().mark((function e(){var r,n;return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.working=!0,r="add",!t.comment||!t.comment.trim().length){e.next=13;break}return e.prev=3,e.next=6,t.axios.post(t.endpoint,{title:t.comment});case 6:n=e.sent,r=n.data.id,e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),console.error(e.t0);case 13:t.$router.push({name:"activities.form",params:{id:r}}),t.working=!1,t.inputDialog2=!1,t.comment=null;case 17:case"end":return e.stop()}}),e,null,[[3,10]])})))()}}},bn=se.Z(hn,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-container",[r("v-row",[r("v-col",[r("v-toolbar",{attrs:{elevation:"0"}},[r("v-toolbar-title",[t._v(t._s(t.title))]),t._v(" "),r("v-spacer"),t._v(" "),r("div",{staticClass:"d-flex"},[r("v-autocomplete",{staticClass:"mr-4",attrs:{label:t.$t("Проекты"),loading:t.projectsLoading,items:t.projects,"item-text":"name","item-value":"id",multiple:"",clearable:"","single-line":"","hide-details":""},model:{value:t.options.projects,callback:function(e){t.$set(t.options,"projects",e)},expression:"options.projects"}}),t._v(" "),r("v-text-field",{staticClass:"mr-4",attrs:{label:"Поиск","single-line":"","hide-details":""},model:{value:t.options.search,callback:function(e){t.$set(t.options,"search",e)},expression:"options.search"}})],1)],1)],1)],1),t._v(" "),r("v-row",[r("v-col",[r("v-data-table",{attrs:{headers:t.headers,items:t.items,options:t.options,"server-items-length":t.total,loading:t.loading},on:{"update:options":function(e){t.options=e}},scopedSlots:t._u([{key:"item.actions",fn:function(e){var n=e.item;return[r("div",{staticClass:"text-no-wrap"},[n.frozen_timing||n.status||t.user.current_activity?t._e():r("v-btn",{attrs:{icon:"",title:t.$t("Начать деятельность")},on:{click:function(e){return e.preventDefault(),t.startItem(n)}}},[r("v-icon",[t._v(t._s(t.icons.mdiPlayCircleOutline))])],1),t._v(" "),!n.status&&t.user.current_activity&&t.user.current_activity.id==n.id?r("v-btn",{attrs:{icon:"",title:t.$t("Завершить деятельность")},on:{click:function(e){return e.preventDefault(),t.stopItem(n)}}},[r("v-icon",[t._v(t._s(t.icons.mdiStopCircleOutline))])],1):t._e(),t._v(" "),r("v-btn",{attrs:{icon:"",href:t.$router.resolve({name:"activities.form",params:{id:n.id}}).href,title:t.$t("Редактировать")},on:{click:function(e){return e.preventDefault(),t.$router.push({name:"activities.form",params:{id:n.id}})}}},[r("v-icon",[t._v(t._s(t.icons.mdiPencilOutline))])],1),t._v(" "),n.user_id==t.user.id?r("v-btn",{attrs:{icon:"",title:t.$t("Удалить"),disabled:!!n.timings.length},on:{click:function(e){return e.stopPropagation(),t.deleteItem(n)}}},[r("v-icon",[t._v(t._s(t.icons.mdiDeleteOutline))])],1):t._e()],1)]}},{key:"item.start_date",fn:function(e){var r=e.item;return[t._v("\n                    "+t._s(r.start_date)+" "+t._s(r.start_time)+"\n                ")]}},{key:"item.end_date",fn:function(e){var r=e.item;return[t._v("\n                    "+t._s(r.end_date)+" "+t._s(r.end_time)+"\n                ")]}},{key:"item.project",fn:function(e){var r=e.item.status;return[t._v("\n                    "+t._s(r&&t.statusNames[r])+"\n                ")]}},{key:"item.status",fn:function(e){var r=e.item.status;return[t._v("\n                    "+t._s(r&&t.statusNames[r])+"\n                ")]}},{key:"item.updated_at",fn:function(e){var r=e.item;return[t._v("\n                    "+t._s(new Date(r.updated_at).toLocaleString())+"\n                ")]}}])}),t._v(" "),r("v-btn",{attrs:{fab:"",color:"primary",fixed:"",bottom:""},on:{click:function(e){t.inputDialog2=!0}}},[r("v-icon",[t._v(t._s(t.icons.mdiPlus))])],1)],1)],1),t._v(" "),r("v-dialog",{attrs:{"max-width":"320"},model:{value:t.confirm,callback:function(e){t.confirm=e},expression:"confirm"}},[r("v-card",[r("v-card-title",[t._v(t._s(t.$t("Подтверждение")))]),t._v(" "),r("v-card-text",[t._v(t._s(t.$t("Запись будет удалена. Продолжить?")))]),t._v(" "),r("v-card-actions",[r("v-spacer"),t._v(" "),r("v-btn",{attrs:{text:""},on:{click:function(e){t.confirm=!1}}},[t._v(t._s(t.$t("Отменить")))]),t._v(" "),r("v-btn",{attrs:{color:"error",dark:""},on:{click:t.deleteConfirmed}},[t._v("\n                    "+t._s(t.$t("Удалить"))+"\n                    "),t.working?r("v-progress-circular",{staticClass:"ml-2",attrs:{indeterminate:"",size:"20"}}):t._e()],1)],1)],1)],1),t._v(" "),r("v-dialog",{attrs:{"max-width":"480"},model:{value:t.inputDialog,callback:function(e){t.inputDialog=e},expression:"inputDialog"}},[r("v-card",[r("v-card-title",[t._v(t._s(t.$t("Остановка деятельности")))]),t._v(" "),r("v-card-text",[r("v-text-field",{attrs:{label:t.$t("Комментарий"),autofocus:""},on:{keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.inputDialogClosed(e)}},model:{value:t.comment,callback:function(e){t.comment=e},expression:"comment"}})],1),t._v(" "),r("v-card-actions",[r("v-spacer"),t._v(" "),r("v-btn",{attrs:{text:""},on:{click:function(e){t.inputDialog=!1}}},[t._v(t._s(t.$t("Отменить")))]),t._v(" "),r("v-btn",{attrs:{color:"error",dark:""},on:{click:t.inputDialogClosed}},[t._v("\n                    "+t._s(t.$t("Завершить деятельность"))+"\n                    "),t.working?r("v-progress-circular",{staticClass:"ml-2",attrs:{indeterminate:"",size:"20"}}):t._e()],1)],1)],1)],1),t._v(" "),r("v-dialog",{attrs:{"max-width":"480"},model:{value:t.inputDialog2,callback:function(e){t.inputDialog2=e},expression:"inputDialog2"}},[r("v-card",[r("v-card-title",[t._v(t._s(t.$t("Новое поручение")))]),t._v(" "),r("v-card-text",[r("v-text-field",{attrs:{label:t.$t("Описание"),autofocus:""},on:{keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.inputDialog2Closed(e)}},model:{value:t.comment,callback:function(e){t.comment=e},expression:"comment"}})],1),t._v(" "),r("v-card-actions",[r("v-spacer"),t._v(" "),r("v-btn",{attrs:{text:""},on:{click:t.gotoActivityForm}},[t._v(t._s(t.$t("Подробнее")))]),t._v(" "),r("v-btn",{attrs:{disabled:!!t.user.current_activity,dark:!t.user.current_activity,color:"error"},on:{click:t.inputDialog2Closed}},[t._v("\n                    "+t._s(t.$t("Начать деятельность"))+"\n                    "),t.working?r("v-progress-circular",{staticClass:"ml-2",attrs:{indeterminate:"",size:"20"}}):t._e()],1)],1)],1)],1)],1)}),[],!1,null,null,null),_n=bn.exports;ce()(bn,{VAutocomplete:ke.Z,VBtn:ue.Z,VCard:de.Z,VCardActions:me.h7,VCardText:me.ZB,VCardTitle:me.EB,VCol:ve.Z,VContainer:pe.Z,VDataTable:Me.Z,VDialog:Ye.Z,VIcon:$e.Z,VProgressCircular:be.Z,VRow:_e.Z,VSpacer:je.Z,VTextField:ge.Z,VToolbar:Ze.Z,VToolbarTitle:Ve.qW});var gn=[{value:"implementer",text:Vt.Z.t("Исполнитель")},{value:"supervisor",text:Vt.Z.t("Супервайзер")},{value:"assistant",text:Vt.Z.t("Ассистент")}],yn=gn.reduce((function(t,e){return t[e.value]=e.text,t}),{});function xn(t,e,r,n,i,a,o){try{var s=t[a](o),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(n,i)}function wn(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var kn={mixins:[vt.Z,ie],props:{users:Array,usersLoading:Boolean,editable:Boolean,item:Object,project:Number,client:Boolean,errorMessages:Array},data:function(){return{roles:gn}},computed:{user:function(){var t=this;return this.users.find((function(e){return e.id==t.item.user_id}))},parts:function(){var t=this;return(this.user&&this.user.parts?this.item.position?this.user.parts.filter((function(e){return e.pivot.position==t.item.position})):this.user.parts:[]).map((function(t,e){return Tt(Tt({},t),{},{description:"".concat(e+1,". ").concat(t.description)})}))},positions:function(){return this.user&&this.user.parts?(t=new Set(this.user.parts.sort((function(t,e){var r=+t.pivot.order,n=+e.pivot.order;return r<n?-1:r>n?1:0})).map((function(t){return t.pivot.position})).filter((function(t){return t}))),function(t){if(Array.isArray(t))return wn(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return wn(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?wn(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).map((function(t){return{text:t,value:t}})):[];var t}},watch:{"item.user_id":function(){var t,e=this;return(t=Ut().mark((function t(){var r;return Ut().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!e.user){t.next=8;break}if(e.user.parts){t.next=7;break}return t.next=5,e.axios.get("parts",{params:{user:e.item.user_id,project:e.project}});case 5:r=t.sent,e.$set(e.user,"parts",r.data);case 7:e.$nextTick((function(){var t=e.positions[0];e.item.position=t?t.value:null}));case 8:t.next=13;break;case 10:t.prev=10,t.t0=t.catch(0),console.error(t.t0);case 13:case"end":return t.stop()}}),t,null,[[0,10]])})),function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function o(t){xn(a,n,i,o,s,"next",t)}function s(t){xn(a,n,i,o,s,"throw",t)}o(void 0)}))})()},"item.part_id":function(){var t=this,e=this.parts.find((function(e){return e.id==t.item.part_id&&e.pivot&&e.pivot.position==t.item.position}));e&&(this.item.project_user_id=e.pivot.id)},"item.position":function(){var t=this,e=this.parts.find((function(e){return e.id==t.item.part_id&&e.pivot&&e.pivot.position==t.item.position}));e&&(this.item.project_user_id=e.pivot.id)}},methods:{isInList:function(t){var e=this;return function(r){return!!t.find((function(t){return(t.id||t.value)==r}))||e.$t("Обязательно к заполнению")}}}},$n=se.Z(kn,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-row",[r("v-col",{attrs:{cols:"3"}},[r("v-autocomplete",{attrs:{label:t.$t(t.client?"Клиент":"Сотрудник"),items:t.users,rules:[t.rules.required,t.isInList(t.users)],"prepend-icon":t.editable?t.icons.mdiDeleteOutline:null,loading:t.usersLoading,readonly:!t.editable,"error-messages":t.errorMessages,"item-text":"name","item-value":"id",dense:""},on:{"click:prepend":function(e){return t.$emit("remove")}},model:{value:t.item.user_id,callback:function(e){t.$set(t.item,"user_id",e)},expression:"item.user_id"}})],1),t._v(" "),t.client?t._e():r("v-col",{attrs:{cols:"2"}},[r("v-select",{attrs:{label:t.$t("Роль"),items:t.roles,rules:[t.rules.required],readonly:!t.editable,dense:""},model:{value:t.item.role,callback:function(e){t.$set(t.item,"role",e)},expression:"item.role"}})],1),t._v(" "),t.client?t._e():r("v-col",{attrs:{cols:"2"}},[r("v-autocomplete",{attrs:{label:t.$t("Должность"),items:t.positions,rules:[t.rules.required,t.isInList(t.positions)],loading:t.usersLoading,readonly:!t.editable,dense:""},model:{value:t.item.position,callback:function(e){t.$set(t.item,"position",e)},expression:"item.position"}})],1),t._v(" "),r("v-col",{attrs:{cols:!t.client&&5}},[r("v-autocomplete",{attrs:{label:t.$t(t.client?"Услуга":"Обязанность"),items:t.parts,rules:[t.rules.required,t.isInList(t.parts)],loading:t.usersLoading,readonly:!t.editable,"item-text":"description","item-value":"id",dense:""},on:{change:function(e){return t.$emit("part",t.item.part_id)}},model:{value:t.item.part_id,callback:function(e){t.$set(t.item,"part_id",e)},expression:"item.part_id"}})],1)],1)}),[],!1,null,null,null),jn=$n.exports;function On(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=Dn(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function Dn(t,e){if(t){if("string"==typeof t)return Pn(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Pn(t,e):void 0}}function Pn(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Cn(t,e,r,n,i,a,o){try{var s=t[a](o),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(n,i)}function Zn(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function o(t){Cn(a,n,i,o,s,"next",t)}function s(t){Cn(a,n,i,o,s,"throw",t)}o(void 0)}))}}function Vn(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Sn(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Vn(Object(r),!0).forEach((function(e){Tn(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Vn(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Tn(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}ce()($n,{VAutocomplete:ke.Z,VCol:ve.Z,VRow:_e.Z,VSelect:Se.Z});var In={mixins:[vt.Z,ie],components:{participant:jn,subform:mr,documents:w},props:{id:null,client:null},metaInfo:function(){return{title:this.title}},data:function(){var t,e=fr.ou.now().toISODate();return Tn(t={roles:gn,statuses:Ke,endpoint:"activities",working:!1,tab:0,activities:[],allUsers:[],usersLoading:!1,projects:[],projectsLoading:!1},"activities",[]),Tn(t,"activitiesLoading",!1),Tn(t,"form",new(ee())({id:null,user_id:null,project_id:4,parent_id:null,status:null,start_date:e,start_time:"09:00",end_date:e,end_time:"17:00",title:null,description:null,forms:{},users:[],clients:[],createTiming:!0,comment:null,editable:!1})),Tn(t,"verified",!1),Tn(t,"frozen",!1),Tn(t,"confirm",!1),Tn(t,"itemId",null),Tn(t,"timings",[]),Tn(t,"timingsLoading",!1),Tn(t,"headers",[{sortable:!1,value:"actions",width:1},{text:this.$t("Начало"),value:"began_at",class:"text-no-wrap"},{text:this.$t("Окончание"),value:"ended_at",class:"text-no-wrap"},{text:this.$t("Комментарий"),value:"comment",class:"text-no-wrap"},{text:this.$t("Верификация"),value:"verified",class:"text-no-wrap"},{text:this.$t("Запись добавлена"),value:"created_at",class:"text-no-wrap"}]),Tn(t,"commentDialog",!1),t},computed:Sn(Sn({title:function(){return"add"==this.id?"Добавление данных о деятельности":"Редактирование данных о деятельности"},selectedUsers:function(){return(0,n.map)(this.form.users,"user_id")},users:function(){return this.allUsers.filter((function(t){return!t.roles.includes("client")}))},selectedClients:function(){return(0,n.map)(this.form.clients,"user_id")},clients:function(){return this.allUsers.filter((function(t){return t.roles.includes("client")}))}},Nt.Se(["user"])),{},{isSuperuser:function(){return this.user.roles.includes("superuser")},editable:function(){return!this.form.id||this.form.editable},canAddTiming:function(){var t=this;return!!this.form.users.find((function(e){return e.user_id==t.user.id}))},rideInfoForm:function(){var t=!!this.form.users.find((function(t){return[4,245].includes(t.part_id)}));return t&&!this.form.forms&&(this.form.forms={}),t}}),watch:{id:{handler:function(){parseInt(this.id)&&this.fetchRecord()},immediate:!0},client:{handler:function(t){t&&!this.form.clients.length&&this.form.clients.push({user_id:+t,role:"client",part_id:null}),this.fetchProjects()},immediate:!0},"form.project_id":{handler:function(t,e){this.client&&!e||(this.fetchActivities(t),this.fetchUsers(t))},immediate:!0}},methods:{fetchProjects:function(){var t=this;return Zn(Ut().mark((function e(){var r;return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.projectsLoading=!0,e.prev=1,e.next=4,t.axios.get("projects",{params:{itemsPerPage:-1,forUser:t.client}});case 4:r=e.sent,t.projects=r.data.data,!t.form.project_id&&t.projects.length&&(t.form.project_id=t.projects[0].id),e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(1),console.error(e.t0),e.abrupt("return");case 13:return e.prev=13,t.projectsLoading=!1,e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[1,9,13,16]])})))()},fetchUsers:function(t){var e=this;return Zn(Ut().mark((function r(){var n,i,a,o,s,l,c;return Ut().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e.usersLoading=!0,r.prev=1,r.next=4,e.axios.get("users",{params:{project:t,itemsPerPage:-1}});case 4:if(e.form.project_id!=t)return r.finish(20);n=r.sent,e.allUsers=n.data.data,!e.form.users.length&&e.users.find((function(t){return t.id==e.user.id}))&&(e.form.users.push({user_id:e.user.id,role:"implementer",position:null,part_id:null}),e.onParticipantChange(e.form.users[0])),i=On(e.form.users),r.prev=8,o=Ut().mark((function t(){var r,n,i,o;return Ut().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=a.value,!(n=e.allUsers.find((function(t){return t.id==r.user_id})))){t.next=11;break}if(n.parts){t.next=8;break}return t.next=6,e.axios.get("parts",{params:{user:r.user_id,project:e.form.project_id}});case 6:i=t.sent,e.$set(n,"parts",i.data);case 8:(o=n.parts.find((function(t){return t.pivot.id==r.project_user_id})))||(o=n.parts[0]),o&&e.$set(r,"position",o.pivot.position);case 11:case"end":return t.stop()}}),t)})),i.s();case 11:if((a=i.n()).done){r.next=15;break}return r.delegateYield(o(),"t0",13);case 13:r.next=11;break;case 15:r.next=20;break;case 17:r.prev=17,r.t1=r.catch(8),i.e(r.t1);case 20:return r.prev=20,i.f(),r.finish(20);case 23:s=On(e.form.clients),r.prev=24,c=Ut().mark((function t(){var r,n,i,a;return Ut().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=l.value,!(n=e.allUsers.find((function(t){return t.id==r.user_id})))){t.next=11;break}if(n.parts){t.next=8;break}return t.next=6,e.axios.get("parts",{params:{user:r.user_id,project:e.form.project_id}});case 6:i=t.sent,e.$set(n,"parts",i.data);case 8:(a=n.parts.find((function(t){return t.id==r.part_id})))||(a=n.parts[0]),a&&e.$set(r,"position",a.pivot.position);case 11:case"end":return t.stop()}}),t)})),s.s();case 27:if((l=s.n()).done){r.next=31;break}return r.delegateYield(c(),"t2",29);case 29:r.next=27;break;case 31:r.next=36;break;case 33:r.prev=33,r.t3=r.catch(24),s.e(r.t3);case 36:return r.prev=36,s.f(),r.finish(36);case 39:r.next=45;break;case 41:return r.prev=41,r.t4=r.catch(1),console.error(r.t4),r.abrupt("return");case 45:return r.prev=45,e.usersLoading=!1,r.finish(45);case 48:case"end":return r.stop()}}),r,null,[[1,41,45,48],[8,17,20,23],[24,33,36,39]])})))()},fetchActivities:function(t){var e=this;return Zn(Ut().mark((function r(){var n;return Ut().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e.activitiesLoading=!0,r.prev=1,r.next=4,e.axios.get("activities",{params:{project:t,itemsPerPage:-1}});case 4:n=r.sent,e.activities=n.data,r.next=12;break;case 8:return r.prev=8,r.t0=r.catch(1),console.error(r.t0),r.abrupt("return");case 12:return r.prev=12,e.activitiesLoading=!1,r.finish(12);case 15:case"end":return r.stop()}}),r,null,[[1,8,12,15]])})))()},fetchRecord:function(){var t=this;return Zn(Ut().mark((function e(){var r,n;return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.timingsLoading=!0,e.prev=1,e.next=4,t.axios.get("".concat(t.endpoint,"/").concat(t.id));case 4:if((r=e.sent).data.users=r.data.all_users.filter((function(t){return"client"!=t.role})),r.data.clients=r.data.all_users.filter((function(t){return"client"==t.role})),t.timings=r.data.timings,n=fr.ou.now().toISODate(),r.data.start_date||(r.data.start_date=n),r.data.end_date||(r.data.end_date=n),r.data.start_time||(r.data.start_time="09:00"),r.data.end_time||(r.data.end_time="17:00"),!r.data.forms||Array.isArray(r.data.forms)&&!r.data.forms.length)r.data.forms={};else for(var i in r.data.forms)Array.isArray(r.data.forms[i])&&!r.data.forms[i].length&&delete r.data.forms[i];t.form.fill(r.data),t.verified=!!r.data.verified_timing,t.frozen=!!r.data.frozen_timing,e.next=22;break;case 18:return e.prev=18,e.t0=e.catch(1),console.error(e.t0),e.abrupt("return");case 22:return e.prev=22,t.timingsLoading=!1,e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[1,18,22,25]])})))()},save:function(){var t=this;return Zn(Ut().mark((function e(){var r,n;return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.form.clear(),t.$refs.form.validate()){e.next=3;break}return e.abrupt("return");case 3:if(!t.form.createTiming||t.form.comment){e.next=6;break}return t.commentDialog=!0,e.abrupt("return");case 6:if(t.form.forms[29]&&t.form.forms[29].file&&t.form.forms[29].file.file&&t.form.forms[29].file.file instanceof File&&((n=new FormData).append("file",t.form.forms[29].file.file),t.form.forms[29].file.file=t.form.forms[29].file.original),t.form.forms.files){var i,a=0,o=qt(t.form.forms.files);try{for(o.s();!(i=o.n()).done;){var s=i.value;s.file&&(n||(n=new FormData),n.append("files[]",s.file),s.upload=a++)}}catch(t){o.e(t)}finally{o.f()}}if(t.working=!0,!parseInt(t.id)){e.next=25;break}return e.prev=8,e.next=n?111:11,t.form.submit("put","".concat(t.endpoint,"/").concat(t.id));case 111:return e.prev=8,e.next=11,t.axios.patch("".concat(t.endpoint,"/").concat(t.id),n);case 11:t.form.forms=e.sent.data.forms,t.$router.go(-1),t.$store.dispatch("notification",{type:"success",text:t.$t("Данные изменены")}),e.next=19;break;case 15:return e.prev=15,e.t0=e.catch(8),console.error(e.t0),e.abrupt("return");case 19:return e.prev=19,t.working=!1,t.commentDialog=!1,e.finish(19);case 23:e.next=41;break;case 25:return e.prev=25,e.next=n?128:28,t.form.submit("post",t.endpoint);case 128:return e.prev=25,e.next=28,r=e.sent,t.form.id=r.data.id,t.axios.patch("".concat(t.endpoint,"/").concat(t.form.id),n);case 28:t.form.forms=e.sent.data.forms,t.$router.replace({name:"activities.form",params:{id:t.form.id}}),t.$router.go(-1),t.$store.dispatch("notification",{type:"success",text:t.$t("Данные об активности добавлены")}),e.next=38;break;case 35:return e.prev=35,e.t1=e.catch(25),e.abrupt("return");case 38:return e.prev=38,t.working=!1,e.finish(38);case 41:case"end":return e.stop()}}),e,null,[[8,15,19,23],[25,35,38,41]])})))()},addUser:function(){this.form.users.push({user_id:null,role:"implementer",position:null,part_id:null})},addClient:function(){this.form.clients.push({user_id:null,role:"client",part_id:null})},deleteItem:function(t){this.itemId=t.id,this.confirm=!0},deleteConfirmed:function(){var t=this;return Zn(Ut().mark((function e(){return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.working=!0,e.next=3,t.axios.delete("timings/".concat(t.itemId));case 3:t.working=!1,t.confirm=!1,t.fetchRecord();case 6:case"end":return e.stop()}}),e)})))()},verifyItem:function(t){var e=this;return Zn(Ut().mark((function r(){return Ut().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e.working=!0,r.next=3,e.axios.put("timings/".concat(t.id),{verified:1});case 3:e.working=!1,e.confirm=!1,e.fetchRecord();case 6:case"end":return r.stop()}}),r)})))()},getPositions:function(t){return function(t){return function(t){if(Array.isArray(t))return Pn(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||Dn(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(new Set(this.getParts(t).map((function(t){return t.pivot.position})).filter((function(t){return t})))).map((function(t){return{text:t,value:t}}))},getParts:function(t,e){var r=this.allUsers.find((function(e){return e.id==t}));return r&&r.parts?e?r.parts.filter((function(t){return t.pivot.position==e})):r.parts:[]},onParticipantChange:function(t){var e=this;return Zn(Ut().mark((function r(){var n,i,a;return Ut().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,!(n=e.allUsers.find((function(e){return e.id==t.user_id})))){r.next=10;break}if(n.parts){r.next=8;break}return r.next=6,e.axios.get("parts",{params:{user:t.user_id,project:e.form.project_id}});case 6:i=r.sent,e.$set(n,"parts",i.data);case 8:a=e.getPositions(t.user_id)[0],t.position=a?a.value:null;case 10:r.next=15;break;case 12:r.prev=12,r.t0=r.catch(0),console.error(r.t0);case 15:case"end":return r.stop()}}),r,null,[[0,12]])})))()}}},qn=r(3580),An=se.Z(In,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-container",[i("v-form",{ref:"form",on:{submit:function(e){return e.preventDefault(),t.save(e)}}},[i("v-toolbar",{attrs:{elevation:"0"}},[i("v-toolbar-title",[t._v(t._s(t.title))]),t._v(" "),i("v-spacer"),t._v(" "),!t.editable||t.timingsLoading||t.timings.length?t._e():i("v-checkbox",{attrs:{label:t.$t("Зарегистрировать деятельность"),"hide-details":"",disabled:!(t.form.start_date&&t.form.start_time&&t.form.end_date&&t.form.end_time)},model:{value:t.form.createTiming,callback:function(e){t.$set(t.form,"createTiming",e)},expression:"form.createTiming"}}),t._v(" "),t.editable?i("v-btn",{staticClass:"ml-12",attrs:{disabled:t.working||t.usersLoading,dark:!t.working&&!t.usersLoading,type:"submit",color:"secondary"}},[t._v("\n                "+t._s(t.$t("Сохранить"))+"\n                "),t.working||t.usersLoading?i("v-progress-circular",{staticClass:"ml-2",attrs:{indeterminate:"",size:"20"}}):t._e()],1):t._e(),t._v(" "),i("v-btn",{attrs:{color:"secondary",text:"",readonly:t.working},on:{click:function(e){return t.$router.go(-1)}}},[t._v(t._s(t.$t("Назад")))])],1),t._v(" "),i("v-tabs",{model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[i("v-tab",[t._v(t._s(t.$t("Поручение")))]),t._v(" "),t.form.id?i("v-tab",[t._v(t._s(t.$t("Деятельность")))]):t._e()],1),t._v(" "),i("v-tabs-items",{model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[i("v-tab-item",{staticClass:"pt-6",attrs:{transition:"false","reverse-transition":"false"}},[i("v-row",[t.projects.length<5?i("v-col",[i("div",{staticClass:"caption"},[t._v(t._s(t.$t("Проект")))]),t._v(" "),i("v-btn-toggle",{attrs:{mandatory:""},model:{value:t.form.project_id,callback:function(e){t.$set(t.form,"project_id",e)},expression:"form.project_id"}},t._l(t.projects,(function(e){return i("v-btn",{key:e.id,attrs:{small:"",value:e.id,disabled:!t.editable}},[t._v(t._s(e.name))])})),1)],1):i("v-col",[i("v-autocomplete",{attrs:{loading:t.projectsLoading,items:t.projects,label:t.$t("Проект"),readonly:!t.editable,"item-value":"id","item-text":"name"},model:{value:t.form.project_id,callback:function(e){t.$set(t.form,"project_id",e)},expression:"form.project_id"}})],1),t._v(" "),i("v-col",[i("v-autocomplete",{attrs:{loading:t.activitiesLoading,items:t.activities,label:t.$t("Вышестоящее поручение"),readonly:!t.editable,"item-value":"id","item-text":"hierarchical_title"},model:{value:t.form.parent_id,callback:function(e){t.$set(t.form,"parent_id",e)},expression:"form.parent_id"}})],1),t._v(" "),i("v-col",[i("v-select",{attrs:{label:t.$t("Статус"),items:t.statuses,readonly:!t.editable},model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}})],1)],1),t._v(" "),i("v-row",[i("v-col",[i("v-text-field",{attrs:{label:t.$t("Дата начала"),readonly:!t.editable,type:"date","error-messages":t.errors("start_date")},on:{input:function(e){t.form.end_date=t.form.start_date}},model:{value:t.form.start_date,callback:function(e){t.$set(t.form,"start_date",e)},expression:"form.start_date"}})],1),t._v(" "),i("v-col",[i("v-text-field",{attrs:{label:t.$t("Время начала"),readonly:!t.editable,type:"time","error-messages":t.errors("start_time")},model:{value:t.form.start_time,callback:function(e){t.$set(t.form,"start_time",e)},expression:"form.start_time"}})],1),t._v(" "),i("v-col",[i("v-text-field",{attrs:{label:t.$t("Дата окончания"),readonly:!t.editable,type:"date","error-messages":t.errors("end_date")},model:{value:t.form.end_date,callback:function(e){t.$set(t.form,"end_date",e)},expression:"form.end_date"}})],1),t._v(" "),i("v-col",[i("v-text-field",{attrs:{label:t.$t("Время окончания"),readonly:!t.editable,type:"time","error-messages":t.errors("end_time")},model:{value:t.form.end_time,callback:function(e){t.$set(t.form,"end_time",e)},expression:"form.end_time"}})],1)],1),t._v(" "),i("v-row",[i("v-col",[i("v-textarea",{attrs:{label:t.$t("Описание поручения"),readonly:!t.editable,"auto-grow":"",rows:"1"},model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})],1)],1),t._v(" "),i("v-row",[i("v-col",[i("h6",{staticClass:"text-h6"},[t._v("\n                            "+t._s(t.$t("Участники"))+"\n\n                            "),t.editable?i("v-btn",{attrs:{icon:"",title:t.$t("Добавить")},on:{click:function(e){return t.addUser()}}},[i("v-icon",[t._v(t._s(t.icons.mdiPlus))])],1):t._e()],1)])],1),t._v(" "),t._l(t.form.users,(function(e,r){return i("participant",{key:"u"+r,attrs:{users:t.users.filter((function(r){return!(0,n.without)(t.selectedUsers,e.user_id).includes(r.id)})),usersLoading:t.usersLoading,editable:t.editable,item:e,project:t.form.project_id,"error-messages":t.errors("users."+r+".user_id")},on:{remove:function(e){return t.form.users.splice(r,1)}}})})),t._v(" "),i("v-row",[i("v-col",[i("h6",{staticClass:"text-h6"},[t._v("\n                            "+t._s(t.$t("Клиенты"))+"\n\n                            "),t.editable?i("v-btn",{attrs:{icon:"",title:t.$t("Добавить")},on:{click:function(e){return t.addClient()}}},[i("v-icon",[t._v(t._s(t.icons.mdiPlus))])],1):t._e()],1)])],1),t._v(" "),t._l(t.form.clients,(function(e,r){return i("participant",{key:"c"+r,attrs:{users:t.clients.filter((function(r){return!(0,n.without)(t.selectedClients,e.user_id).includes(r.id)})),usersLoading:t.usersLoading,editable:t.editable,item:e,project:t.form.project_id,client:""},on:{remove:function(e){return t.form.clients.splice(r,1)},part:function(e){return t.form.clients.forEach((function(t){return t.part_id=e}))}}})})),t._v(" "),i("v-row",[i("v-col",[i("v-textarea",{attrs:{label:t.$t("Дополнительные сведения / результат"),readonly:!t.editable,"auto-grow":"",rows:"1"},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1)],1),t._v(" "),t.rideInfoForm?i("v-row",[i("v-col",[i("h6",{staticClass:"text-h6"},[t._v(t._s(t.$t("Информация о поездке")))],1)])],1):t._e(),t._v(" "),t.rideInfoForm?i("subform",{attrs:{form:{id:29,schema:r(935)},data:t.form.forms}}):t._e(),t._v(" "),i("v-row",[i("v-col",[i("h6",{staticClass:"text-h6"},[t._v(t._s(t.$t("Документы")))],1)])],1),t._v(" "),i("documents",{attrs:{data:t.form.forms}})],2),t._v(" "),i("v-tab-item",{attrs:{transition:"false","reverse-transition":"false"}},[i("v-data-table",{attrs:{headers:t.headers,items:t.timings},scopedSlots:t._u([{key:"item.actions",fn:function(e){var r=e.item;return[i("div",{staticClass:"text-no-wrap"},[r.frozen||(r.user_id!=t.user.id||r.verified)&&!t.isSuperuser?t._e():i("v-btn",{attrs:{icon:"",href:t.$router.resolve({name:"timings.form",params:{id:r.id}}).href,title:t.$t("Редактировать")},on:{click:function(e){return e.preventDefault(),t.$router.push({name:"timings.form",params:{id:r.id}})}}},[i("v-icon",[t._v(t._s(t.icons.mdiPencilOutline))])],1),t._v(" "),r.frozen||(r.user_id!=t.user.id||r.verified)&&!t.isSuperuser?t._e():i("v-btn",{attrs:{icon:"",title:t.$t("Удалить")},on:{click:function(e){return e.stopPropagation(),t.deleteItem(r)}}},[i("v-icon",[t._v(t._s(t.icons.mdiDeleteOutline))])],1),t._v(" "),r.frozen||r.verified||!t.isSuperuser?t._e():i("v-btn",{attrs:{icon:"",title:t.$t("Верифицировать")},on:{click:function(e){return e.stopPropagation(),t.verifyItem(r)}}},[i("v-icon",[t._v(t._s(t.icons.mdiCheckDecagramOutline))])],1),t._v(" "),r.frozen?i("v-icon",[t._v(t._s(t.icons.mdiPencilLockOutline))]):t._e()],1)]}},{key:"item.began_at",fn:function(e){var r=e.item;return[t._v("\n                        "+t._s(new Date(r.began_at).toLocaleString())+"\n                    ")]}},{key:"item.ended_at",fn:function(e){var r=e.item;return[t._v("\n                        "+t._s(new Date(r.ended_at).toLocaleString())+"\n                    ")]}},{key:"item.created_at",fn:function(e){var r=e.item;return[t._v("\n                        "+t._s(new Date(r.created_at).toLocaleString())+"\n                    ")]}},{key:"item.verified",fn:function(e){var r=e.item;return[t._v("\n                        "+t._s(r.verified?t.$t("верифицировано"):"")+"\n                    ")]}}])}),t._v(" "),t.canAddTiming?i("v-btn",{attrs:{fab:"",color:"primary",bottom:""},on:{click:function(e){return t.$router.push({name:"timings.form",params:{id:"add",activity:t.id}})}}},[i("v-icon",[t._v(t._s(t.icons.mdiPlus))])],1):t._e()],1)],1)],1),t._v(" "),i("v-dialog",{attrs:{"max-width":"480"},model:{value:t.commentDialog,callback:function(e){t.commentDialog=e},expression:"commentDialog"}},[i("v-card",[i("v-card-title",[t._v(t._s(t.$t("Регистрация деятельности")))]),t._v(" "),i("v-card-text",[i("v-text-field",{attrs:{label:t.$t("Комментарий")},model:{value:t.form.comment,callback:function(e){t.$set(t.form,"comment",e)},expression:"form.comment"}})],1),t._v(" "),i("v-card-actions",[i("v-spacer"),t._v(" "),i("v-btn",{attrs:{text:""},on:{click:function(e){t.commentDialog=!1}}},[t._v(t._s(t.$t("Отменить")))]),t._v(" "),i("v-btn",{attrs:{disabled:!t.form.comment,dark:!!t.form.comment,color:"error"},on:{click:t.save}},[t._v("\n                    "+t._s(t.$t("Зарегистрировать"))+"\n                    "),t.working?i("v-progress-circular",{staticClass:"ml-2",attrs:{indeterminate:"",size:"20"}}):t._e()],1)],1)],1)],1),t._v(" "),i("v-dialog",{attrs:{"max-width":"320"},model:{value:t.confirm,callback:function(e){t.confirm=e},expression:"confirm"}},[i("v-card",[i("v-card-title",[t._v(t._s(t.$t("Подтверждение")))]),t._v(" "),i("v-card-text",[t._v(t._s(t.$t("Запись будет удалена. Продолжить?")))]),t._v(" "),i("v-card-actions",[i("v-spacer"),t._v(" "),i("v-btn",{attrs:{text:""},on:{click:function(e){t.confirm=!1}}},[t._v(t._s(t.$t("Отменить")))]),t._v(" "),i("v-btn",{attrs:{color:"error",dark:""},on:{click:t.deleteConfirmed}},[t._v("\n                    "+t._s(t.$t("Удалить"))+"\n                    "),t.working?i("v-progress-circular",{staticClass:"ml-2",attrs:{indeterminate:"",size:"20"}}):t._e()],1)],1)],1)],1)],1)}),[],!1,null,null,null),En=An.exports;function Ln(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){i=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return r}}(t,e)||Fn(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Rn(t,e,r,n,i,a,o){try{var s=t[a](o),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(n,i)}function Bn(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function o(t){Rn(a,n,i,o,s,"next",t)}function s(t){Rn(a,n,i,o,s,"throw",t)}o(void 0)}))}}function Un(t){return function(t){if(Array.isArray(t))return zn(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||Fn(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Fn(t,e){if(t){if("string"==typeof t)return zn(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?zn(t,e):void 0}}function zn(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Qn(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Mn(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Qn(Object(r),!0).forEach((function(e){Yn(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Qn(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Yn(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}ce()(An,{VAutocomplete:ke.Z,VBtn:ue.Z,VBtnToggle:qn.Z,VCard:de.Z,VCardActions:me.h7,VCardText:me.ZB,VCardTitle:me.EB,VCheckbox:fe.Z,VCol:ve.Z,VContainer:pe.Z,VDataTable:Me.Z,VDialog:Ye.Z,VForm:he.Z,VIcon:$e.Z,VProgressCircular:be.Z,VRow:_e.Z,VSelect:Se.Z,VSpacer:je.Z,VTab:Oe.Z,VTabItem:De.Z,VTabs:Pe.Z,VTabsItems:Ce.Z,VTextField:ge.Z,VTextarea:rn.Z,VToolbar:Ze.Z,VToolbarTitle:Ve.qW});var Nn={components:{"files-gallery":O,user:T,"unverification-request-dialog":ct,"unverification-review-dialog":ft},mixins:[ie,vt.Z],props:{mode:{default:"timings"}},metaInfo:function(){return{title:this.title}},data:function(){return{statusNames:Je,roleNames:yn,endpoint:"timings",total:0,items:[],loading:!1,modeToggle:null,timingsOptions:{search:null,from:null,till:null,mode:null,projects:[],locations:[],users:[],positions:[],sortBy:["began_at"],sortDesc:[!1],itemsPerPage:50,page:1},requestsOptions:{requests:1,projects:[],locations:[],users:[],positions:[],itemsPerPage:50,page:1},unverificationRequestItem:null,reviewedRequestItem:null,reviewedRequestResult:null,fromTill:[],projects:[],projectsLoading:!1,locations:[],locationsLoading:!1,users:[],usersLoading:!1,allPositions:[],positionsLoading:!1,working:!1,confirm:!1,itemId:null,freezeConfirmation:!1,timings:{},headers2:[{text:this.$t("Дата"),value:"date",class:"text-no-wrap",sortable:!1},{text:this.$t("Выработка"),value:"timing",class:"text-no-wrap",sortable:!1}],items2:[],headers3:[{text:this.$t("Функциональная обязанность"),value:"description",class:"text-no-wrap",sortable:!1},{text:this.$t("Выработка"),value:"timing",class:"text-no-wrap",sortable:!1}],items3:[],editedComment:null,form:new(ee())({id:null,user_id:null,activity_id:null,comment:null,volunteering:!1,start_date:null,start_time:null,end_date:null,end_time:null}),note:null}},computed:Mn(Mn({},Nt.Se(["user"])),{},{title:function(){return this.$t("timings"==this.mode?"Деятельность":"Запросы")},isSuperuser:function(){return this.user.roles.includes("superuser")},positions:function(){var t=this,e=this.options.users.length?this.allPositions.filter((function(e){return t.options.users.includes(e.user_id)})):this.allPositions;return this.options.positions=this.options.positions.filter((function(t){return!!e.find((function(e){return t==e.position}))})),e},timing:function(){return this.getInterval(this.timings.timing)},verifiedTiming:function(){return this.getInterval(this.timings.verified)},totalTiming:function(){return this.getInterval(this.timings.total)},headers:function(){return[{sortable:!1,value:"actions",width:1},{sortable:!1,value:"status",width:1}].concat(Un("requests"!=this.mode?[]:[{text:this.$t("Даты запросов"),value:"requested_at",class:"text-no-wrap",sortable:!1},{text:this.$t("Авторы запросов"),value:"requested_by",class:"text-no-wrap",sortable:!1},{text:this.$t("Запросы"),value:"requests",class:"text-no-wrap",sortable:!1}]),Un(1==this.options.projects.length?[]:[{text:this.$t("Проект"),value:"project",class:"text-no-wrap",sortable:!1}]),Un(1==this.options.locations.length?[]:[{text:this.$t("Регион"),value:"location",class:"text-no-wrap",sortable:!1}]),[{text:this.$t("Дата"),value:"date",class:"text-no-wrap",sortable:!1},{text:this.$t("Начало"),value:"began_at",class:"text-no-wrap"},{text:this.$t("Окончание"),value:"ended_at",class:"text-no-wrap",sortable:!1}],4==this.options.mode?[]:[{text:this.$t("Выработка"),value:"timing",class:"text-no-wrap",sortable:!1},{text:this.$t("Запись изменена"),value:"updated_at",class:"text-no-wrap",sortable:!1}],Un(this.user.can.filter_timings_by_user&&1!=this.options.users.length?[{text:this.$t("Сотрудник"),value:"employee",class:"text-no-wrap",sortable:!1}]:[]),[{text:this.$t("Поручение"),value:"activity.title",class:"text-no-wrap",sortable:!1}],4==this.options.mode?[]:[{text:this.$t("Функциональная обязанность"),value:"project_user.part.description",class:"text-no-wrap",sortable:!1}],[{text:this.$t("Комментарий"),value:"comment",class:"text-no-wrap",sortable:!1}],4==this.options.mode?[{text:this.$t("Место выезда"),value:"departure",class:"text-no-wrap",sortable:!1},{text:this.$t("Место назначения"),value:"destination",class:"text-no-wrap",sortable:!1},{text:this.$t("Служба такси"),value:"taxi",class:"text-no-wrap",sortable:!1},{text:this.$t("Расстояние / время"),value:"measurements",class:"text-no-wrap",sortable:!1},{text:this.$t("Стоимость поездки"),value:"cost",class:"text-no-wrap",sortable:!1},{text:this.$t("Квитанция"),value:"file",class:"text-no-wrap",sortable:!1}]:[],[{text:this.$t("Услуги"),value:"services",class:"text-no-wrap",sortable:!1}],[{text:this.$t("Клиенты"),value:"clients",class:"text-no-wrap",sortable:!1}])},documentsDownloadUrl:function(){return Ie()("//".concat(location.host,"/download/timing-documents"),this.options)},ridesDownloadUrl:function(){return Ie()("//".concat(location.host,"/download/rides"),this.options)},options:function(){return"requests"!=this.mode?this.timingsOptions:this.requestsOptions}}),watch:{"options.projects":function(){this.fetchLocations(),this.fetchUsers(),this.fetchPositions()},fromTill:function(t){this.options.from=t[0],this.options.till=t[1]},ready:function(){this.fetchData()},mode:function(){this.items=[]}},created:function(){var t=this;localStorage.removeItem("timings.list");var e=function(e){var r=t.$route.query;if(r[e])for(var n in Array.isArray(r[e])||(r[e]=[r[e]]),r[e])r[e][n]=+r[e][n]};e("projects"),e("locations"),e("users"),Object.assign(this.options,Mn({},this.$route.query)),this.$route.query.itemsPerPage&&(this.options.itemsPerPage=+this.$route.query.itemsPerPage),this.$route.query.mode&&(this.options.mode=+this.$route.query.mode),this.$route.query.positions&&!Array.isArray(this.$route.query.positions)&&(this.options.positions=[this.$route.query.positions]),this.$route.query.sortBy&&!Array.isArray(this.$route.query.sortBy)&&(this.options.sortBy=[this.$route.query.sortBy]),this.$route.query.sortDesc&&!Array.isArray(this.$route.query.sortDesc)&&(this.options.sortDesc=[this.$route.query.sortDesc]),this.$route.query.page&&(this.options.page=+this.$route.query.page,this.fetchData()),this.$watch("options",(function(e){t.$router.resolve({query:Jt.pickBy(e)}).href!=t.$route.fullPath&&(t.$router.replace({query:Jt.pickBy(e)}),t.fetchDataDebounced())}),{deep:!0}),this.fetchDataDebounced=Jt.debounce(this.fetchData,1e3),this.fetchProjects(),this.fetchLocations(),this.fetchUsers(),this.fetchPositions()},methods:{fetchData:function(){var t=this;return Bn(Ut().mark((function e(){var r,n,i,a,o,s,l;return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.loading=!0,r={params:Mn({},t.options)},e.next=4,Promise.all([t.axios.get(t.endpoint,r),t.axios.get("".concat(t.endpoint,"/total"),r)]);case 4:if(n=e.sent,i=Ln(n,2),a=i[0],o=i[1],t.items=a.data.data,t.total=a.data.total,t.timings=o.data,!t.options.mode||4==t.options.mode){e.next=18;break}return e.next=14,t.axios.get("".concat(t.endpoint,"/aggregated"),r);case 14:s=e.sent,t.items2=s.data.days,t.items3=s.data.parts,t.timings=s.data.timings;case 18:for(l in t.items)+l&&new Date(t.items[l-1].began_at).toDateString()!=new Date(t.items[l].began_at).toDateString()&&(t.items[l-1].date_boundary=!0),+l&&t.items[l-1].activity_id==t.items[l].activity_id&&t.items[l].activity.forms&&t.items[l].activity.forms[29]&&delete t.items[l].activity.forms[29];t.loading=!1;case 20:case"end":return e.stop()}}),e)})))()},deleteItem:function(t){this.itemId=t.id,this.confirm=!0},deleteConfirmed:function(){var t=this;return Bn(Ut().mark((function e(){return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.working=!0,e.next=3,t.axios.delete("".concat(t.endpoint,"/").concat(t.itemId));case 3:t.working=!1,t.confirm=!1,t.fetchData();case 6:case"end":return e.stop()}}),e)})))()},verifyItem:function(t){var e=this;return Bn(Ut().mark((function r(){return Ut().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e.working=!0,r.next=4,e.axios.put("".concat(e.endpoint,"/").concat(t.id),{verified:!0});case 4:e.working=!1,e.confirm=!1,e.fetchData();case 7:case"end":return r.stop()}}),r)})))()},flagItem:function(t){var e=arguments,r=this;return Bn(Ut().mark((function n(){var i;return Ut().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=!(e.length>1&&void 0!==e[1])||e[1],r.working=!0,n.next=4,r.axios.put("".concat(r.endpoint,"/").concat(t.id),{flagged:i});case 4:r.working=!1,r.confirm=!1,r.fetchData();case 7:case"end":return n.stop()}}),n)})))()},volunteerItem:function(t){var e=arguments,r=this;return Bn(Ut().mark((function n(){var i;return Ut().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=!(e.length>1&&void 0!==e[1])||e[1],r.working=!0,n.next=4,r.axios.put("".concat(r.endpoint,"/").concat(t.id),{volunteering:i});case 4:r.working=!1,r.confirm=!1,r.fetchData();case 7:case"end":return n.stop()}}),n)})))()},batchVerify:function(){var t=this;return Bn(Ut().mark((function e(){return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(confirm("Вся деятельность в текущем листинге будет верифицирована. Продолжить?")){e.next=2;break}return e.abrupt("return");case 2:if(confirm("Вы уверены?")){e.next=4;break}return e.abrupt("return");case 4:return t.working=!0,e.next=7,t.axios.put("".concat(t.endpoint,"/verify"),t.options);case 7:t.working=!1,t.fetchData();case 9:case"end":return e.stop()}}),e)})))()},fetchProjects:function(){var t=this;return Bn(Ut().mark((function e(){var r;return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.projectsLoading=!0,e.prev=1,e.next=4,t.axios.get("projects",{params:{itemsPerPage:-1}});case 4:r=e.sent,t.projects=r.data.data,e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(1),console.error(e.t0),e.abrupt("return");case 12:return e.prev=12,t.projectsLoading=!1,e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,8,12,15]])})))()},fetchLocations:function(){var t=this;return Bn(Ut().mark((function e(){var r;return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.locationsLoading=!0,e.prev=1,e.next=4,t.axios.get("locations",{params:{withPositions:1,projects:t.options.projects,itemsPerPage:-1}});case 4:r=e.sent,t.locations=r.data.data,e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(1),console.error(e.t0),e.abrupt("return");case 12:return e.prev=12,t.locationsLoading=!1,e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,8,12,15]])})))()},fetchUsers:function(){var t=this;return Bn(Ut().mark((function e(){var r;return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.usersLoading=!0,e.prev=1,e.next=4,t.axios.get("users",{params:{withPositions:1,projects:t.options.projects,itemsPerPage:-1}});case 4:r=e.sent,t.users=r.data.data,t.options.users=t.options.users.filter((function(e){return t.users.find((function(t){return e==t.id}))})),e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(1),console.error(e.t0),e.abrupt("return");case 12:return e.prev=12,t.usersLoading=!1,e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,8,12,15]])})))()},fetchPositions:function(){var t=this;return Bn(Ut().mark((function e(){var r;return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.positionsLoading=!0,e.prev=1,e.next=4,t.axios.get("positions",{params:{withPositions:1,projects:t.options.projects,itemsPerPage:-1}});case 4:r=e.sent,t.allPositions=r.data,e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(1),console.error(e.t0),e.abrupt("return");case 12:return e.prev=12,t.positionsLoading=!1,e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,8,12,15]])})))()},getParts:function(t){return t.activity.parts.filter((function(e){return e.pivot.user_id==t.user_id})).map((function(t){return t.description})).join(", ")},getTiming:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t[e?"verified_timing":"timing"]?this.getInterval(t[e?"verified_timing":"timing"]):"-"},getInterval:function(t){return fr.nL.fromObject({seconds:t}).toFormat("hh:mm:ss")},fillForm:function(t){t.id!=this.form.id&&this.form.clear(),this.form.fill(t);var e=fr.ou.fromISO(t.began_at);this.form.start_date=e.toISODate(),this.form.start_time=e.toFormat("HH:mm");var r=fr.ou.fromISO(t.ended_at);this.form.end_date=r.toISODate(),this.form.end_time=r.toFormat("HH:mm")},saveItemNote:function(t){var e=this;t.note!=this.note&&setTimeout(Bn(Ut().mark((function r(){var n;return Ut().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e.loading=!0,r.next=3,e.axios.put("".concat(e.endpoint,"/").concat(t.id),{note:e.note});case 3:n=r.sent,t.note=n.data.note,t.flagged_at=n.data.flagged_at,t.updated_at=n.data.updated_at,e.loading=!1;case 8:case"end":return r.stop()}}),r)}))),300)},saveItem:function(t){var e=this;return Bn(Ut().mark((function r(){var n;return Ut().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e.loading=!0,r.prev=1,e.form.end_date=e.form.start_date,r.next=5,e.form.submit("put","timings/".concat(e.form.id));case 5:n=r.sent,Object.assign(t,n.data),console.log(t),r.next=14;break;case 10:r.prev=10,r.t0=r.catch(1),console.error(r.t0),e.$refs["edit".concat(t.id)].$el.previousElementSibling.dispatchEvent(new Event("click"));case 14:return r.prev=14,e.loading=!1,r.finish(14);case 17:case"end":return r.stop()}}),r,null,[[1,10,14,17]])})))()},duplicateItem:function(t){var e=this;return Bn(Ut().mark((function r(){return Ut().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e.loading=!0,r.prev=1,r.next=4,e.axios.post("timings/".concat(t.id));case 4:e.fetchData(),r.next=10;break;case 7:r.prev=7,r.t0=r.catch(1),console.error(r.t0);case 10:return r.prev=10,e.loading=!1,r.finish(10);case 13:case"end":return r.stop()}}),r,null,[[1,7,10,13]])})))()},freeze:function(){var t=this;return Bn(Ut().mark((function e(){return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.working=!0,e.prev=1,e.next=4,t.axios.patch("".concat(t.endpoint,"/freeze"),{from:t.options.from,till:t.options.till,users:t.options.users,projects:t.options.projects});case 4:t.freezeConfirmation=!1,t.fetchData(),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.error(e.t0);case 11:t.working=!1;case 12:case"end":return e.stop()}}),e,null,[[1,8]])})))()},getRowClass:function(t){var e=[];return t.verified?e.push("timing-verified"):t.flagged&&(new Date(t.flagged_at).getTime()>=new Date(t.updated_at).getTime()?e.push("timing-flagged"):e.push("timing-changed")),t.date_boundary&&e.push("timing-date-boundary"),e},updateTableOptions:function(t){this.options.sortDesc=t.sortDesc,this.options.sortBy=t.sortBy,this.options.itemsPerPage=t.itemsPerPage,this.options.page=t.page}}},Hn=r(5867),Wn=r(9707),Xn=r(3804),Kn=r(3797),Jn=r(6202),Gn=r(6035),ti=r(2054),ei=se.Z(Nn,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-container",{attrs:{fluid:""}},[r("v-row",[r("v-col",[r("v-toolbar",{attrs:{elevation:"0"}},"requests"==t.mode?[r("v-toolbar-title",[t._v(t._s(t.title))])]:[r("v-toolbar-title",[t._v(t._s(t.title))]),t._v(" "),r("v-spacer"),t._v(" "),r("v-alert",{staticClass:"mr-4",attrs:{color:"secondary",dark:"",dense:"",icon:t.icons.mdiProgressClock}},[t._v(t._s(4==t.options.mode?t.timings.cost_total:t.totalTiming))]),t._v(" "),r("v-alert",{staticClass:"mr-4",attrs:{color:"warning",dark:"",dense:"",icon:t.icons.mdiProgressQuestion}},[t._v(t._s(4==t.options.mode?t.timings.cost:t.timing))]),t._v(" "),r("v-alert",{attrs:{type:"success",dense:"",icon:t.icons.mdiProgressCheck}},[t._v(t._s(4==t.options.mode?t.timings.cost_verified:t.verifiedTiming))])],1)],1)],1),t._v(" "),"requests"==t.mode?t._e():r("v-row",[r("v-col",[r("v-text-field",{staticClass:"mt-0 pt-0",attrs:{label:"Поиск","single-line":"","hide-details":"",clearable:""},model:{value:t.options.search,callback:function(e){t.$set(t.options,"search",e)},expression:"options.search"}})],1),t._v(" "),r("v-col",[r("v-autocomplete",{staticClass:"mt-0 pt-0",attrs:{label:t.$t("Проекты"),loading:t.projectsLoading,items:t.projects,"item-text":"name","item-value":"id",multiple:"",clearable:"","single-line":"","hide-details":""},model:{value:t.options.projects,callback:function(e){t.$set(t.options,"projects",e)},expression:"options.projects"}})],1),t._v(" "),r("v-col",[r("v-autocomplete",{staticClass:"mt-0 pt-0",attrs:{label:t.$t("Регионы"),loading:t.locationsLoading,items:t.locations,"item-text":"code","item-value":"id",multiple:"",clearable:"","single-line":"","hide-details":""},model:{value:t.options.locations,callback:function(e){t.$set(t.options,"locations",e)},expression:"options.locations"}})],1),t._v(" "),this.user.can.filter_timings_by_user?r("v-col",[r("v-autocomplete",{staticClass:"mt-0 pt-0",attrs:{label:t.$t("Сотрудники"),loading:t.usersLoading,items:t.users,"item-text":"name","item-value":"id",multiple:"",clearable:"","single-line":"","hide-details":""},model:{value:t.options.users,callback:function(e){t.$set(t.options,"users",e)},expression:"options.users"}})],1):t._e(),t._v(" "),r("v-col",[r("v-autocomplete",{staticClass:"mt-0 pt-0",attrs:{label:t.$t("Должности"),loading:t.positionsLoading,items:t.positions,"item-text":"position","item-value":"position",multiple:"",clearable:"","single-line":"","hide-details":""},model:{value:t.options.positions,callback:function(e){t.$set(t.options,"positions",e)},expression:"options.positions"}})],1),t._v(" "),r("v-col",[r("v-text-field",{staticClass:"mt-0 pt-0",attrs:{label:"Начало периода",type:"date","single-line":"","hide-details":"",clearable:""},on:{change:function(e){t.fromTill[0]=t.options.from}},model:{value:t.options.from,callback:function(e){t.$set(t.options,"from",e)},expression:"options.from"}})],1),t._v(" "),r("v-col",[r("v-text-field",{staticClass:"mt-0 pt-0",attrs:{label:"Конец периода",type:"date","single-line":"","hide-details":"",clearable:""},on:{change:function(e){t.fromTill[1]=t.options.till}},model:{value:t.options.till,callback:function(e){t.$set(t.options,"till",e)},expression:"options.till"}})],1),t._v(" "),r("v-col",{staticClass:"flex-grow-0 d-flex pr-8"},[r("v-menu",{attrs:{"offset-y":"","close-on-content-click":!1},scopedSlots:t._u([{key:"activator",fn:function(e){var n=e.on,i=e.attrs;return[r("v-btn",t._g(t._b({staticClass:"mb-4",attrs:{icon:""}},"v-btn",i,!1),n),[r("v-icon",[t._v(t._s(t.icons.mdiCalendarRangeOutline))])],1)]}}])},[t._v(" "),r("v-date-picker",{attrs:{range:"","no-title":""},model:{value:t.fromTill,callback:function(e){t.fromTill=e},expression:"fromTill"}})],1),t._v(" "),r("v-btn-toggle",{staticClass:"mt-1",attrs:{mandatory:""},model:{value:t.options.mode,callback:function(e){t.$set(t.options,"mode",e)},expression:"options.mode"}},[r("v-btn",{attrs:{icon:"",small:"",value:null}},[r("v-icon",[t._v(t._s(t.icons.mdiViewHeadline))])],1),t._v(" "),r("v-btn",{attrs:{icon:"",small:"",value:4,title:t.$t("Поездки")}},[r("v-icon",[t._v(t._s(t.icons.mdiTrainCar))])],1),t._v(" "),r("v-btn",{attrs:{icon:"",small:"",value:1}},[r("v-icon",[t._v(t._s(t.icons.mdiViewSplitHorizontal))])],1),t._v(" "),r("v-btn",{attrs:{icon:"",small:"",value:2}},[r("v-icon",[t._v(t._s(t.icons.mdiChartBoxPlusOutline))])],1),t._v(" "),r("v-btn",{attrs:{icon:"",small:"",value:3}},[r("v-icon",[t._v(t._s(t.icons.mdiChartBoxOutline))])],1)],1),t._v(" "),r("v-btn",4==t.options.mode?{staticClass:"ml-6",attrs:{disabled:!t.options.projects.length||!t.options.from||!t.options.till,icon:"",title:t.$t("Скачать путевой лист"),target:"_blank",href:t.ridesDownloadUrl}}:{staticClass:"ml-6",attrs:{disabled:!t.options.projects.length||!t.options.from||!t.options.till||!t.options.positions.length||t.isSuperuser&&1!=t.options.users.length,icon:"",title:t.$t("Скачать акты/табели"),target:"_blank",href:t.documentsDownloadUrl}},[r("v-icon",[t._v(t._s(t.icons.mdiCloudDownloadOutline))])],1),t._v(" "),[1,2,5,43,65,6721].includes(t.user.id)?r("v-btn",{staticClass:"ml-6",attrs:{icon:"",title:t.$t("Верифицировать все")},on:{click:function(e){return e.stopPropagation(),t.batchVerify()}}},[r("v-icon",[t._v(t._s(t.icons.mdiCheckDecagramOutline))])],1):t._e(),t._v(" "),2146==t.user.id||5==t.user.id||2==t.user.id?r("v-btn",{staticClass:"ml-6",attrs:{disabled:1==!t.options.projects.length||!t.options.from||!t.options.till||!t.options.users.length,icon:"",title:t.$t("Заморозить")},on:{click:function(e){e.stopPropagation(),t.freezeConfirmation=!0}}},[r("v-icon",[t._v(t._s(t.icons.mdiPencilLockOutline))])],1):t._e()],1)],1),t._v(" "),t.options.mode&&4!=t.options.mode&&1!=t.options.mode?r("v-row",[r("v-col",{attrs:{cols:"3"}},[r("v-data-table",{attrs:{headers:t.headers2,items:t.items2,loading:t.loading,"disable-pagination":"","hide-default-footer":""},scopedSlots:t._u([{key:"item.timing",fn:function(e){var r=e.item;return[t._v("\n                    "+t._s(t.getTiming(r))+"\n                ")]}}])})],1),t._v(" "),r("v-col",[r("v-simple-table",{scopedSlots:t._u([{key:"default",fn:function(){return[r("thead",[r("tr",[r("th",[t._v(t._s(t.$t("Функциональная обязанность")))]),t._v(" "),r("th",[t._v(t._s(t.$t("Выработка")))])])]),t._v(" "),r("tbody",[t._l(t.items3,(function(e,n){return[r("tr",{key:n,staticClass:"font-weight-bold"},[r("td",[t._v(t._s(e.title))]),t._v(" "),r("td",[t._v(t._s(t.getTiming(e)))])]),t._v(" "),t._l(e.items,(function(e,i){return r("tr",{key:n+"-"+i},[r("td",[t._v(t._s(e.description))]),t._v(" "),r("td",[t._v(t._s(t.getTiming(e)))])])}))]}))],2)]},proxy:!0}])})],1)],1):r("v-row",[r("v-col",[1==t.options.mode?r("v-simple-table",{scopedSlots:t._u([{key:"default",fn:function(){return[r("thead",[r("tr",t._l(t.items2,(function(e,n){return r("th",{key:n,class:e.weekend&&"red--text"},[t._v(t._s(e.date))])})),0)]),t._v(" "),r("tbody",[r("tr",t._l(t.items2,(function(e,n){return r("td",{key:n},[t._v(t._s(t.getTiming(e)))])})),0),t._v(" "),r("tr",{staticClass:"success--text"},t._l(t.items2,(function(e,n){return r("td",{key:n},[t._v(t._s(t.getTiming(e,!0)))])})),0)])]},proxy:!0}],null,!1,2480698723)}):t._e(),t._v(" "),r("v-data-table",{attrs:{headers:t.headers,items:t.items,options:t.options,"server-items-length":t.total,loading:t.loading,"footer-props":{itemsPerPageOptions:[5,10,50,100,-1]},"item-class":t.getRowClass},on:{"update:options":t.updateTableOptions},scopedSlots:t._u([{key:"item.actions",fn:function(e){var n=e.item;if("requests"==t.mode)return[r("v-btn",{staticClass:"ma-1",attrs:{title:t.$t("Отклонить"),fab:"",dark:"",small:"",color:"info"},on:{click:function(e){e.stopPropagation(),t.reviewedRequestItem=n,t.reviewedRequestResult="declined"}}},[r("v-icon",[t._v(t._s(t.icons.mdiCancel))])],1),r("v-btn",{staticClass:"ma-1",attrs:{title:t.$t("Удовлетворить"),fab:"",dark:"",small:"",color:"error"},on:{click:function(e){e.stopPropagation(),t.reviewedRequestItem=n,t.reviewedRequestResult="approved"}}},[r("v-icon",[t._v(t._s(t.icons.mdiCheckCircleOutline))])],1)];var i=n.verifiers.find((function(e){return e.id==t.user.id}));return[r("div",{staticClass:"text-no-wrap"},[r("v-speed-dial",{attrs:{"open-on-hover":"",direction:"right",transition:"slide-x-transition"},scopedSlots:t._u([{key:"activator",fn:function(){return[r("v-btn",{attrs:{icon:""}},[r("v-icon",[t._v(t._s(t.icons.mdiDotsHorizontal))])],1)]},proxy:!0}],null,!0)},[t._v(" "),n.user_id==t.user.id||t.isSuperuser||n.verifiable?r("v-btn",{attrs:{href:t.$router.resolve({name:"activities.form",params:{id:n.activity_id}}).href,title:t.$t("Редактировать поручение"),fab:"",dark:"",small:"",color:"green"},on:{click:function(e){return e.preventDefault(),t.$router.push({name:"activities.form",params:{id:n.activity_id}})}}},[r("v-icon",[t._v(t._s(t.icons.mdiClipboardEditOutline))])],1):t._e(),t._v(" "),n.frozen||n.verified?t._e():r("v-btn",{attrs:{title:t.$t("Удалить"),fab:"",dark:"",small:"",color:"red"},on:{click:function(e){return e.stopPropagation(),t.deleteItem(n)}}},[r("v-icon",[t._v(t._s(t.icons.mdiDeleteOutline))])],1),t._v(" "),n.frozen||n.verified&&!t.isSuperuser?t._e():r("v-btn",{attrs:{href:t.$router.resolve({name:"timings.form",params:{id:n.id}}).href,title:t.$t("Редактировать деятельность"),fab:"",dark:"",small:"",color:"purple"},on:{click:function(e){return e.preventDefault(),t.$router.push({name:"timings.form",params:{id:n.id}})}}},[r("v-icon",[t._v(t._s(t.icons.mdiPencilOutline))])],1),t._v(" "),r("v-btn",{attrs:{title:t.$t("Дублировать"),fab:"",dark:"",small:"",color:"blue"},on:{click:function(e){return e.stopPropagation(),t.duplicateItem(n)}}},[r("v-icon",[t._v(t._s(t.icons.mdiContentCopy))])],1),t._v(" "),n.frozen&&!n.verified||!n.flaggable?t._e():r("v-btn",{attrs:{title:n.flagged?t.$t("Снять отметку"):t.$t("Отметить"),fab:"",dark:"",small:"",color:"orange"},on:{click:function(e){return e.stopPropagation(),t.flagItem(n,!n.flagged)}}},[r("v-icon",[t._v(t._s(n.flagged?t.icons.mdiAlertDecagram:t.icons.mdiAlertDecagramOutline))])],1),t._v(" "),!n.verifiable||i?t._e():r("v-btn",{attrs:{title:t.$t("Верифицировать"),fab:"",dark:"",small:"",color:"red"},on:{click:function(e){e.stopPropagation(),t.verifyItem(n)}}},[r("v-icon",[t._v(t._s(t.icons.mdiCheckDecagram))])],1),n.unverifiable?r("v-btn",{attrs:{title:t.$t("Запросить отмену верификации"),fab:"",dark:"",small:"",color:"red"},on:{click:function(e){e.stopPropagation(),t.unverificationRequestItem=n}}},[r("v-icon",[t._v(t._s(t.icons.mdiCheckDecagramOutline))])],1):t._e(),t._v(" "),!n.project_user||[19,23].indexOf(n.project_user.part_id)<0?r("v-btn",{attrs:{title:n.volunteering?t.$t("Снять маркер волонтерства"):t.$t("Волонтерство"),fab:"",dark:"",small:"",color:"primary"},on:{click:function(e){return e.stopPropagation(),t.volunteerItem(n,!n.volunteering)}}},[r("v-icon",[t._v(t._s(t.icons.mdiHand))])],1):t._e()],1)],1)]}},{key:"item.comment",fn:function(e){var n=e.item;return[!n.verified||t.isSuperuser?r("v-edit-dialog",{ref:"edit"+n.id,attrs:{"cancel-text":t.$t("Закрыть"),"save-text":t.$t("Сохранить"),large:""},on:{save:function(e){return t.saveItem(n)},open:function(e){return t.fillForm(n)}},scopedSlots:t._u([{key:"input",fn:function(){return[r("v-textarea",{attrs:{label:t.$t("Комментарий"),"error-messages":t.errors("comment"),rows:"2",autofocus:"","auto-grow":"","single-line":""},model:{value:t.form.comment,callback:function(e){t.$set(t.form,"comment",e)},expression:"form.comment"}}),t._v(" "),r("v-row",{staticClass:"edit-dialog-form"},[r("v-col",[r("v-text-field",{attrs:{label:t.$t("Начало"),rules:[t.rules.required],"error-messages":t.errors("start_time"),type:"time"},model:{value:t.form.start_time,callback:function(e){t.$set(t.form,"start_time",e)},expression:"form.start_time"}})],1),t._v(" "),r("v-col",[r("v-text-field",{attrs:{label:t.$t("Окончание"),rules:[t.rules.required],"error-messages":t.errors("end_time"),type:"time"},model:{value:t.form.end_time,callback:function(e){t.$set(t.form,"end_time",e)},expression:"form.end_time"}})],1),t._v(" "),r("v-col",[r("v-text-field",{attrs:{label:t.$t("Дата"),rules:[t.rules.required],"error-messages":t.errors("start_date"),type:"date"},model:{value:t.form.start_date,callback:function(e){t.$set(t.form,"start_date",e)},expression:"form.start_date"}})],1)],1)]},proxy:!0}],null,!0)},(n.author_timing&&n.project_user&&n.author_timing.user_id!=n.project_user.user_id?[r("em",[t._v(t._s(n.author_timing.comment))]),r("br")]:[]).concat([t._v(t._s(n.comment))])):(n.author_timing&&n.project_user&&n.author_timing.user_id!=n.user_id?[r("em",[t._v(t._s(n.author_timing.comment))]),r("br")]:[]).concat([t._v(t._s(n.comment))])]}},{key:"item.location",fn:function(e){var r=e.item;return[t._v("\n                    "+t._s(r.project_user&&r.project_user.location?r.project_user.location.code:"")+"\n                ")]}},{key:"item.project",fn:function(e){var r=e.item;return[t._v("\n                    "+t._s(r.activity&&r.activity.project?r.activity.project.name:"")+"\n                ")]}},{key:"item.employee",fn:function(t){return[r("user",{attrs:{user:t.item.project_user.user}})]}},{key:"item.services",fn:function(e){var n=e.item.activity.clients;return[t._l(n,(function(e,n){return[t._v(t._s(e.part.description)),r("br")]}))]}},{key:"item.clients",fn:function(e){var n=e.item.activity.clients;return[t._l(n,(function(e,n){return[t._v(t._s(e.user.name)),r("br")]}))]}},{key:"item.began_at",fn:function(e){var r=e.item;return[t._v("\n                    "+t._s(new Date(r.began_at).toLocaleTimeString())+"\n                ")]}},{key:"item.ended_at",fn:function(e){var r=e.item;return[t._v("\n                    "+t._s(new Date(r.ended_at).toLocaleTimeString())+"\n                ")]}},{key:"item.date",fn:function(e){var r=e.item;return[t._v("\n                    "+t._s(new Date(r.began_at).toLocaleDateString())+"\n                ")]}},{key:"item.timing",fn:function(e){var r=e.item;return[t._v("\n                    "+t._s(t.getTiming(r))+"\n                ")]}},{key:"item.requested_at",fn:function(e){return t._l(e.item.requests,(function(e,n){return[t._v(t._s(new Date(e.requested_at).toLocaleString())),r("br",{key:n})]}))}},{key:"item.requested_by",fn:function(e){return t._l(e.item.requests,(function(t,e){return[r("user",{attrs:{user:t.user}}),r("br",{key:e})]}))}},{key:"item.requests",fn:function(e){return t._l(e.item.requests,(function(e,n){return[t._v(t._s(e.request)),r("br",{key:n}),r("br",{key:n+"_2"})]}))}},{key:"item.status",fn:function(e){var n=e.item;return[n.flagged?[t.isSuperuser||n.flaggable?r("v-edit-dialog",{on:{close:function(e){return t.saveItemNote(n)},open:function(e){t.note=n.note}},scopedSlots:t._u([{key:"input",fn:function(){return[r("v-textarea",{attrs:{label:t.$t("Заметка"),rows:"1",autofocus:"","auto-grow":"","single-line":""},model:{value:t.note,callback:function(e){t.note=e},expression:"note"}})]},proxy:!0}],null,!0)},[n.flagged?r("v-tooltip",{attrs:{right:"","open-on-click":!0,"open-delay":"100",transition:"none"},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on,a=e.attrs;return[r("v-icon",t._g(t._b({attrs:{color:new Date(n.flagged_at).getTime()>=new Date(n.updated_at).getTime()?"error":"warning"}},"v-icon",a,!1),i),[t._v(t._s(t.icons.mdiAlertDecagram))])]}}],null,!0)},[t._v("\n                                "+t._s(t.$t("timings.list.flagged_at",{date:new Date(n.flagged_at).toLocaleString()}))+"\n                                "),n.note?[r("br"),t._v("\n                                    "+t._s(n.note)+"\n                                ")]:t._e()],2):t._e()],1):r("v-tooltip",{attrs:{right:"","open-on-click":!0,"open-delay":"100",transition:"none"},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on,a=e.attrs;return[r("v-icon",t._g(t._b({attrs:{color:new Date(n.flagged_at).getTime()==new Date(n.updated_at).getTime()?"error":"warning"}},"v-icon",a,!1),i),[t._v(t._s(t.icons.mdiAlertDecagram))])]}}],null,!0)},[t._v("\n                            "+t._s(t.$t("timings.list.flagged_at",{date:new Date(n.flagged_at).toLocaleString()}))+"\n                            "),n.note?[r("br"),t._v("\n                                "+t._s(n.note)+"\n                            ")]:t._e()],2)]:t._e(),t._v(" "),n.verifiers.length?r("v-tooltip",{attrs:{right:"","open-on-click":!0,"open-delay":"100",transition:"none"},scopedSlots:t._u([{key:"activator",fn:function(e){return[r("v-icon",t._g(t._b({attrs:{color:"success"}},"v-icon",e.attrs,!1),e.on),[t._v(t._s(t.icons.mdiCheckDecagram))])]}}],null,!0)},t._l(n.verifiers,(function(e,n){return[r("user",{attrs:{user:e}}),e.pivot.updated_at?t._v(t._s(" "+new Date(e.pivot.updated_at).toLocaleString())):t._e(),r("br",{key:n})]})),2):t._e(),t._v(" "),n.volunteering||!n.project_user||[19,23].indexOf(n.project_user.part_id)>=0?r("v-icon",{attrs:{color:"primary"}},[t._v(t._s(t.icons.mdiHand))]):t._e(),t._v(" "),n.frozen?r("v-icon",[t._v(t._s(t.icons.mdiPencilLockOutline))]):t._e(),t._v(" "),n.activity.forms&&n.activity.forms.files&&n.activity.forms.files.length?r("v-edit-dialog",{scopedSlots:t._u([{key:"input",fn:function(){return[r("files-gallery",{attrs:{group:n.id,files:n.activity.forms.files}})]},proxy:!0}],null,!0)},[r("v-icon",[t._v(t._s(t.icons.mdiFileDocumentOutline))])],1):t._e()]}},{key:"item.updated_at",fn:function(e){var n=e.item;return[r("span",{attrs:{title:t.$t("Автор:")+" "+n.user.name}},[t._v("\n                        "+t._s(new Date(n.updated_at).toLocaleString())+"\n                    ")])]}},{key:"item.departure",fn:function(e){var r=e.item.activity;return r.forms&&r.forms[29]&&r.forms[29][0]&&r.forms[29][0].data&&r.forms[29][0].data.DQqq?t._v(t._s(r.forms[29][0].data.DQqq)):t._e()}},{key:"item.destination",fn:function(e){var r=e.item.activity;return r.forms&&r.forms[29]&&r.forms[29][0]&&r.forms[29][0].data&&r.forms[29][0].data.iah6?t._v(t._s(r.forms[29][0].data.iah6)):t._e()}},{key:"item.taxi",fn:function(e){var r=e.item.activity;return t._v(t.$t(r.forms&&r.forms[29]&&r.forms[29][0]&&r.forms[29][0].data&&r.forms[29][0].data.aLxr?"такси":""))}},{key:"item.measurements",fn:function(e){var r=e.item.activity;return r.forms&&r.forms[29]&&r.forms[29][0]&&r.forms[29][0].data&&r.forms[29][0].data.y3ew?t._v(t._s(r.forms[29][0].data.y3ew)):t._e()}},{key:"item.cost",fn:function(e){var r=e.item.activity;return r.forms&&r.forms[29]&&r.forms[29][0]&&r.forms[29][0].data&&r.forms[29][0].data["5FsZ"]?t._v(t._s(r.forms[29][0].data["5FsZ"])):t._e()}},{key:"item.file",fn:function(e){var n=e.item.activity;return n.forms&&n.forms[29]&&n.forms[29].files&&n.forms[29].files[0]?r("v-btn",{attrs:{title:t.$t("Изображение квитанции"),icon:"",href:"/storage/"+n.forms[29].files[0],target:"_blank"}},[r("v-icon",[t._v(t._s(t.icons.mdiFileDocumentOutline))])],1):t._e()}}],null,!1,3406148134)})],1)],1),t._v(" "),r("v-dialog",{attrs:{"max-width":"320"},model:{value:t.confirm,callback:function(e){t.confirm=e},expression:"confirm"}},[r("v-card",[r("v-card-title",[t._v(t._s(t.$t("Подтверждение")))]),t._v(" "),r("v-card-text",[t._v(t._s(t.$t("Запись будет удалена. Продолжить?")))]),t._v(" "),r("v-card-actions",[r("v-spacer"),t._v(" "),r("v-btn",{attrs:{text:""},on:{click:function(e){t.confirm=!1}}},[t._v(t._s(t.$t("Отменить")))]),t._v(" "),r("v-btn",{attrs:{color:"error",dark:""},on:{click:t.deleteConfirmed}},[t._v("\n                    "+t._s(t.$t("Удалить"))+"\n                    "),t.working?r("v-progress-circular",{staticClass:"ml-2",attrs:{indeterminate:"",size:"20"}}):t._e()],1)],1)],1)],1),t._v(" "),t.unverificationRequestItem?r("unverification-request-dialog",{attrs:{item:t.unverificationRequestItem},on:{close:function(e){e&&(t.unverificationRequestItem.unverifiable=e.unverifiable),t.unverificationRequestItem=null}}}):t._e(),t.reviewedRequestItem?r("unverification-review-dialog",{attrs:{item:t.reviewedRequestItem,result:t.reviewedRequestResult},on:{close:function(e){t.reviewedRequestItem=null,e||t.fetchData()}}}):t._e(),t._v(" "),r("v-dialog",{attrs:{"max-width":"320"},model:{value:t.freezeConfirmation,callback:function(e){t.freezeConfirmation=e},expression:"freezeConfirmation"}},[r("v-card",[r("v-card-title",[t._v(t._s(t.$t("Заморозка деятельности")))]),t._v(" "),r("v-card-text",[r("strong",[t._v(t._s(t.$t("Сотрудники:")))]),r("br"),t._v(" "),t._l(t.users.filter((function(e){return t.options.users.includes(e.id)})),(function(e,n){return[t._v("\n                    "+t._s(e.name)),r("br",{key:n})]})),t._v(" "),r("br"),t._v(" "),r("strong",[t._v(t._s(t.$t("Период:")))]),r("br"),t._v("\n                "+t._s(t.$t("C"))+" "+t._s(new Date(t.options.from).toLocaleDateString())+"\n                "+t._s(t.$t("по"))+" "+t._s(new Date(t.options.till).toLocaleDateString())+"\n                "+t._s(t.$t("включительно"))+"\n            ")],2),t._v(" "),r("v-card-actions",[r("v-spacer"),t._v(" "),r("v-btn",{attrs:{text:"",disabled:t.working},on:{click:function(e){t.freezeConfirmation=!1}}},[t._v(t._s(t.$t("Отменить")))]),t._v(" "),r("v-btn",{attrs:{color:"error",dark:!t.working,disabled:t.working},on:{click:t.freeze}},[t._v("\n                    "+t._s(t.$t("Заморозить"))+"\n                    "),t.working?r("v-progress-circular",{staticClass:"ml-2",attrs:{indeterminate:"",size:"20"}}):t._e()],1)],1)],1)],1)],1)}),[],!1,null,null,null),ri=ei.exports;function ni(t,e,r,n,i,a,o){try{var s=t[a](o),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(n,i)}function ii(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function o(t){ni(a,n,i,o,s,"next",t)}function s(t){ni(a,n,i,o,s,"throw",t)}o(void 0)}))}}function ai(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function oi(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ai(Object(r),!0).forEach((function(e){si(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ai(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function si(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}ce()(ei,{VAlert:Hn.Z,VAutocomplete:ke.Z,VBtn:ue.Z,VBtnToggle:qn.Z,VCard:de.Z,VCardActions:me.h7,VCardText:me.ZB,VCardTitle:me.EB,VCol:ve.Z,VContainer:pe.Z,VDataTable:Me.Z,VDatePicker:Wn.Z,VDialog:Ye.Z,VEditDialog:Xn.Z,VIcon:$e.Z,VMenu:Kn.Z,VProgressCircular:be.Z,VRow:_e.Z,VSimpleTable:Jn.Z,VSpacer:je.Z,VSpeedDial:Gn.Z,VTextField:ge.Z,VTextarea:rn.Z,VToolbar:Ze.Z,VToolbarTitle:Ve.qW,VTooltip:ti.Z});var li={mixins:[vt.Z],props:{id:null,activity:null},metaInfo:function(){return{title:this.title}},data:function(){var t=fr.ou.now().toISODate(),e=fr.ou.now().toFormat("HH:mm");return{roles:qe,endpoint:"timings",working:!1,item:{},form:new(ee())({id:null,user_id:null,activity_id:null,comment:null,volunteering:!1,start_date:t,start_time:e,end_date:t,end_time:e})}},computed:oi(oi({title:function(){return"add"==this.id?"Регистрация деятельности":"Правка записи о деятельности"}},Nt.Se(["user"])),{},{isSuperuser:function(){return this.user.roles.includes("superuser")},readonly:function(){return this.item.frozen||this.item.verified&&!this.isSuperuser}}),watch:{id:{handler:function(){parseInt(this.id)&&this.fetchRecord()},immediate:!0},client:{handler:function(){this.form.activity_id=parseInt(this.activity)},immediate:!0}},methods:{fetchRecord:function(){var t=this;return ii(Ut().mark((function e(){var r,n,i;return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.working=!0,e.prev=1,e.next=4,t.axios.get("".concat(t.endpoint,"/").concat(t.id));case 4:r=e.sent,n=fr.ou.fromISO(r.data.began_at),r.data.start_date=n.toISODate(),r.data.start_time=n.toFormat("HH:mm"),i=fr.ou.fromISO(r.data.ended_at),r.data.end_date=i.toISODate(),r.data.end_time=i.toFormat("HH:mm"),t.item=r.data,t.form.fill(t.item),e.next=19;break;case 15:return e.prev=15,e.t0=e.catch(1),console.error(e.t0),e.abrupt("return");case 19:return e.prev=19,t.working=!1,e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[1,15,19,22]])})))()},save:function(){var t=this;return ii(Ut().mark((function e(){return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.form.clear(),t.$refs.form.validate()){e.next=3;break}return e.abrupt("return");case 3:if(t.working=!0,!parseInt(t.id)){e.next=21;break}return e.prev=5,e.next=8,t.form.submit("put","".concat(t.endpoint,"/").concat(t.id));case 8:t.$router.go(-1),t.$store.dispatch("notification",{type:"success",text:t.$t("Данные обновлены")}),e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(5),console.error(e.t0),e.abrupt("return");case 16:return e.prev=16,t.working=!1,e.finish(16);case 19:e.next=34;break;case 21:return e.prev=21,e.next=24,t.form.submit("post",t.endpoint);case 24:t.$router.go(-1),t.$store.dispatch("notification",{type:"success",text:t.$t("Деятельность зарегистрирована")}),e.next=31;break;case 28:return e.prev=28,e.t1=e.catch(21),e.abrupt("return");case 31:return e.prev=31,t.working=!1,e.finish(31);case 34:case"end":return e.stop()}}),e,null,[[5,12,16,19],[21,28,31,34]])})))()}}},ci=se.Z(li,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-container",[r("v-form",{ref:"form",on:{submit:function(e){return e.preventDefault(),t.save(e)}}},[r("v-row",[r("v-col",[r("h4",{staticClass:"text-h5"},[t._v("\n                    "+t._s(t.title)+"\n                    "),t.readonly?t._e():r("v-btn",{staticClass:"ml-12",attrs:{type:"submit",color:"secondary",dark:"",disabled:t.working}},[t._v(t._s(t.$t("Сохранить")))]),t._v(" "),r("v-btn",{attrs:{color:"secondary",text:"",disabled:t.working},on:{click:function(e){return t.$router.go(-1)}}},[t._v(t._s(t.$t("Отменить")))])],1)])],1),t._v(" "),r("v-row",[r("v-col",[r("v-text-field",{attrs:{label:t.$t("Комментарий"),"auto-grow":"",rows:"1",readonly:t.readonly},model:{value:t.form.comment,callback:function(e){t.$set(t.form,"comment",e)},expression:"form.comment"}})],1)],1),t._v(" "),r("v-row",[r("v-col",[r("v-text-field",{attrs:{label:t.$t("Дата начала"),rules:[t.rules.required],type:"date",readonly:t.readonly,"error-messages":t.errors("start_date")},on:{input:function(e){t.form.end_date=t.form.start_date}},model:{value:t.form.start_date,callback:function(e){t.$set(t.form,"start_date",e)},expression:"form.start_date"}})],1),t._v(" "),r("v-col",[r("v-text-field",{attrs:{label:t.$t("Время начала"),rules:[t.rules.required],type:"time",readonly:t.readonly,"error-messages":t.errors("start_time")},model:{value:t.form.start_time,callback:function(e){t.$set(t.form,"start_time",e)},expression:"form.start_time"}})],1),t._v(" "),r("v-col",[r("v-text-field",{attrs:{label:t.$t("Дата окончания"),rules:[t.rules.required],type:"date",readonly:t.readonly,"error-messages":t.errors("end_date")},model:{value:t.form.end_date,callback:function(e){t.$set(t.form,"end_date",e)},expression:"form.end_date"}})],1),t._v(" "),r("v-col",[r("v-text-field",{attrs:{label:t.$t("Время окончания"),rules:[t.rules.required],type:"time",readonly:t.readonly,"error-messages":t.errors("end_time")},model:{value:t.form.end_time,callback:function(e){t.$set(t.form,"end_time",e)},expression:"form.end_time"}})],1)],1),t._v(" "),r("v-row",[r("v-col",[r("v-checkbox",{attrs:{label:t.$t("Волонтёрство"),readonly:t.readonly},model:{value:t.form.volunteering,callback:function(e){t.$set(t.form,"volunteering",e)},expression:"form.volunteering"}})],1)],1)],1)],1)}),[],!1,null,null,null),ui=ci.exports;function di(t,e,r,n,i,a,o){try{var s=t[a](o),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(n,i)}function mi(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function o(t){di(a,n,i,o,s,"next",t)}function s(t){di(a,n,i,o,s,"throw",t)}o(void 0)}))}}ce()(ci,{VBtn:ue.Z,VCheckbox:fe.Z,VCol:ve.Z,VContainer:pe.Z,VForm:he.Z,VRow:_e.Z,VTextField:ge.Z});var fi={mixins:[vt.Z,ie],props:{id:null,activity:null},metaInfo:function(){return{title:this.title}},data:function(){return{endpoint:"timings",working:!1,item:{},phone:null}},computed:{title:function(){return"Телефония"},isSuperuser:function(){return this.user.roles.includes("superuser")},readonly:function(){return this.item.frozen||this.item.verified&&!this.isSuperuser}},methods:{fetchRecord:function(){var t=this;return mi(Ut().mark((function e(){var r,n,i;return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.working=!0,e.prev=1,e.next=4,t.axios.get("".concat(t.endpoint,"/").concat(t.id));case 4:r=e.sent,n=DateTime.fromISO(r.data.began_at),r.data.start_date=n.toISODate(),r.data.start_time=n.toFormat("HH:mm"),i=DateTime.fromISO(r.data.ended_at),r.data.end_date=i.toISODate(),r.data.end_time=i.toFormat("HH:mm"),t.item=r.data,t.form.fill(t.item),e.next=19;break;case 15:return e.prev=15,e.t0=e.catch(1),console.error(e.t0),e.abrupt("return");case 19:return e.prev=19,t.working=!1,e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[1,15,19,22]])})))()},save:function(){var t=this;return mi(Ut().mark((function e(){return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.form.clear(),t.$refs.form.validate()){e.next=3;break}return e.abrupt("return");case 3:if(t.working=!0,!parseInt(t.id)){e.next=21;break}return e.prev=5,e.next=8,t.form.submit("put","".concat(t.endpoint,"/").concat(t.id));case 8:t.$router.go(-1),t.$store.dispatch("notification",{type:"success",text:t.$t("Данные обновлены")}),e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(5),console.error(e.t0),e.abrupt("return");case 16:return e.prev=16,t.working=!1,e.finish(16);case 19:e.next=34;break;case 21:return e.prev=21,e.next=24,t.form.submit("post",t.endpoint);case 24:t.$router.go(-1),t.$store.dispatch("notification",{type:"success",text:t.$t("Деятельность зарегистрирована")}),e.next=31;break;case 28:return e.prev=28,e.t1=e.catch(21),e.abrupt("return");case 31:return e.prev=31,t.working=!1,e.finish(31);case 34:case"end":return e.stop()}}),e,null,[[5,12,16,19],[21,28,31,34]])})))()},call:function(){var t=this;return mi(Ut().mark((function e(){return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.phone&&17!=!t.phone.length){e.next=2;break}return e.abrupt("return");case 2:return t.working=!0,e.prev=3,e.next=6,t.axios.post("calls",{phone:t.phone});case 6:e.sent.data.error?t.$store.dispatch("notification",{type:"error",text:t.$t("Возникла проблема")}):t.$store.dispatch("notification",{type:"success",text:t.$t("Ожидайте звонка")}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),console.error(e.t0);case 13:t.working=!1;case 14:case"end":return e.stop()}}),e,null,[[3,10]])})))()}}},vi=se.Z(fi,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-container",[r("v-form",{ref:"form",on:{submit:function(e){return e.preventDefault(),t.call(e)}}},[r("v-row",[r("v-col",[r("h4",{staticClass:"text-h5"},[t._v("\n                    "+t._s(t.title)+"\n                ")])])],1),t._v(" "),r("v-row",[r("v-col",[r("v-text-field",{directives:[{name:"mask",rawName:"v-mask",value:"+998 ## ### ## ##",expression:"'+998 ## ### ## ##'"}],attrs:{type:"tel",label:t.$t("Телефон"),rules:[t.rules.length(17)],"append-icon":t.icons.mdiPhoneOutline},on:{"click:append":function(e){return t.call()}},model:{value:t.phone,callback:function(e){t.phone=e},expression:"phone"}})],1)],1)],1)],1)}),[],!1,null,null,null),pi=vi.exports;ce()(vi,{VCol:ve.Z,VContainer:pe.Z,VForm:he.Z,VRow:_e.Z,VTextField:ge.Z});var hi={mixins:[ie]},bi=se.Z(hi,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-container",[r("v-simple-table",{scopedSlots:t._u([{key:"default",fn:function(){return[r("thead",[r("tr",[r("th"),t._v(" "),r("th",{attrs:{width:"100%"}})])]),t._v(" "),r("tbody",t._l(t.icons,(function(e,n){return r("tr",{key:n},[r("td",[r("v-icon",[t._v(t._s(e))])],1),t._v(" "),r("td",[t._v(t._s(n))])])})),0)]},proxy:!0}])})],1)}),[],!1,null,null,null),_i=bi.exports;function gi(t){return function(t){if(Array.isArray(t))return yi(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return yi(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?yi(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function yi(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function xi(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function wi(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?xi(Object(r),!0).forEach((function(e){ki(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):xi(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function ki(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function $i(t,e,r,n,i,a,o){try{var s=t[a](o),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(n,i)}function ji(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function o(t){$i(a,n,i,o,s,"next",t)}function s(t){$i(a,n,i,o,s,"throw",t)}o(void 0)}))}}ce()(bi,{VContainer:pe.Z,VIcon:$e.Z,VSimpleTable:Jn.Z}),Et.Z.use(Gt.Z);var Oi,Di,Pi=new Gt.Z({mode:"history",routes:(Oi={authOnly:function(t){return Ci(t,function(){var t=ji(Ut().mark((function t(e,r,n){return Ut().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Kt.getters.user){t.next=9;break}return t.prev=1,t.next=4,Kt.dispatch("fetchUser");case 4:t.next=9;break;case 6:t.prev=6,t.t0=t.catch(1),console.error(t.t0);case 9:Kt.getters.user?n():n({name:"login",query:{redirect:e.fullPath},replace:!0});case 10:case"end":return t.stop()}}),t,null,[[1,6]])})));return function(e,r,n){return t.apply(this,arguments)}}())},guestOnly:function(t){return Ci(t,(function(t,e,r){return Kt.getters.user?r({name:"home"}):r()}))}},Di=Oi.guestOnly,[].concat(gi((0,Oi.authOnly)([{path:"/",name:"home",redirect:{name:"activities.list"}},{path:"/dashboard",name:"dashboard",component:nt},{path:"/profile",name:"profile",component:Dr,props:{id:"self"}},{path:"/users",name:"users.list",component:Xe},{path:"/users/:id",name:"users.form",component:Dr,props:!0},{path:"/:role(client)s",name:"clients.list",component:Xe,props:!0},{path:"/:role(client)s/:id",name:"clients.form",component:Dr,props:!0},{path:"/services",name:"services.list",component:Er},{path:"/forms",name:"forms.list",component:Mr},{path:"/forms/:id/:create?",name:"forms.form",component:un,props:!0},{path:"/schedule",name:"schedule",component:Dt},{path:"/activities",name:"activities.list",component:_n,props:!0},{path:"/activities/:id/:client?",name:"activities.form",component:En,props:!0},{path:"/timings",name:"timings.list",component:ri,props:!0},{path:"/timings/:id/:activity?",name:"timings.form",component:ui,props:!0},{path:"/:mode(requests)",name:"requests.list",component:ri,props:!0},{path:"/calls",name:"calls",component:pi},{path:"/icons",name:"icons",component:_i}])),gi(Di([{path:"/login",name:"login",component:we}])))),scrollBehavior:function(t,e,r){if(r)return r;var n={};return t.hash&&(n.selector=t.hash),t.matched.some((function(t){return t.meta.scrollToTop}))&&(n.x=0,n.y=0),n}});function Ci(t,e){return t.map((function(t){return wi(wi({},t),{},{beforeEnter:e})}))}Pi.beforeEach(function(){var t=ji(Ut().mark((function t(e,r,n){return Ut().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n();case 1:case"end":return t.stop()}}),t)})));return function(e,r,n){return t.apply(this,arguments)}}());var Zi=Pi;function Vi(t,e,r,n,i,a,o){try{var s=t[a](o),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(n,i)}function Si(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function o(t){Vi(a,n,i,o,s,"next",t)}function s(t){Vi(a,n,i,o,s,"throw",t)}o(void 0)}))}}var Ti=function(){var t=Si(Ut().mark((function t(){return Ut().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:Kt.getters.user&&Kt.dispatch("notification",{type:"warning",text:Vt.Z.t("Сеанс завершен!"),title:Vt.Z.t("Пожалуйста, войдите заново.")}).then(Si(Ut().mark((function t(){return Ut().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Kt.dispatch("logout",!0);case 2:Zi.replace({name:"login",query:{redirect:Zi.currentRoute.fullPath}});case 3:case"end":return t.stop()}}),t)}))));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();Et.Z.use(Yt,zt()),zt().defaults.headers.common["X-Requested-With"]="XMLHttpRequest",zt().defaults.baseURL=(window.config.url||"")+"/api/",zt().interceptors.response.use((function(t){return t}),(function(t){return t.response&&t.response.status>=500&&Kt.dispatch("notification",{type:"error",text:Vt.Z.t("Возникла проблема"),title:Vt.Z.t("Попробуйте повторить запрос ещё раз"),persistent:!0}),t.response&&401===t.response.status&&Ti(),Promise.reject(t)})),setInterval(Si(Ut().mark((function t(){return Ut().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Mt().get("XSRF-TOKEN")){t.next=4;break}Ti(),t.next=8;break;case 4:if(!Zi.currentRoute.matched[0]||"login"!=Zi.currentRoute.matched[0].name||!Zi.currentRoute.query.redirect){t.next=8;break}return t.next=7,Kt.dispatch("fetchUser");case 7:Kt.getters.user&&Zi.replace(Zi.currentRoute.query.redirect||{name:"home"});case 8:case"end":return t.stop()}}),t)}))),1e3);var Ii=r(9142),qi=r(1090),Ai=r(4957);Et.Z.use(Ii.Z,{directives:{Ripple:qi.H}});var Ei=new Ii.Z({icons:{iconfont:"mdiSvg"},theme:{themes:{light:{secondary:"#125497"}}},lang:{locales:{ru:Ai.Z},current:"ru"}}),Li=r(8870);Et.Z.use(Li.ZP,{placeholders:{Б:/[а-яА-Я]/}});var Ri={name:"form-input",props:{component:{type:String}},render:function(t){return console.log(this.$parent),t(this.component,this.props,this.$slots.default)}};function Bi(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Ui(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Bi(Object(r),!0).forEach((function(e){Fi(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Bi(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Fi(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}Et.Z.component(Ri.name,Ri);var zi={mixins:[ie],computed:Ui(Ui({},Nt.Se(["user"])),{},{superuser:function(){return this.user.roles.includes("superuser")}})},Qi=r(7787),Mi=r(3907),Yi=r(5573),Ni=r(7330),Hi=se.Z(zi,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-list",{attrs:{dense:""}},[r("v-list-item",{attrs:{link:"",to:t.$router.resolve({name:"activities.list"}).href}},[r("v-list-item-action",[r("v-icon",[t._v(t._s(t.icons.mdiBriefcaseClockOutline))])],1),t._v(" "),r("v-list-item-content",[r("v-list-item-title",[t._v(t._s(t.$t("Поручения")))])],1)],1),t._v(" "),r("v-list-item",{attrs:{link:"",to:t.$router.resolve({name:"timings.list"}).href}},[r("v-list-item-action",[r("v-icon",[t._v(t._s(t.icons.mdiChartBar))])],1),t._v(" "),r("v-list-item-content",[r("v-list-item-title",[t._v(t._s(t.$t("Деятельность")))])],1)],1),t._v(" "),[5,6721].includes(t.user.id)?r("v-list-item",{attrs:{link:"",to:t.$router.resolve({name:"requests.list",params:{mode:"requests"}}).href}},[r("v-list-item-action",[r("v-icon",[t._v(t._s(t.icons.mdiCheckCircleOutline))])],1),t._v(" "),r("v-list-item-content",[r("v-list-item-title",[t._v(t._s(t.$t("Запросы")))])],1)],1):t._e(),t._v(" "),r("v-list-item",{attrs:{link:"",to:t.$router.resolve({name:"clients.list",params:{role:"client"}}).href}},[r("v-list-item-action",[r("v-icon",[t._v(t._s(t.icons.mdiAccountBoxMultipleOutline))])],1),t._v(" "),r("v-list-item-content",[r("v-list-item-title",[t._v(t._s(t.$t("Клиенты")))])],1)],1),t._v(" "),t.user.phone?r("v-list-item",{attrs:{link:"",to:t.$router.resolve({name:"calls"}).href}},[r("v-list-item-action",[r("v-icon",[t._v(t._s(t.icons.mdiPhoneOutline))])],1),t._v(" "),r("v-list-item-content",[r("v-list-item-title",[t._v(t._s(t.$t("Телефония")))])],1)],1):t._e(),t._v(" "),r("v-list-item",{attrs:{link:"",to:t.$router.resolve({name:"services.list"}).href,exact:""}},[r("v-list-item-action",[r("v-icon",[t._v(t._s(t.icons.mdiViewDashboardOutline))])],1),t._v(" "),r("v-list-item-content",[r("v-list-item-title",[t._v(t._s(t.$t("Услуги")))])],1)],1),t._v(" "),r("v-list-item",{attrs:{link:"",to:t.$router.resolve({name:"schedule"}).href}},[r("v-list-item-action",[r("v-icon",[t._v(t._s(t.icons.mdiTimetable))])],1),t._v(" "),r("v-list-item-content",[r("v-list-item-title",[t._v(t._s(t.$t("Рабочий график")))])],1)],1),t._v(" "),t.superuser?r("v-list-item",{attrs:{link:"",to:t.$router.resolve({name:"users.list"}).href}},[r("v-list-item-action",[r("v-icon",[t._v(t._s(t.icons.mdiAccountBoxMultipleOutline))])],1),t._v(" "),r("v-list-item-content",[r("v-list-item-title",[t._v(t._s(t.$t("Сотрудники")))])],1)],1):t._e(),t._v(" "),t.superuser?r("v-list-item",{attrs:{link:"",to:t.$router.resolve({name:"forms.list"}).href}},[r("v-list-item-action",[r("v-icon",[t._v(t._s(t.icons.mdiFileDocumentEditOutline))])],1),t._v(" "),r("v-list-item-content",[r("v-list-item-title",[t._v(t._s(t.$t("Формы")))])],1)],1):t._e(),t._v(" "),r("v-list-item",{attrs:{link:"",to:t.$router.resolve({name:"dashboard"}).href,exact:""}},[r("v-list-item-action",[r("v-icon",[t._v(t._s(t.icons.mdiViewDashboardOutline))])],1),t._v(" "),r("v-list-item-content",[r("v-list-item-title",[t._v(t._s(t.$t("Сводка")))])],1)],1),[5,6721].includes(t.user.id)?r("v-list-item",{attrs:{link:"",to:t.$router.resolve({name:"profile"}).href,exact:""}},[r("v-list-item-action",[r("v-icon",[t._v(t._s(t.icons.mdiBadgeAccountHorizontalOutline))])],1),t._v(" "),r("v-list-item-content",[r("v-list-item-title",[t._v(t._s(t.$t("Профиль")))])],1)],1):t._e()],1)}),[],!1,null,null,null),Wi=Hi.exports;ce()(Hi,{VIcon:$e.Z,VList:Qi.Z,VListItem:Mi.Z,VListItemAction:Yi.Z,VListItemContent:Ni.km,VListItemTitle:Ni.V9});var Xi={computed:Nt.Se(["notification"]),methods:{close:function(){this.$store.dispatch("clearNotification")}}},Ki=r(6834),Ji=se.Z(Xi,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-snackbar",{attrs:{top:"",color:t.notification.type,timeout:-1},scopedSlots:t._u([{key:"action",fn:function(){return[r("v-btn",{attrs:{text:""},on:{click:t.close}},[t._v(t._s(t.$t("Закрыть")))])]},proxy:!0}]),model:{value:t.notification.show,callback:function(e){t.$set(t.notification,"show",e)},expression:"notification.show"}},[t._v("\n    "+t._s(t.notification.text)+"\n    ")])}),[],!1,null,null,null),Gi=Ji.exports;function ta(t,e,r,n,i,a,o){try{var s=t[a](o),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(n,i)}function ea(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function o(t){ta(a,n,i,o,s,"next",t)}function s(t){ta(a,n,i,o,s,"throw",t)}o(void 0)}))}}function ra(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function na(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ra(Object(r),!0).forEach((function(e){ia(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ra(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function ia(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}ce()(Ji,{VBtn:ue.Z,VSnackbar:Ki.Z});var aa={mixins:[ie],components:{navigation:Wi,notification:Gi},metaInfo:function(){return{title:this.$t("Главная страница"),titleTemplate:"%s - ".concat(this.appName)}},data:function(){return{drawer:null,busy:!1,working:!1,inputDialog:!1,comment:null}},computed:na(na({appName:function(){return config.appName}},Nt.Se(["user"])),{},{authenticated:function(){return!!this.user}}),methods:{logout:function(){var t=this;return ea(Ut().mark((function e(){return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.busy=!0,e.next=3,t.$store.dispatch("logout");case 3:t.busy=!1,t.$router.push({name:"login"});case 5:case"end":return e.stop()}}),e)})))()},stopItem:function(t){var e=this;return ea(Ut().mark((function r(){return Ut().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:e.itemId=t.id,e.inputDialog=!0;case 2:case"end":return r.stop()}}),r)})))()},inputDialogClosed:function(){var t=this;return ea(Ut().mark((function e(){return Ut().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.working=!0,e.next=3,t.axios.put("activities/".concat(t.user.current_activity.id,"/stop"),{comment:t.comment});case 3:return e.next=5,t.$store.dispatch("fetchUser");case 5:t.comment=null,t.working=!1,t.inputDialog=!1,t.$root.$emit("fetch-activities");case 9:case"end":return e.stop()}}),e)})))()}}},oa=r(7136),sa=r(2450),la=r(7748),ca=r(2473),ua=r(8876),da=se.Z(aa,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-app",[t.authenticated?r("v-navigation-drawer",{attrs:{app:"",clipped:""},model:{value:t.drawer,callback:function(e){t.drawer=e},expression:"drawer"}},[r("navigation")],1):t._e(),t._v(" "),r("v-app-bar",{attrs:{app:"",dark:"","clipped-left":"",color:"primary"}},[t.authenticated?r("v-app-bar-nav-icon",{on:{click:function(e){e.stopPropagation(),t.drawer=!t.drawer}}}):t._e(),t._v(" "),r("v-toolbar-title",[t._v(t._s(t.appName))]),t._v(" "),r("v-spacer"),t._v(" "),t.authenticated?[r("v-btn",{attrs:{text:""},on:{click:t.logout}},[t._v("\n                "+t._s(t.$t("Выйти"))+"\n                "),t.busy?r("v-progress-circular",{staticClass:"ml-2",attrs:{indeterminate:"",size:"20"}}):t._e()],1)]:[r("v-btn",{attrs:{text:"",to:{name:"login"}}},[t._v(t._s(t.$t("Войти")))])]],2),t._v(" "),r("v-main",[r("router-view",{attrs:{transition:"out-in"}})],1),t._v(" "),r("notification"),t._v(" "),t.user&&t.user.current_activity?r("v-btn",{attrs:{fab:"",color:"warning",fixed:"",bottom:"",right:""},on:{click:function(e){t.inputDialog=!0}}},[r("v-icon",[t._v(t._s(t.icons.mdiStop))])],1):t._e(),t._v(" "),r("v-dialog",{attrs:{"max-width":"320"},model:{value:t.inputDialog,callback:function(e){t.inputDialog=e},expression:"inputDialog"}},[r("v-card",[r("v-card-title",[t._v(t._s(t.$t("Остановка деятельности")))]),t._v(" "),r("v-card-text",[r("v-text-field",{attrs:{label:t.$t("Комментарий"),autofocus:""},on:{keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.inputDialogClosed(e)}},model:{value:t.comment,callback:function(e){t.comment=e},expression:"comment"}})],1),t._v(" "),r("v-card-actions",[r("v-spacer"),t._v(" "),r("v-btn",{attrs:{text:""},on:{click:function(e){t.inputDialog=!1}}},[t._v(t._s(t.$t("Отменить")))]),t._v(" "),r("v-btn",{attrs:{color:"error",dark:""},on:{click:t.inputDialogClosed}},[t._v(t._s(t.$t("Остановить")))])],1)],1)],1)],1)}),[],!1,null,null,null),ma=da.exports;function fa(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function va(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}ce()(da,{VApp:oa.Z,VAppBar:sa.Z,VAppBarNavIcon:la.Z,VBtn:ue.Z,VCard:de.Z,VCardActions:me.h7,VCardText:me.ZB,VCardTitle:me.EB,VDialog:Ye.Z,VIcon:$e.Z,VMain:ca.Z,VNavigationDrawer:ua.Z,VProgressCircular:be.Z,VSpacer:je.Z,VTextField:ge.Z,VToolbarTitle:Ve.qW}),Et.Z.use(Lt.Z),Et.Z.use(Rt),Et.Z.config.productionTip=!1,new Et.Z(function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?fa(Object(r),!0).forEach((function(e){va(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):fa(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({el:"#app",vuetify:Ei,router:Zi,store:Kt,i18n:Vt.Z},ma))},8365:(t,e,r)=>{"use strict";r.d(e,{Z:()=>i});var n=r(2718);const i={data:function(){return{rules:{required:function(t){return!!t||n.Z.t("Обязательно к заполнению")},min:function(t){return function(e){return e.length>=t||n.Z.t("Минимум % символов").replace("%",e)}},length:function(t){return function(e){return!e||e.length==t||n.Z.t("Заполнено неверно")}},notNull:function(t){return null!==t||n.Z.t("Обязательно к заполнению")}}}},methods:{errors:function(t){return this.form.errors.get(t)}}}},2718:(t,e,r)=>{"use strict";r.d(e,{Z:()=>o});var n=r(1460),i=r(7146),a=r(1461);n.Z.use(i.Z);const o=new i.Z({locale:window.config.locale,messages:(0,a.merge)({ru:{timings:{list:{flagged_at:"Отмечено {date}"}}}},{en:{passwords:{reset:"Your password has been reset!",sent:"We have emailed your password reset link!",throttled:"Please wait before retrying.",token:"This password reset token is invalid.",user:"We can't find a user with that email address."},auth:{failed:"These credentials do not match our records.",throttle:"Too many login attempts. Please try again in {seconds} seconds."},pagination:{previous:"&laquo; Previous",next:"Next &raquo;"},validation:{accepted:"The {attribute} must be accepted.",active_url:"The {attribute} is not a valid URL.",after:"The {attribute} must be a date after {date}.",after_or_equal:"The {attribute} must be a date after or equal to {date}.",alpha:"The {attribute} may only contain letters.",alpha_dash:"The {attribute} may only contain letters, numbers, dashes and underscores.",alpha_num:"The {attribute} may only contain letters and numbers.",array:"The {attribute} must be an array.",before:"The {attribute} must be a date before {date}.",before_or_equal:"The {attribute} must be a date before or equal to {date}.",between:{numeric:"The {attribute} must be between {min} and {max}.",file:"The {attribute} must be between {min} and {max} kilobytes.",string:"The {attribute} must be between {min} and {max} characters.",array:"The {attribute} must have between {min} and {max} items."},boolean:"The {attribute} field must be true or false.",confirmed:"The {attribute} confirmation does not match.",date:"The {attribute} is not a valid date.",date_equals:"The {attribute} must be a date equal to {date}.",date_format:"The {attribute} does not match the format {format}.",different:"The {attribute} and {other} must be different.",digits:"The {attribute} must be {digits} digits.",digits_between:"The {attribute} must be between {min} and {max} digits.",dimensions:"The {attribute} has invalid image dimensions.",distinct:"The {attribute} field has a duplicate value.",email:"The {attribute} must be a valid email address.",ends_with:"The {attribute} must end with one of the following: {values}.",exists:"The selected {attribute} is invalid.",file:"The {attribute} must be a file.",filled:"The {attribute} field must have a value.",gt:{numeric:"The {attribute} must be greater than {value}.",file:"The {attribute} must be greater than {value} kilobytes.",string:"The {attribute} must be greater than {value} characters.",array:"The {attribute} must have more than {value} items."},gte:{numeric:"The {attribute} must be greater than or equal {value}.",file:"The {attribute} must be greater than or equal {value} kilobytes.",string:"The {attribute} must be greater than or equal {value} characters.",array:"The {attribute} must have {value} items or more."},image:"The {attribute} must be an image.",in:"The selected {attribute} is invalid.",in_array:"The {attribute} field does not exist in {other}.",integer:"The {attribute} must be an integer.",ip:"The {attribute} must be a valid IP address.",ipv4:"The {attribute} must be a valid IPv4 address.",ipv6:"The {attribute} must be a valid IPv6 address.",json:"The {attribute} must be a valid JSON string.",lt:{numeric:"The {attribute} must be less than {value}.",file:"The {attribute} must be less than {value} kilobytes.",string:"The {attribute} must be less than {value} characters.",array:"The {attribute} must have less than {value} items."},lte:{numeric:"The {attribute} must be less than or equal {value}.",file:"The {attribute} must be less than or equal {value} kilobytes.",string:"The {attribute} must be less than or equal {value} characters.",array:"The {attribute} must not have more than {value} items."},max:{numeric:"The {attribute} may not be greater than {max}.",file:"The {attribute} may not be greater than {max} kilobytes.",string:"The {attribute} may not be greater than {max} characters.",array:"The {attribute} may not have more than {max} items."},mimes:"The {attribute} must be a file of type: {values}.",mimetypes:"The {attribute} must be a file of type: {values}.",min:{numeric:"The {attribute} must be at least {min}.",file:"The {attribute} must be at least {min} kilobytes.",string:"The {attribute} must be at least {min} characters.",array:"The {attribute} must have at least {min} items."},not_in:"The selected {attribute} is invalid.",not_regex:"The {attribute} format is invalid.",numeric:"The {attribute} must be a number.",password:"The password is incorrect.",present:"The {attribute} field must be present.",regex:"The {attribute} format is invalid.",required:"The {attribute} field is required.",required_if:"The {attribute} field is required when {other} is {value}.",required_unless:"The {attribute} field is required unless {other} is in {values}.",required_with:"The {attribute} field is required when {values} is present.",required_with_all:"The {attribute} field is required when {values} are present.",required_without:"The {attribute} field is required when {values} is not present.",required_without_all:"The {attribute} field is required when none of {values} are present.",same:"The {attribute} and {other} must match.",size:{numeric:"The {attribute} must be {size}.",file:"The {attribute} must be {size} kilobytes.",string:"The {attribute} must be {size} characters.",array:"The {attribute} must contain {size} items."},starts_with:"The {attribute} must start with one of the following: {values}.",string:"The {attribute} must be a string.",timezone:"The {attribute} must be a valid zone.",unique:"The {attribute} has already been taken.",uploaded:"The {attribute} failed to upload.",url:"The {attribute} format is invalid.",uuid:"The {attribute} must be a valid UUID.",custom:{"attribute-name":{"rule-name":"custom-message"}},attributes:[]}},ru:{passwords:{reset:"Ваш пароль был сброшен!",sent:"Ссылка на сброс пароля была отправлена!",throttled:"Пожалуйста, подождите перед повторной попыткой.",token:"Ошибочный код сброса пароля.",user:"Не удалось найти пользователя с указанным электронным адресом."},auth:{failed:"Неверное имя пользователя или пароль.",throttle:"Слишком много попыток входа. Пожалуйста, попробуйте еще раз через {seconds} секунд."},pagination:{previous:"&laquo; Назад",next:"Вперёд &raquo;"},"validation-inline":{accepted:"Должно быть принято.",active_url:"Недействительный URL.",after:"Дата должна быть больше {date}.",after_or_equal:"Дата должна быть больше или равняться {date}.",alpha:"Здесь могут быть только буквы.",alpha_dash:"Здесь могут быть только буквы, цифры, дефис и нижнее подчеркивание.",alpha_num:"Здесь могут быть только буквы и цифры.",array:"Здесь должен быть массив.",before:"Дата здесь должна быть раньше {date}.",before_or_equal:"Дата здесь должна быть раньше или равняться {date}.",between:{numeric:"Значение должно быть между {min} и {max}.",file:"Размер файла должен быть между {min} и {max} Килобайт(а).",string:"Количество символов должно быть между {min} и {max}.",array:"Количество элементов должно быть между {min} и {max}."},boolean:"Поле должно иметь значение логического типа.",confirmed:"Не совпадает с подтверждением.",date:"Не является датой.",date_equals:"Дата должна быть равной {date}.",date_format:"Не соответствует формату {format}.",different:"Значение должно отличаться от {other}",digits:"Длина должна быть {digits}.",digits_between:"Длина должна быть между {min} и {max}.",dimensions:"Изображение имеет недопустимые размеры.",distinct:"Поле содержит повторяющееся значение.",email:"Электронный адрес должен быть действительным.",ends_with:"Должно заканчиваться одним из следующих значений: {values}",exists:"Выбранное значение некорректно.",file:"Содержимое должно быть файлом.",filled:"Обязательно для заполнения.",gt:{numeric:"Значение должно быть больше {value}.",file:"Размер файла должен быть больше {value} Килобайт(а).",string:"Количество символов должно быть больше {value}.",array:"Количество элементов должно быть больше {value}."},gte:{numeric:"Значение должно быть {value} или больше.",file:"Размер файла должен быть {value} Килобайт(а) или больше.",string:"Количество символов должно быть {value} или больше.",array:"Количество элементов должно быть {value} или больше."},image:"Здесь должно быть изображение.",in:"Выбранное значение ошибочно.",in_array:"Значение не существует в {other}.",integer:"Должно быть целое число.",ip:"Должен быть действительный IP-адрес.",ipv4:"Должен быть действительный IPv4-адрес.",ipv6:"Должен быть действительный IPv6-адрес.",json:"Должно быть JSON строкой.",lt:{numeric:"Значение должно быть меньше {value}.",file:"Размер файла должен быть меньше {value} Килобайт(а).",string:"Количество символов должно быть меньше {value}.",array:"Количество элементов должно быть меньше {value}."},lte:{numeric:"Значение должно быть {value} или меньше.",file:"Размер файла должен быть {value} Килобайт(а) или меньше.",string:"Количество символов должно быть {value} или меньше.",array:"Количество элементов должно быть {value} или меньше."},max:{numeric:"Значение не может быть больше {max}.",file:"Размер файла не может быть больше {max} Килобайт(а).",string:"Количество символов не может превышать {max}.",array:"Количество элементов не может превышать {max}."},mimes:"Должен быть файл одного из следующих типов: {values}.",mimetypes:"Должен быть файл одного из следующих типов: {values}.",min:{numeric:"Значение должно быть не меньше {min}.",file:"Размер файла должен быть не меньше {min} Килобайт(а).",string:"Количество символов должно быть не меньше {min}.",array:"Количество элементов должно быть не меньше {min}."},not_in:"Выбранное значение ошибочно.",not_regex:"Выбранный формат ошибочный.",numeric:"Здесь должно быть число.",password:"Неверный пароль.",present:"Значение должно быть.",regex:"Ошибочный формат.",required:"Обязательно для заполнения.",required_if:"Обязательно для заполнения, когда {other} равно {value}.",required_unless:"Обязательно для заполнения, когда {other} не равно {values}.",required_with:"Обязательно для заполнения, когда {values} указано.",required_with_all:"Обязательно для заполнения, когда {values} указано.",required_without:"Обязательно для заполнения, когда {values} не указано.",required_without_all:"Обязательно для заполнения, когда ни одно из {values} не указано.",same:"Значение должно совпадать с {other}.",size:{numeric:"Значение должно быть равным {size}.",file:"Размер файла должен быть равен {size} Килобайт(а).",string:"Количество символов должно быть равным {size}.",array:"Количество элементов должно быть равным {size}."},starts_with:"Значение должно начинаться из одного из следующих значений: {values}",string:"Здесь должна быть строка.",timezone:"Должен быть действительный часовой пояс.",unique:"Такое значение уже существует.",uploaded:"Загрузка не удалась.",url:"Ошибочный формат URL.",uuid:"Должен быть корректный UUID.",custom:{"attribute-name":{"rule-name":"custom-message"}}},validation:{accepted:"Вы должны принять {attribute}.",active_url:"Поле {attribute} содержит недействительный URL.",after:"В поле {attribute} должна быть дата больше {date}.",after_or_equal:"В поле {attribute} должна быть дата больше или равняться {date}.",alpha:"Поле {attribute} может содержать только буквы.",alpha_dash:"Поле {attribute} может содержать только буквы, цифры, дефис и нижнее подчеркивание.",alpha_num:"Поле {attribute} может содержать только буквы и цифры.",array:"Поле {attribute} должно быть массивом.",before:"В поле {attribute} должна быть дата раньше {date}.",before_or_equal:"В поле {attribute} должна быть дата раньше или равняться {date}.",between:{numeric:"Поле {attribute} должно быть между {min} и {max}.",file:"Размер файла в поле {attribute} должен быть между {min} и {max} Килобайт(а).",string:"Количество символов в поле {attribute} должно быть между {min} и {max}.",array:"Количество элементов в поле {attribute} должно быть между {min} и {max}."},boolean:"Поле {attribute} должно иметь значение логического типа.",confirmed:"Поле {attribute} не совпадает с подтверждением.",date:"Поле {attribute} не является датой.",date_equals:"Поле {attribute} должно быть датой равной {date}.",date_format:"Поле {attribute} не соответствует формату {format}.",different:"Поля {attribute} и {other} должны различаться.",digits:"Длина цифрового поля {attribute} должна быть {digits}.",digits_between:"Длина цифрового поля {attribute} должна быть между {min} и {max}.",dimensions:"Поле {attribute} имеет недопустимые размеры изображения.",distinct:"Поле {attribute} содержит повторяющееся значение.",email:"Поле {attribute} должно быть действительным электронным адресом.",ends_with:"Поле {attribute} должно заканчиваться одним из следующих значений: {values}",exists:"Выбранное значение для {attribute} некорректно.",file:"Поле {attribute} должно быть файлом.",filled:"Поле {attribute} обязательно для заполнения.",gt:{numeric:"Поле {attribute} должно быть больше {value}.",file:"Размер файла в поле {attribute} должен быть больше {value} Килобайт(а).",string:"Количество символов в поле {attribute} должно быть больше {value}.",array:"Количество элементов в поле {attribute} должно быть больше {value}."},gte:{numeric:"Поле {attribute} должно быть {value} или больше.",file:"Размер файла в поле {attribute} должен быть {value} Килобайт(а) или больше.",string:"Количество символов в поле {attribute} должно быть {value} или больше.",array:"Количество элементов в поле {attribute} должно быть {value} или больше."},image:"Поле {attribute} должно быть изображением.",in:"Выбранное значение для {attribute} ошибочно.",in_array:"Поле {attribute} не существует в {other}.",integer:"Поле {attribute} должно быть целым числом.",ip:"Поле {attribute} должно быть действительным IP-адресом.",ipv4:"Поле {attribute} должно быть действительным IPv4-адресом.",ipv6:"Поле {attribute} должно быть действительным IPv6-адресом.",json:"Поле {attribute} должно быть JSON строкой.",lt:{numeric:"Поле {attribute} должно быть меньше {value}.",file:"Размер файла в поле {attribute} должен быть меньше {value} Килобайт(а).",string:"Количество символов в поле {attribute} должно быть меньше {value}.",array:"Количество элементов в поле {attribute} должно быть меньше {value}."},lte:{numeric:"Поле {attribute} должно быть {value} или меньше.",file:"Размер файла в поле {attribute} должен быть {value} Килобайт(а) или меньше.",string:"Количество символов в поле {attribute} должно быть {value} или меньше.",array:"Количество элементов в поле {attribute} должно быть {value} или меньше."},max:{numeric:"Поле {attribute} не может быть больше {max}.",file:"Размер файла в поле {attribute} не может быть больше {max} Килобайт(а).",string:"Количество символов в поле {attribute} не может превышать {max}.",array:"Количество элементов в поле {attribute} не может превышать {max}."},mimes:"Поле {attribute} должно быть файлом одного из следующих типов: {values}.",mimetypes:"Поле {attribute} должно быть файлом одного из следующих типов: {values}.",min:{numeric:"Поле {attribute} должно быть не меньше {min}.",file:"Размер файла в поле {attribute} должен быть не меньше {min} Килобайт(а).",string:"Количество символов в поле {attribute} должно быть не меньше {min}.",array:"Количество элементов в поле {attribute} должно быть не меньше {min}."},not_in:"Выбранное значение для {attribute} ошибочно.",not_regex:"Выбранный формат для {attribute} ошибочный.",numeric:"Поле {attribute} должно быть числом.",password:"Неверный пароль.",present:"Поле {attribute} должно присутствовать.",regex:"Поле {attribute} имеет ошибочный формат.",required:"Поле {attribute} обязательно для заполнения.",required_if:"Поле {attribute} обязательно для заполнения, когда {other} равно {value}.",required_unless:"Поле {attribute} обязательно для заполнения, когда {other} не равно {values}.",required_with:"Поле {attribute} обязательно для заполнения, когда {values} указано.",required_with_all:"Поле {attribute} обязательно для заполнения, когда {values} указано.",required_without:"Поле {attribute} обязательно для заполнения, когда {values} не указано.",required_without_all:"Поле {attribute} обязательно для заполнения, когда ни одно из {values} не указано.",same:"Значения полей {attribute} и {other} должны совпадать.",size:{numeric:"Поле {attribute} должно быть равным {size}.",file:"Размер файла в поле {attribute} должен быть равен {size} Килобайт(а).",string:"Количество символов в поле {attribute} должно быть равным {size}.",array:"Количество элементов в поле {attribute} должно быть равным {size}."},starts_with:"Поле {attribute} должно начинаться из одного из следующих значений: {values}",string:"Поле {attribute} должно быть строкой.",timezone:"Поле {attribute} должно быть действительным часовым поясом.",unique:"Такое значение поля {attribute} уже существует.",uploaded:"Загрузка поля {attribute} не удалась.",url:"Поле {attribute} имеет ошибочный формат URL.",uuid:"Поле {attribute} должно быть корректным UUID.",custom:{"attribute-name":{"rule-name":"custom-message"}},attributes:{name:"Имя",username:"Никнейм",email:"E-Mail адрес",first_name:"Имя",last_name:"Фамилия",password:"Пароль",password_confirmation:"Подтверждение пароля",city:"Город",country:"Страна",address:"Адрес",phone:"Телефон",mobile:"Моб. номер",age:"Возраст",sex:"Пол",gender:"Пол",day:"День",month:"Месяц",year:"Год",hour:"Час",minute:"Минута",second:"Секунда",title:"Наименование",content:"Контент",description:"Описание",excerpt:"Выдержка",date:"Дата",time:"Время",available:"Доступно",size:"Размер",code:"код"}}}}),silentTranslationWarn:!0})},3324:()=>{},4949:(t,e,r)=>{"use strict";r.d(e,{Z:()=>f});const n={mixins:[r(8365).Z],props:["conditionItems","item"],computed:{conditionItem:function(){var t=this;return this.item&&this.conditionItems.find((function(e){return e.id==t.item[0]}))},conditionItemOptions:function(){return this.conditionItem?"checkbox"==this.conditionItem.type?[{id:!1,text:this.$t("Не выбрано")},{id:!0,text:this.$t("Выбрано")}]:["text","date"].includes(this.conditionItem.type)?[{id:!1,text:this.$t("Не заполнено")},{id:!0,text:this.$t("Заполнено")}]:this.conditionItem.answers:void 0}}};var i=r(1900),a=r(3453),o=r.n(a),s=r(260),l=r(6032),c=r(1446),u=(0,i.Z)(n,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-row",[r("v-col",[r("v-select",{attrs:{label:t.$t("Связанный вопрос"),rules:t.item[1]?[t.rules.required]:[],items:t.conditionItems,"item-value":"id",clearable:""},model:{value:t.item[0],callback:function(e){t.$set(t.item,0,e)},expression:"item[0]"}})],1),t._v(" "),t.item[0]?r("v-col",[r("v-select",{attrs:{label:t.$t("Связанный ответ"),rules:[t.rules.notNull],items:t.conditionItemOptions,"item-value":"id",clearable:""},model:{value:t.item[1],callback:function(e){t.$set(t.item,1,e)},expression:"item[1]"}})],1):t._e()],1)}),[],!1,null,null,null);const d=u.exports;o()(u,{VCol:s.Z,VRow:l.Z,VSelect:c.Z});const m={components:{item:d},props:["conditionItems","item"],watch:{"item.ifItems":{handler:function(t){if(t){var e=function(e){e==t.length-1||t[e][0]||setTimeout((function(){return t.splice(e,1)}))};for(var r in t)e(r);t.length&&!t[t.length-1][0]||t.push([null,null])}else this.$set(this.item,"ifItems",[])},deep:!0,immediate:!0}}};const f=(0,i.Z)(m,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",t._l(t.item.ifItems,(function(e,n){return r("item",{key:n,attrs:{item:e,conditionItems:t.conditionItems}})})),1)}),[],!1,null,null,null).exports},3743:t=>{function e(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}e.keys=()=>[],e.resolve=e,e.id=3743,t.exports=e},935:t=>{"use strict";t.exports=JSON.parse('{"version":2,"items":[{"id":"DQqq","type":"text","answers":[{"id":"s237"}],"text":"Место выезда","required":false},{"id":"iah6","type":"text","answers":[{"id":"Q2o5"}],"text":"Место назначения","required":false,"row":true},{"id":"aLxr","type":"checkbox","answers":[{"id":"mTzJ"}],"text":"Использовалась служба такси","row":false},{"id":"y3ew","type":"text","answers":[{"id":"m82L"}],"text":"Расстояние / время","required":false,"row":true},{"id":"5FsZ","type":"number","text":"Стоимость поездки","required":false,"conditional":true,"ifItem":"aLxr","ifItemIs":true,"row":true},{"id":"file","type":"file","text":"Изображение квитанции","required":false,"conditional":true,"ifItem":"aLxr","ifItemIs":true,"row":true}]}')}},0,[[7511,929,555],[3324,929,555]]]);